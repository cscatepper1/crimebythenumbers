--- 
knit: "bookdown::render_book"
title: "R 4 Criminology"
author: ["Jacob Kaplan", "Greg Ridgeway"]bibliography: [packages.bib]
biblio-style: apalike
link-citations: yes
colorlinks: yes
description: "Notes for learning and applying R to questions about crime and the justice system."
url: "https://r4crim.com"
fontsize: 12pt
github-repo: jacobkap/r4crim
site: bookdown::bookdown_site
documentclass: book
---

```{r setup, include=FALSE}
options(
  htmltools.dir.version = FALSE, formatR.indent = 1,
  width = 55, digits = 4, warnPartialMatchAttr = FALSE, warnPartialMatchDollar = FALSE
)
```

# Welcome {-}

These notes form the basis of an introductory course in R with a focus on skills relevant for criminology students. Students code in R to answer questions like "what do victims of murder look like?" and "are Pennsylvanians drinking more beer than they used to?" and "where do police shootings occur in Philadelphia?". On the way to answering these questions students learn about regular expressions, webscraping, mapping, handling geographic data, official data sources (UCR, NIBRS, ACS), and basic data coding skills.

<!--chapter:end:index.Rmd-->

# About the Authors {-}

**Jacob Kaplan** (<http://crimedatatool.com/>) is a Ph.D. candidate in criminology at the University of Pennsylvania. His research focuses on Crime Prevention Through Environmental Design (CPTED), specifically on the effect of outdoor lighting on crime. He is the author of several R packages, such as [asciiSetupReader](https://jacobkap.github.io/asciiSetupReader/), [fastDummies](https://jacobkap.github.io/fastDummies/), and [boxoffice](https://jacobkap.github.io/boxoffice/). His website [Crime Data Tool](http://crimedatatool.com/) allows easy analysis of crime-related data and he has released over a [dozen crime data sets](http://crimedatatool.com/data.html) (primarily FBI UCR data) on openICPSR.

**Dr. Greg Ridgeway** (<https://crim.sas.upenn.edu/people/greg-ridgeway>) is an Associate Professor of Criminology and Statistics at the University of Pennsylvania. His research involves the development of statistical, computational, and analytical methods to improve our understanding of crime and the functioning of the justice system. At the same time, he has great interest in putting those methods into practice. His methods have been put into place in police departments, including Cincinnati, Los Angeles, and New York City, in Federal Public Defender Organizations, and in drug treatment program evaluations.

Prior to coming to Penn, Prof. Ridgeway was the Acting Director of the National Institute of Justice, and as such, a member of the Senior Executive Service, the highest leadership position in the federal government's civil service. Previously, Prof. Ridgeway was Director of the RAND Safety and Justice Program and the RAND Center on Quality Policing where he worked with numerous criminal justice organizations around the world. Dr. Ridgeway is a Fellow of the American Statistical Association, a distinction he received for being one of the worldâ€™s foremost statisticians engaged in crime research. He is the inventor on seven awarded US patents.

<!--chapter:end:author.Rmd-->

# Choropleth Maps

<!--chapter:end:choropleth-maps.Rmd-->


# Dates and Times

Placeholder


## Why do dates and times matter?
## `lubridate`
## Working with dates
## Chicago crime data
## Time zones
### Exercises

<!--chapter:end:dates-and-times.Rmd-->


# Exploratory data analysis

Placeholder


## Summary and Table
## Graphing Data
## Aggregating (summaries of groups)

<!--chapter:end:exploratory-data-analysis.Rmd-->


# For loops

Placeholder


## Basic for loops
## Scraping multiple days of movie

<!--chapter:end:for-loops.Rmd-->


# Functions

Placeholder


## A simple function
## Adding parameters 
## Making a function to scrape movie data
## The benefits of functions
## Understanding other people's functions

<!--chapter:end:functions.Rmd-->


# Geocoding 

Placeholder


## Geocoding a single address
## Making a function
## Geocoding officer shooting locations

<!--chapter:end:geocoding.Rmd-->


# Graphing Officer-Involved Shootings

Placeholder


## Graphing a single variable
### Numeric variable
### Categorical variable
## Time Series

<!--chapter:end:graphing-officer-shootings.Rmd-->


# Graphing with `ggplot2`

Placeholder


## What does the data look like? 
### Exercises
### Exercises
## Graphing data 
## Time-Series Plots
### Exercises
### Exercises
## Should we trust this data?
### Exercises
### Exercises

<!--chapter:end:graphing.Rmd-->


# Hotspot maps

Placeholder


## Creating the maps

<!--chapter:end:hotspot-maps.Rmd-->


# Interactive Maps

Placeholder


## Why do interactive graphs matter?
### Understanding your data
### Police departments use them
## Making the interactive map 
## Adding popup information
## Dealing with too many markers
## Interactive polygons

<!--chapter:end:interactive-maps.Rmd-->


# Introduction to R

Placeholder


## Basic Math
## Combining values together into a collection (or vector)
## Assignment of values to variables (Making "things")
## Reading data into R
### Setting the working directory
### Loading data
### First steps to explore the data

<!--chapter:end:intro-to-r.Rmd-->

# Intro to RStudio 

<!--chapter:end:intro-to-rstudio.Rmd-->


# Choropleth Maps

Placeholder



<!--chapter:end:ois-shapefiles.Rmd-->


# Scraping data from PDFs

Placeholder


## Downloading officer-involved Shooting Files
## Scraping information from the page
### Combining the data sets
## Extracting data from PDFs
### Scraping a single PDF
### Making a function
### Looping through every PDF

<!--chapter:end:pdf-scraping.Rmd-->

# Scraping Tables from PDFs

<!--chapter:end:pdf-tables.Rmd-->

# Reading and Writing Data

## Reading Data into R

### R files

### Excel files

### Stata files

### SAS files


## Writing Data 

### R files

### Excel files

### Stata files

### SAS files

<!--chapter:end:reading-writing-data.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`


```{r include=FALSE, warn = FALSE}
files <- list.files(pattern = ".Rmd")
packages_to_reference <- c()
for (file in files) {
  file <- readr::read_lines(file)
  refs <- file[grep("^library", file)]
  refs <- gsub("library\\((.*)\\)", "\\1", refs)
  
  packages_to_reference <- c(packages_to_reference, refs)
  packages_to_reference <- sort(packages_to_reference)
}


knitr::write_bib(packages_to_reference, 'packages.bib')
```

<!--chapter:end:references.Rmd-->


# Regular Expressions 

Placeholder


## Finding patterns in text with `grep()`
## Finding and replacing patterns in text with `gsub()`
## Useful special characters
### Multiple characters `[]`
### n-many of previous character `{n}`
### n-many to m-many of previous character `{n,m}`
### Start of string and "not" `^`
### End of string `$`
### Anything `.`
### One or more of previous `+`
### Zero or more of previous `*`
### Multiple patterns `|`
### Parentheses `()`
###  Optional text `?`
### Back-referencing `()`
## Changing capitalization

<!--chapter:end:regular-expressions.Rmd-->


# Using R Markdown

Placeholder


## Code
### Only use code to make output
## Figures and Tables
## Finally, making the output file

<!--chapter:end:rmarkdown.Rmd-->


# Subsetting: Making big things small

Placeholder


## Select specific values
## Logical values and operations
### Matching a single value
### Matching multiple values
### Does not match
### Greater than or less than
### Combining conditional statements - or, and
## Subsetting a data.frame 
## Select a specific column
### Select specific rows in a data.frame
### Battleships
### Subset Colorado data

<!--chapter:end:subsetting.Rmd-->


# Types of objects

Placeholder


## Vectors
## Data frames
## Lists 

<!--chapter:end:types-of-objects.Rmd-->

\cleardoublepage 

# (APPENDIX) Appendix {-}

# Useful Resources

## Learning R and coding issues

[R for Data Science](http://r4ds.had.co.nz/) - This free online book provides a good introduction for R though it differs in several important ways from this class.


[Stack Overflow](http://stackoverflow.com/) - Stack Overflow is a website that answers programming-related questions. It's like the Yahoo Answers of programming. That said, a lot of the answer are bad. Some answers are overly confusing or provide code that you may not understand. You can use this source, but don't rely too heavily on it. Its search function isn't great so it's better to Google your question and choose the stackoverflow.com result. 


## Data

[Crime Data](https://www.icpsr.umich.edu/icpsrweb/content/NACJD/index.html) - 

[Crime Data (cleaned)](http://crimedatatool.com/data) - 

[General Data](https://www.icpsr.umich.edu/icpsrweb/) - 

[Census Data](https://usa.ipums.org/usa/) - 

[Local crime data](https://www.policedatainitiative.org/datasets/) - 

<!--chapter:end:useful-resources.Rmd-->


# Webscraping with `rvest`

Placeholder


## Scraping one page
## Cleaning the webscraped data
## Fixing names
### Exercises

<!--chapter:end:webscraping.Rmd-->

# Census Data

<!--chapter:end:working-with-census-data.Rmd-->


# National Incident-Based Reporting System (NIBRS) Data

Placeholder


## Downloading the data
## Reading the data

<!--chapter:end:working-with-nibrs-data.Rmd-->


# Uniform Crime Report (UCR) Data

Placeholder


## Exploring the UCR data
## Finding things in our data
## Manipulating our data
### Exercises

<!--chapter:end:working-with-ucr-data.Rmd-->

