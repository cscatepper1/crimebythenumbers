<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Choropleth maps | Crime by the Numbers: A Criminologist’s Guide to R</title>
  <meta name="description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Choropleth maps | Crime by the Numbers: A Criminologist’s Guide to R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  <meta name="github-repo" content="jacobkap/crimebythenumbers" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Choropleth maps | Crime by the Numbers: A Criminologist’s Guide to R" />
  
  <meta name="twitter:description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  

<meta name="author" content="Jacob Kaplan" />


<meta name="date" content="2023-01-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hotspot-maps.html"/>
<link rel="next" href="interactive-maps.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Crime by the Numbers: A Criminologist's Guide to R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-learn-to-program"><i class="fa fa-check"></i>Why learn to program?</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#scale"><i class="fa fa-check"></i>Scale</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-will-learn"><i class="fa fa-check"></i>What you will learn</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i>Skills</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-wont-learn"><i class="fa fa-check"></i>What you won’t learn</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#simple-vs-easy"><i class="fa fa-check"></i>Simple vs easy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-read-this-book"><i class="fa fa-check"></i>How to read this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citing-this-book"><i class="fa fa-check"></i>Citing this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute-to-this-book"><i class="fa fa-check"></i>How to contribute to this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#where-to-find-data-included-in-this-book"><i class="fa fa-check"></i>Where to find data included in this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#where-to-find-code-included-in-this-book"><i class="fa fa-check"></i>Where to find code included in this book</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the author</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html"><i class="fa fa-check"></i><b>1</b> A soup to nuts project example</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#big-picture-data-example"><i class="fa fa-check"></i><b>1.1</b> Big picture data example</a></li>
<li class="chapter" data-level="1.2" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#little-picture-data-example"><i class="fa fa-check"></i><b>1.2</b> Little picture data example</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#loading-packages"><i class="fa fa-check"></i><b>1.2.1</b> Loading packages</a></li>
<li class="chapter" data-level="1.2.2" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#loading-data"><i class="fa fa-check"></i><b>1.2.2</b> Loading data</a></li>
<li class="chapter" data-level="1.2.3" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#cleaning"><i class="fa fa-check"></i><b>1.2.3</b> Cleaning</a></li>
<li class="chapter" data-level="1.2.4" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#aggregating"><i class="fa fa-check"></i><b>1.2.4</b> Aggregating</a></li>
<li class="chapter" data-level="1.2.5" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#graphing"><i class="fa fa-check"></i><b>1.2.5</b> Graphing</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#reusing-and-modifying-code"><i class="fa fa-check"></i><b>1.3</b> Reusing and modifying code</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro-to-r.html"><a href="intro-to-r.html#using-rstudio"><i class="fa fa-check"></i><b>2.1</b> Using RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro-to-r.html"><a href="intro-to-r.html#opening-an-r-script"><i class="fa fa-check"></i><b>2.1.1</b> Opening an R Script</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro-to-r.html"><a href="intro-to-r.html#setting-the-working-directory"><i class="fa fa-check"></i><b>2.1.2</b> Setting the working directory</a></li>
<li class="chapter" data-level="2.1.3" data-path="intro-to-r.html"><a href="intro-to-r.html#changing-rstudio"><i class="fa fa-check"></i><b>2.1.3</b> Changing RStudio</a></li>
<li class="chapter" data-level="2.1.4" data-path="intro-to-r.html"><a href="intro-to-r.html#helpful-cheat-sheets"><i class="fa fa-check"></i><b>2.1.4</b> Helpful cheat sheets</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro-to-r.html"><a href="intro-to-r.html#assignment"><i class="fa fa-check"></i><b>2.2</b> Assigning variables</a></li>
<li class="chapter" data-level="2.3" data-path="intro-to-r.html"><a href="intro-to-r.html#functions-intro"><i class="fa fa-check"></i><b>2.3</b> What are functions (and packages)?</a></li>
<li class="chapter" data-level="2.4" data-path="intro-to-r.html"><a href="intro-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.4</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-to-r.html"><a href="intro-to-r.html#loading-data-intro"><i class="fa fa-check"></i><b>2.4.1</b> Loading data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-to-r.html"><a href="intro-to-r.html#first-steps-to-exploring-data"><i class="fa fa-check"></i><b>2.5</b> First steps to exploring data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>3</b> Data types and structures</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-types.html"><a href="data-types.html#section-data-types"><i class="fa fa-check"></i><b>3.1</b> Data types</a></li>
<li class="chapter" data-level="3.2" data-path="data-types.html"><a href="data-types.html#numeric-character-and-logical-boolean"><i class="fa fa-check"></i><b>3.2</b> Numeric, character, and logical (boolean)</a></li>
<li class="chapter" data-level="3.3" data-path="data-types.html"><a href="data-types.html#data-structures"><i class="fa fa-check"></i><b>3.3</b> Data structures</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-types.html"><a href="data-types.html#vectors"><i class="fa fa-check"></i><b>3.3.1</b> Vectors (collections of “things”)</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-types.html"><a href="data-types.html#dataframes"><i class="fa fa-check"></i><b>3.3.2</b> Data.frames</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-types.html"><a href="data-types.html#other-data-structures"><i class="fa fa-check"></i><b>3.3.3</b> Other data structures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>4.1</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r"><i class="fa fa-check"></i><b>4.1.1</b> R</a></li>
<li class="chapter" data-level="4.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel"><i class="fa fa-check"></i><b>4.1.2</b> Excel</a></li>
<li class="chapter" data-level="4.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata"><i class="fa fa-check"></i><b>4.1.3</b> Stata</a></li>
<li class="chapter" data-level="4.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas"><i class="fa fa-check"></i><b>4.1.4</b> SAS</a></li>
<li class="chapter" data-level="4.1.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss"><i class="fa fa-check"></i><b>4.1.5</b> SPSS</a></li>
<li class="chapter" data-level="4.1.6" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#fixed-width-ascii"><i class="fa fa-check"></i><b>4.1.6</b> Fixed-width ASCII</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>4.2</b> Writing data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-1"><i class="fa fa-check"></i><b>4.2.1</b> R</a></li>
<li class="chapter" data-level="4.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-1"><i class="fa fa-check"></i><b>4.2.2</b> Excel</a></li>
<li class="chapter" data-level="4.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-1"><i class="fa fa-check"></i><b>4.2.3</b> Stata</a></li>
<li class="chapter" data-level="4.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-1"><i class="fa fa-check"></i><b>4.2.4</b> SAS</a></li>
<li class="chapter" data-level="4.2.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss-1"><i class="fa fa-check"></i><b>4.2.5</b> SPSS</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="5" data-path="mise-en-place.html"><a href="mise-en-place.html"><i class="fa fa-check"></i><b>5</b> <em>Mise en place</em></a>
<ul>
<li class="chapter" data-level="5.1" data-path="mise-en-place.html"><a href="mise-en-place.html#starting-with-a-pencil-and-paper"><i class="fa fa-check"></i><b>5.1</b> Starting with a pencil and paper</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="mise-en-place.html"><a href="mise-en-place.html#tables-and-graphs"><i class="fa fa-check"></i><b>5.1.1</b> Tables and graphs</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="mise-en-place.html"><a href="mise-en-place.html#r-projects"><i class="fa fa-check"></i><b>5.2</b> R Projects</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mise-en-place.html"><a href="mise-en-place.html#folders"><i class="fa fa-check"></i><b>5.2.1</b> Folders</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mise-en-place.html"><a href="mise-en-place.html#modular-r-scripts"><i class="fa fa-check"></i><b>5.3</b> Modular R scripts</a></li>
<li class="chapter" data-level="5.4" data-path="mise-en-place.html"><a href="mise-en-place.html#modular-code"><i class="fa fa-check"></i><b>5.4</b> Modular code</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mise-en-place.html"><a href="mise-en-place.html#section-labels"><i class="fa fa-check"></i><b>5.4.1</b> Section labels</a></li>
<li class="chapter" data-level="5.4.2" data-path="mise-en-place.html"><a href="mise-en-place.html#helper-r-scripts"><i class="fa fa-check"></i><b>5.4.2</b> Helper R scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="collaboration.html"><a href="collaboration.html"><i class="fa fa-check"></i><b>6</b> Collaboration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="collaboration.html"><a href="collaboration.html#code-review"><i class="fa fa-check"></i><b>6.1</b> Code review</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="collaboration.html"><a href="collaboration.html#style-guidelines"><i class="fa fa-check"></i><b>6.1.1</b> Style guidelines</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="collaboration.html"><a href="collaboration.html#documentation"><i class="fa fa-check"></i><b>6.2</b> Documentation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="collaboration.html"><a href="collaboration.html#comments"><i class="fa fa-check"></i><b>6.2.1</b> Comments</a></li>
<li class="chapter" data-level="6.2.2" data-path="collaboration.html"><a href="collaboration.html#vignettes"><i class="fa fa-check"></i><b>6.2.2</b> Vignettes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>7</b> R Markdown</a>
<ul>
<li class="chapter" data-level="7.1" data-path="r-markdown.html"><a href="r-markdown.html#code-1"><i class="fa fa-check"></i><b>7.1</b> Code</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="r-markdown.html"><a href="r-markdown.html#hiding-code-in-the-output"><i class="fa fa-check"></i><b>7.1.1</b> Hiding code in the output</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="r-markdown.html"><a href="r-markdown.html#inline-code"><i class="fa fa-check"></i><b>7.2</b> Inline Code</a></li>
<li class="chapter" data-level="7.3" data-path="r-markdown.html"><a href="r-markdown.html#tables"><i class="fa fa-check"></i><b>7.3</b> Tables</a></li>
<li class="chapter" data-level="7.4" data-path="r-markdown.html"><a href="r-markdown.html#footnotes"><i class="fa fa-check"></i><b>7.4</b> Footnotes</a></li>
<li class="chapter" data-level="7.5" data-path="r-markdown.html"><a href="r-markdown.html#citation"><i class="fa fa-check"></i><b>7.5</b> Citation</a></li>
<li class="chapter" data-level="7.6" data-path="r-markdown.html"><a href="r-markdown.html#spell-check"><i class="fa fa-check"></i><b>7.6</b> Spell check</a></li>
<li class="chapter" data-level="7.7" data-path="r-markdown.html"><a href="r-markdown.html#making-the-output-file"><i class="fa fa-check"></i><b>7.7</b> Making the output file</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tests.html"><a href="tests.html"><i class="fa fa-check"></i><b>8</b> Testing your code</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tests.html"><a href="tests.html#why-test-your-code"><i class="fa fa-check"></i><b>8.1</b> Why test your code?</a></li>
<li class="chapter" data-level="8.2" data-path="tests.html"><a href="tests.html#unit-tests"><i class="fa fa-check"></i><b>8.2</b> Unit tests</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tests.html"><a href="tests.html#modular-test-scripts"><i class="fa fa-check"></i><b>8.2.1</b> Modular test scripts</a></li>
<li class="chapter" data-level="8.2.2" data-path="tests.html"><a href="tests.html#how-to-write-unit-tests"><i class="fa fa-check"></i><b>8.2.2</b> How to write unit tests</a></li>
<li class="chapter" data-level="8.2.3" data-path="tests.html"><a href="tests.html#what-to-test"><i class="fa fa-check"></i><b>8.2.3</b> What to test</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tests.html"><a href="tests.html#test-driven-development-tdd"><i class="fa fa-check"></i><b>8.3</b> Test-driven development (TDD)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>9</b> Git</a>
<ul>
<li class="chapter" data-level="9.1" data-path="git.html"><a href="git.html#what-is-git-and-why-do-i-need-it"><i class="fa fa-check"></i><b>9.1</b> What is Git, and why do I need it?</a></li>
<li class="chapter" data-level="9.2" data-path="git.html"><a href="git.html#git-basics"><i class="fa fa-check"></i><b>9.2</b> Git basics</a></li>
<li class="chapter" data-level="9.3" data-path="git.html"><a href="git.html#using-git"><i class="fa fa-check"></i><b>9.3</b> Using Git</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="git.html"><a href="git.html#setting-up-git"><i class="fa fa-check"></i><b>9.3.1</b> Setting up Git</a></li>
<li class="chapter" data-level="9.3.2" data-path="git.html"><a href="git.html#setting-up-github"><i class="fa fa-check"></i><b>9.3.2</b> Setting up GitHub</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="git.html"><a href="git.html#setting-up-git-on-an-already-made-r-project"><i class="fa fa-check"></i><b>9.4</b> Setting up Git on an already-made R Project</a></li>
<li class="chapter" data-level="9.5" data-path="git.html"><a href="git.html#using-git-through-rstudio"><i class="fa fa-check"></i><b>9.5</b> Using Git through RStudio</a></li>
<li class="chapter" data-level="9.6" data-path="git.html"><a href="git.html#when-to-commit"><i class="fa fa-check"></i><b>9.6</b> When to commit</a></li>
<li class="chapter" data-level="9.7" data-path="git.html"><a href="git.html#other-resources"><i class="fa fa-check"></i><b>9.7</b> Other resources</a></li>
</ul></li>
<li class="part"><span><b>III Clean</b></span></li>
<li class="chapter" data-level="10" data-path="subsetting-intro.html"><a href="subsetting-intro.html"><i class="fa fa-check"></i><b>10</b> Subsetting: Making big things small</a>
<ul>
<li class="chapter" data-level="10.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-values"><i class="fa fa-check"></i><b>10.1</b> Select specific values</a></li>
<li class="chapter" data-level="10.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#logical-values-and-operations"><i class="fa fa-check"></i><b>10.2</b> Logical values and operations</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-a-single-value"><i class="fa fa-check"></i><b>10.2.1</b> Matching a single value</a></li>
<li class="chapter" data-level="10.2.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-multiple-values"><i class="fa fa-check"></i><b>10.2.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="10.2.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#does-not-match"><i class="fa fa-check"></i><b>10.2.3</b> Does not match</a></li>
<li class="chapter" data-level="10.2.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>10.2.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="10.2.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>10.2.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>10.3</b> Subsetting a data.frame</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-columns"><i class="fa fa-check"></i><b>10.3.1</b> Select specific columns</a></li>
<li class="chapter" data-level="10.3.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-rows"><i class="fa fa-check"></i><b>10.3.2</b> Select specific rows</a></li>
<li class="chapter" data-level="10.3.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subset-colorado-data"><i class="fa fa-check"></i><b>10.3.3</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="explore.html"><a href="explore.html"><i class="fa fa-check"></i><b>11</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="explore.html"><a href="explore.html#summary-and-table"><i class="fa fa-check"></i><b>11.1</b> Summary and Table</a></li>
<li class="chapter" data-level="11.2" data-path="explore.html"><a href="explore.html#graphing-1"><i class="fa fa-check"></i><b>11.2</b> Graphing</a></li>
<li class="chapter" data-level="11.3" data-path="explore.html"><a href="explore.html#aggregate"><i class="fa fa-check"></i><b>11.3</b> Aggregating (summaries of groups)</a></li>
<li class="chapter" data-level="11.4" data-path="explore.html"><a href="explore.html#dplyr-pipes"><i class="fa fa-check"></i><b>11.4</b> Pipes in <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>12</b> Regular Expressions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>12.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="12.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>12.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="12.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>12.3</b> Useful special characters</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>12.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="12.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>12.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="12.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>12.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="12.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string"><i class="fa fa-check"></i><b>12.3.4</b> Start of string</a></li>
<li class="chapter" data-level="12.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>12.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="12.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>12.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="12.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>12.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="12.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>12.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="12.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>12.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="12.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>12.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="12.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>12.3.11</b> Optional text <code>?</code></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>12.4</b> Changing capitalization</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="reshaping.html"><a href="reshaping.html"><i class="fa fa-check"></i><b>13</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="reshaping.html"><a href="reshaping.html#reshaping-a-single-column"><i class="fa fa-check"></i><b>13.1</b> Reshaping a single column</a></li>
<li class="chapter" data-level="13.2" data-path="reshaping.html"><a href="reshaping.html#reshaping-multiple-columns"><i class="fa fa-check"></i><b>13.2</b> Reshaping multiple columns</a></li>
</ul></li>
<li class="part"><span><b>IV Visualize</b></span></li>
<li class="chapter" data-level="14" data-path="graphing-intro.html"><a href="graphing-intro.html"><i class="fa fa-check"></i><b>14</b> Graphing with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="14.1" data-path="graphing-intro.html"><a href="graphing-intro.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>14.1</b> What does the data look like?</a></li>
<li class="chapter" data-level="14.2" data-path="graphing-intro.html"><a href="graphing-intro.html#graphing-data"><i class="fa fa-check"></i><b>14.2</b> Graphing data</a></li>
<li class="chapter" data-level="14.3" data-path="graphing-intro.html"><a href="graphing-intro.html#time-series-plots"><i class="fa fa-check"></i><b>14.3</b> Time-series plots</a></li>
<li class="chapter" data-level="14.4" data-path="graphing-intro.html"><a href="graphing-intro.html#scatter-plots"><i class="fa fa-check"></i><b>14.4</b> Scatter plots</a></li>
<li class="chapter" data-level="14.5" data-path="graphing-intro.html"><a href="graphing-intro.html#color-blindness"><i class="fa fa-check"></i><b>14.5</b> Color blindness</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ois-graphs.html"><a href="ois-graphs.html"><i class="fa fa-check"></i><b>15</b> More graphing with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="15.1" data-path="ois-graphs.html"><a href="ois-graphs.html#exploring-data"><i class="fa fa-check"></i><b>15.1</b> Exploring data</a></li>
<li class="chapter" data-level="15.2" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-a-single-numeric-variable"><i class="fa fa-check"></i><b>15.2</b> Graphing a single numeric variable</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="ois-graphs.html"><a href="ois-graphs.html#histogram"><i class="fa fa-check"></i><b>15.2.1</b> Histogram</a></li>
<li class="chapter" data-level="15.2.2" data-path="ois-graphs.html"><a href="ois-graphs.html#density-plot"><i class="fa fa-check"></i><b>15.2.2</b> Density plot</a></li>
<li class="chapter" data-level="15.2.3" data-path="ois-graphs.html"><a href="ois-graphs.html#count-graph"><i class="fa fa-check"></i><b>15.2.3</b> Count graph</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-a-categorical-variable"><i class="fa fa-check"></i><b>15.3</b> Graphing a categorical variable</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="ois-graphs.html"><a href="ois-graphs.html#bar-graph"><i class="fa fa-check"></i><b>15.3.1</b> Bar graph</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-data-over-time"><i class="fa fa-check"></i><b>15.4</b> Graphing data over time</a></li>
<li class="chapter" data-level="15.5" data-path="ois-graphs.html"><a href="ois-graphs.html#pretty-graphs"><i class="fa fa-check"></i><b>15.5</b> Pretty graphs</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="ois-graphs.html"><a href="ois-graphs.html#themes"><i class="fa fa-check"></i><b>15.5.1</b> Themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>16</b> Hotspot maps</a>
<ul>
<li class="chapter" data-level="16.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#a-simple-map"><i class="fa fa-check"></i><b>16.1</b> A simple map</a></li>
<li class="chapter" data-level="16.2" data-path="hotspot-maps.html"><a href="hotspot-maps.html#what-really-are-maps"><i class="fa fa-check"></i><b>16.2</b> What really are maps?</a></li>
<li class="chapter" data-level="16.3" data-path="hotspot-maps.html"><a href="hotspot-maps.html#making-a-hotspot-map"><i class="fa fa-check"></i><b>16.3</b> Making a hotspot map</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#colors"><i class="fa fa-check"></i><b>16.3.1</b> Colors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>17</b> Choropleth maps</a>
<ul>
<li class="chapter" data-level="17.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>17.1</b> Spatial joins</a></li>
<li class="chapter" data-level="17.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>17.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>18</b> Interactive maps</a>
<ul>
<li class="chapter" data-level="18.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>18.1</b> Why do interactive graphs matter?</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>18.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="18.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>18.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>18.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="18.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>18.3</b> Adding popup information</a></li>
<li class="chapter" data-level="18.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>18.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="18.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-choropleth-maps"><i class="fa fa-check"></i><b>18.5</b> Interactive choropleth maps</a></li>
</ul></li>
<li class="part"><span><b>V Collect</b></span></li>
<li class="chapter" data-level="19" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>19</b> Webscraping with <code>rvest</code></a>
<ul>
<li class="chapter" data-level="19.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>19.1</b> Scraping one page</a></li>
<li class="chapter" data-level="19.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>19.2</b> Cleaning the webscraped data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>20</b> Functions</a>
<ul>
<li class="chapter" data-level="20.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>20.1</b> A simple function</a></li>
<li class="chapter" data-level="20.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>20.2</b> Adding parameters</a></li>
<li class="chapter" data-level="20.3" data-path="functions.html"><a href="functions.html#recipes-function"><i class="fa fa-check"></i><b>20.3</b> Making a function to scrape recipes</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>21</b> For loops</a>
<ul>
<li class="chapter" data-level="21.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>21.1</b> Basic for loops</a></li>
<li class="chapter" data-level="21.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-recipes"><i class="fa fa-check"></i><b>21.2</b> Scraping multiple recipes</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="scrape-table.html"><a href="scrape-table.html"><i class="fa fa-check"></i><b>22</b> Scraping tables from PDFs</a>
<ul>
<li class="chapter" data-level="22.1" data-path="scrape-table.html"><a href="scrape-table.html#scraping-the-first-table"><i class="fa fa-check"></i><b>22.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="22.2" data-path="scrape-table.html"><a href="scrape-table.html#making-a-function"><i class="fa fa-check"></i><b>22.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="scrape-table2.html"><a href="scrape-table2.html"><i class="fa fa-check"></i><b>23</b> More scraping tables from PDFs</a>
<ul>
<li class="chapter" data-level="23.1" data-path="scrape-table2.html"><a href="scrape-table2.html#texas-jail-data"><i class="fa fa-check"></i><b>23.1</b> Texas jail data</a></li>
<li class="chapter" data-level="23.2" data-path="scrape-table2.html"><a href="scrape-table2.html#pregnant-women-incarcerated"><i class="fa fa-check"></i><b>23.2</b> Pregnant women incarcerated</a></li>
<li class="chapter" data-level="23.3" data-path="scrape-table2.html"><a href="scrape-table2.html#making-pdf-scraped-data-available-to-others"><i class="fa fa-check"></i><b>23.3</b> Making PDF-scraped data available to others</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>24</b> Geocoding</a>
<ul>
<li class="chapter" data-level="24.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>24.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="24.2" data-path="geocoding.html"><a href="geocoding.html#geocoding-san-francisco-marijuana-dispensary-locations"><i class="fa fa-check"></i><b>24.2</b> Geocoding San Francisco marijuana dispensary locations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime by the Numbers: A Criminologist’s Guide to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="choropleth-maps" class="section level1 hasAnchor" number="17">
<h1><span class="header-section-number">17</span> Choropleth maps<a href="choropleth-maps.html#choropleth-maps" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>For this chapter you’ll need the following files, which are available for download <a href="https://github.com/jacobkap/crimebythenumbers/tree/master/data">here</a>: san_francisco_suicide_2003_2017.csv, san_francisco_neighborhoods.dbf, san_francisco_neighborhoods.prj, san_francisco_neighborhoods.shp, san_francisco_neighborhoods.shx.</p>
<p>In Chapter <a href="hotspot-maps.html#hotspot-maps">16</a> we made hotspot maps to show which areas in San Francisco had the most suicides. We made the maps in a number of ways and consistently found that suicides were most prevalent in northeast San Francisco. In this chapter we will make choropleth maps, which are shaded maps where each “unit” is some known geographic area, such as a state or neighborhood. Think of election maps where states are colored blue when a Democratic candidate wins that state and red when a Republican candidate wins. These are choropleth maps - each state is colored to indicate something. In this chapter we will continue to work on the suicide data and make choropleth maps shaded by the number of suicides in each neighborhood (we will define this later in the chapter) in the city.</p>
<p>Since we will be working more on the suicide data from San Francisco, let’s read it in now.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="choropleth-maps.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb312-2"><a href="choropleth-maps.html#cb312-2" aria-hidden="true" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/san_francisco_suicide_2003_2017.csv&quot;</span>)</span>
<span id="cb312-3"><a href="choropleth-maps.html#cb312-3" aria-hidden="true" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(suicide)</span></code></pre></div>
<p>The package that we will use to handle geographic data and do most of the work in this chapter is <code>sf</code>. <code>sf</code> is a sophisticated package and does far more than what we will cover in this chapter. For more information about the package’s features please see the website for it <a href="http://r-spatial.github.io/sf/">here.</a></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="choropleth-maps.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="choropleth-maps.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb314-2"><a href="choropleth-maps.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Warning: package &#39;sf&#39; was built under R version 4.2.2</span></span>
<span id="cb314-3"><a href="choropleth-maps.html#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Linking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE</span></span></code></pre></div>
<p>For this chapter we will need to read in a shapefile that depicts the boundaries of each neighborhood in San Francisco. A shapefile is similar to a data.frame but has information on how to draw a geographic boundary such as a state. The way <code>sf</code> reads in the shapefiles is through the <code>st_read()</code> function. Our input inside the () is a string with the name of the “.shp” file we want to read in (since we are telling R to read a file on the computer rather than an object that exists, it needs to be in quotes). This shapefile contains neighborhoods in San Francisco so we’ll call the object <em>sf_neighborhoods</em>.</p>
<p>I downloaded this data from San Francisco’s Open Data site <a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Analysis-Neighborhoods/p5b7-5n3h">here,</a> selecting the Shapefile format in the Export tab. If you do so yourself it’ll give you a zip file with multiple files in there. This is normal with shapefiles, you will have multiple files and only read in the file with the “.shp” extension to R. We still <strong>do</strong> need all of the files, and <code>st_read()</code> is using them even if not explicitly called. So make sure every file downloaded is in the same working directory as the .shp file. The files from this site had hard-to-read file names, so I relabeled them all as “san_francisco_neighborhoods” though that doesn’t matter once it’s read into R.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="choropleth-maps.html#cb315-1" aria-hidden="true" tabindex="-1"></a>sf_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/san_francisco_neighborhoods.shp&quot;</span>,</span>
<span id="cb315-2"><a href="choropleth-maps.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb315-3"><a href="choropleth-maps.html#cb315-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>As usual when dealing with a new data set, let’s look at the first 6 rows.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="choropleth-maps.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sf_neighborhoods)</span>
<span id="cb316-2"><a href="choropleth-maps.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple feature collection with 6 features and 1 field</span></span>
<span id="cb316-3"><a href="choropleth-maps.html#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Geometry type: MULTIPOLYGON</span></span>
<span id="cb316-4"><a href="choropleth-maps.html#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dimension:     XY</span></span>
<span id="cb316-5"><a href="choropleth-maps.html#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box:  xmin: -122.4543 ymin: 37.70822 xmax: -122.357 ymax: 37.80602</span></span>
<span id="cb316-6"><a href="choropleth-maps.html#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Geodetic CRS:  WGS84(DD)</span></span>
<span id="cb316-7"><a href="choropleth-maps.html#cb316-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                            nhood                       geometry</span></span>
<span id="cb316-8"><a href="choropleth-maps.html#cb316-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1          Bayview Hunters Point MULTIPOLYGON (((-122.3816 3...</span></span>
<span id="cb316-9"><a href="choropleth-maps.html#cb316-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                 Bernal Heights MULTIPOLYGON (((-122.4036 3...</span></span>
<span id="cb316-10"><a href="choropleth-maps.html#cb316-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            Castro/Upper Market MULTIPOLYGON (((-122.4266 3...</span></span>
<span id="cb316-11"><a href="choropleth-maps.html#cb316-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                      Chinatown MULTIPOLYGON (((-122.4062 3...</span></span>
<span id="cb316-12"><a href="choropleth-maps.html#cb316-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                      Excelsior MULTIPOLYGON (((-122.424 37...</span></span>
<span id="cb316-13"><a href="choropleth-maps.html#cb316-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Financial District/South Beach MULTIPOLYGON (((-122.3875 3...</span></span></code></pre></div>
<p>The last column is important. In shapefiles, the “geometry” column is the one with the instructions to make the map. This data has a single row for each neighborhood in the city. So the “geometry” column in each row has a list of coordinates, which, if connected in order, make up that neighborhood. Since the “geometry” column contains the instructions to map, we can <code>plot()</code> it to show a map of the data.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="choropleth-maps.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf_neighborhoods<span class="sc">$</span>geometry)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-415-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>Here we have a map of San Francisco broken up into neighborhoods. Is this a perfect representation of the neighborhoods in San Francisco? No. It is simply the city’s attempt to create definitions of neighborhoods. Indeed, you’re likely to find that areas at the border of neighborhoods are more similar to each other than they are to areas at the opposite side of their designated neighborhood. You can read a bit about how San Francisco determined the neighborhood boundaries <a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Analysis-Neighborhoods/p5b7-5n3h">here,</a> but know that this, like all geographic areas that someone has designated, has some degree of inaccuracy and arbitrariness in it. Like many things in criminology, this is just another limitation we will have to keep in mind.</p>
<p>In the <code>head()</code> results there was a section about something called “epsg” and “proj4string.” Let’s talk about that specifically since they are important for working with spatial data.</p>
<p>An issue with working with geographic data is that <a href="https://en.wikipedia.org/wiki/Spherical_Earth">the Earth is not flat.</a> Since the Earth is spherical, there will always be some distortion when trying to plot the data on a flat surface such as a map. To account for this, we need to transform the longitude and latitude values we have to work properly on a map. We do so by “projecting” our data onto the areas of the Earth we want. This is a complex field with lots of work done on it (both abstractly and for R specifically) so this chapter will be an extremely brief overview of the topic and oversimplify some aspects of it.</p>
<p>If we look at the output of <code>st_crs(sf_neighborhoods)</code> we can see that the EPSG is set to 4326 and the proj4string (which tells us the current map projection) is “+proj=longlat +datum=WGS84 +no_defs”. This CRS, WGS84, is a standard CRS and is the one used whenever you use a GPS to find a location. To find the CRS for certain parts of the world see <a href="https://spatialreference.org/">here.</a> If you search that site for “California,” you’ll see that California is broken into 6 zones. The site isn’t that helpful on which zones are which, but some Googling can often find state or region maps with the zones depicted there. We want California zone 3, which has the EPSG code 2227. We’ll use this code to project this data properly.</p>
<p>If we want to get the proj4string for 2227 we can run <code>st_crs(2227)</code>. I’m not running it here because it will print out a large amount of text, but you should run it on your own computer. Note the text in text in this output includes “US survey foot.” This means that the units are in feet. Some projections have units in meters so be mindful of this when doing some analysis, such as seeing if a point is within X feet of a certain area.</p>
<p>Let’s convert our sf_neighborhoods data to coordinate reference system 2227 using <code>st_transform()</code>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="choropleth-maps.html#cb318-1" aria-hidden="true" tabindex="-1"></a>sf_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sf_neighborhoods, <span class="at">crs =</span> <span class="dv">2227</span>)</span>
<span id="cb318-2"><a href="choropleth-maps.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sf_neighborhoods)</span></code></pre></div>
<p><img src="images/choropleth.PNG" width="100%" height="100%"  style="display: block; margin: auto;" /></p>
<div id="spatial-joins" class="section level2 hasAnchor" number="17.1">
<h2><span class="header-section-number">17.1</span> Spatial joins<a href="choropleth-maps.html#spatial-joins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What we want to do with these neighborhoods is to find out which neighborhood each suicide occurred in and sum up the number of suicides per neighborhood. Once we do that, we can make a map at the neighborhood level and be able to measure suicides per neighborhood. A spatial join is very similar to regular joins where we merge two data sets based on common variables (such as state name or unique ID code of a person). In this case it merges based on some shared geographic feature such as if two lines intersect or (as we will do so here) if a point is within some geographic area.</p>
<p>Right now our <em>suicide</em> data is in a data.frame with some info on each suicide and the longitude and latitude of the suicide in separate columns. We want to turn this data.frame into a spatial object to allow us to find which neighborhood each suicide happened in. We can convert it into a spatial object using the <code>st_as_sf()</code> function from <code>sf</code>. Our input is first our data, <em>suicide.</em> Then in the <code>coords</code> parameter we put a vector of the column names so the function knows which columns the longitude and latitude columns are so it can convert those columns to a “geometry” column like we saw in <em>sf_neighborhoods</em> earlier. We’ll set the CRS to be the WGS84 standard we saw earlier, but we will change it to match the CRS that the neighborhood data has.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="choropleth-maps.html#cb319-1" aria-hidden="true" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(suicide,</span>
<span id="cb319-2"><a href="choropleth-maps.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>),</span>
<span id="cb319-3"><a href="choropleth-maps.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="st">&quot;+proj=longlat +ellps=WGS84 +no_defs&quot;</span></span>
<span id="cb319-4"><a href="choropleth-maps.html#cb319-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We want our suicides data in the same projection as the neighborhoods data so we need to use <code>st_transform()</code> to change the projection. Since we want the CRS to be the same as in <em>sf_neighborhoods</em>, we can set it using <code>st_crs(sf_neighborhoods)</code> to use the right CRS.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="choropleth-maps.html#cb320-1" aria-hidden="true" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(suicide,</span>
<span id="cb320-2"><a href="choropleth-maps.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="fu">st_crs</span>(sf_neighborhoods)</span>
<span id="cb320-3"><a href="choropleth-maps.html#cb320-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now we can take a look at <code>head()</code> to see if it was projected.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="choropleth-maps.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(suicide)</span>
<span id="cb321-2"><a href="choropleth-maps.html#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple feature collection with 6 features and 12 fields</span></span>
<span id="cb321-3"><a href="choropleth-maps.html#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Geometry type: POINT</span></span>
<span id="cb321-4"><a href="choropleth-maps.html#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dimension:     XY</span></span>
<span id="cb321-5"><a href="choropleth-maps.html#cb321-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box:  xmin: -122.4893 ymin: 37.72218 xmax: -122.3964 ymax: 37.79414</span></span>
<span id="cb321-6"><a href="choropleth-maps.html#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Geodetic CRS:  WGS84(DD)</span></span>
<span id="cb321-7"><a href="choropleth-maps.html#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   IncidntNum Category                           Descript DayOfWeek       Date     Time PdDistrict</span></span>
<span id="cb321-8"><a href="choropleth-maps.html#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  180318931  SUICIDE ATTEMPTED SUICIDE BY STRANGULATION    Monday 04/30/2018 06:30:00    TARAVAL</span></span>
<span id="cb321-9"><a href="choropleth-maps.html#cb321-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2  180315501  SUICIDE       ATTEMPTED SUICIDE BY JUMPING  Saturday 04/28/2018 17:54:00   NORTHERN</span></span>
<span id="cb321-10"><a href="choropleth-maps.html#cb321-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  180295674  SUICIDE              SUICIDE BY LACERATION  Saturday 04/21/2018 12:20:00   RICHMOND</span></span>
<span id="cb321-11"><a href="choropleth-maps.html#cb321-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4  180263659  SUICIDE                            SUICIDE   Tuesday 04/10/2018 05:13:00    CENTRAL</span></span>
<span id="cb321-12"><a href="choropleth-maps.html#cb321-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 5  180235523  SUICIDE     ATTEMPTED SUICIDE BY INGESTION    Friday 03/30/2018 09:15:00    TARAVAL</span></span>
<span id="cb321-13"><a href="choropleth-maps.html#cb321-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 6  180236515  SUICIDE            SUICIDE BY ASPHYXIATION  Thursday 03/29/2018 17:30:00   RICHMOND</span></span>
<span id="cb321-14"><a href="choropleth-maps.html#cb321-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   Resolution                 Address                                       Location         PdId year</span></span>
<span id="cb321-15"><a href="choropleth-maps.html#cb321-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1       NONE     0 Block of BRUCE AV  POINT (-122.45168059935614 37.72218061554315) 1.803189e+13 2018</span></span>
<span id="cb321-16"><a href="choropleth-maps.html#cb321-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2       NONE   700 Block of HAYES ST  POINT (-122.42876060987851 37.77620120112792) 1.803155e+13 2018</span></span>
<span id="cb321-17"><a href="choropleth-maps.html#cb321-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3       NONE   3700 Block of CLAY ST   POINT (-122.45462091999406 37.7881754224736) 1.802957e+13 2018</span></span>
<span id="cb321-18"><a href="choropleth-maps.html#cb321-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4       NONE     0 Block of DRUMM ST  POINT (-122.39642194376758 37.79414474237039) 1.802637e+13 2018</span></span>
<span id="cb321-19"><a href="choropleth-maps.html#cb321-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 5       NONE 0 Block of FAIRFIELD WY  POINT (-122.46324153155875 37.72679184368551) 1.802355e+13 2018</span></span>
<span id="cb321-20"><a href="choropleth-maps.html#cb321-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 6       NONE    300 Block of 29TH AV POINT (-122.48929119750689 37.782735835121265) 1.802365e+13 2018</span></span>
<span id="cb321-21"><a href="choropleth-maps.html#cb321-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                     geometry</span></span>
<span id="cb321-22"><a href="choropleth-maps.html#cb321-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 POINT (-122.4517 37.72218)</span></span>
<span id="cb321-23"><a href="choropleth-maps.html#cb321-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2  POINT (-122.4288 37.7762)</span></span>
<span id="cb321-24"><a href="choropleth-maps.html#cb321-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 POINT (-122.4546 37.78818)</span></span>
<span id="cb321-25"><a href="choropleth-maps.html#cb321-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 POINT (-122.3964 37.79414)</span></span>
<span id="cb321-26"><a href="choropleth-maps.html#cb321-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 POINT (-122.4632 37.72679)</span></span>
<span id="cb321-27"><a href="choropleth-maps.html#cb321-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 POINT (-122.4893 37.78274)</span></span></code></pre></div>
<p>We can see it is now a “simple feature collection” with the correct projection. And we can see there is a new column called “geometry” just like in <em>sf_neighborhoods</em>. The type of data in “geometry” is POINT since our data is just a single location instead of a polygon like in the neighborhoods data.</p>
<p>Since we have both the neighborhoods and the suicides data let’s make a quick map to see the data.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="choropleth-maps.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf_neighborhoods<span class="sc">$</span>geometry)</span>
<span id="cb322-2"><a href="choropleth-maps.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(suicide<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-421-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>Our next step is to combine these two data sets to figure out how many suicides occurred in each neighborhood. This will be a multi-step process so let’s plan it out before beginning. Our suicide data is one row for each suicide; our neighborhood data is one row for each neighborhood. Since our goal is to map at the neighborhood-level we need to get the neighborhood where each suicide occurred then aggregate up to the neighborhood-level to get a count of the suicides-per-neighborhood. Then we need to combine that with the original neighborhood data, and we can map it.</p>
<ol style="list-style-type: decimal">
<li>Find which neighborhood each suicide happened in</li>
<li>Aggregate suicide data until we get one row per neighborhood and a column showing the number of suicides in that neighborhood</li>
<li>Combine with the neighborhood data</li>
<li>Make a map</li>
</ol>
<p>We’ll start by finding the neighborhood where each suicide occurred using the function <code>st_join()</code>, which is a function in <code>sf</code>. This does a spatial join and finds the polygon (neighborhood in our case) where each point is located in. Since we will be aggregating the data, let’s call the output of this function <em>suicide_agg</em>. The order in the () is important! For our aggregation we want the output to be at the suicide-level so we start with the <em>suicide</em> data. In the next step we’ll see why this matters.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="choropleth-maps.html#cb323-1" aria-hidden="true" tabindex="-1"></a>suicide_agg <span class="ot">&lt;-</span> <span class="fu">st_join</span>(suicide, sf_neighborhoods)</span></code></pre></div>
<p>Let’s look at the first 6 rows.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="choropleth-maps.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(suicide_agg)</span>
<span id="cb324-2"><a href="choropleth-maps.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple feature collection with 6 features and 13 fields</span></span>
<span id="cb324-3"><a href="choropleth-maps.html#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Geometry type: POINT</span></span>
<span id="cb324-4"><a href="choropleth-maps.html#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dimension:     XY</span></span>
<span id="cb324-5"><a href="choropleth-maps.html#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box:  xmin: -122.4893 ymin: 37.72218 xmax: -122.3964 ymax: 37.79414</span></span>
<span id="cb324-6"><a href="choropleth-maps.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Geodetic CRS:  WGS84(DD)</span></span>
<span id="cb324-7"><a href="choropleth-maps.html#cb324-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   IncidntNum Category                           Descript DayOfWeek       Date     Time PdDistrict</span></span>
<span id="cb324-8"><a href="choropleth-maps.html#cb324-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  180318931  SUICIDE ATTEMPTED SUICIDE BY STRANGULATION    Monday 04/30/2018 06:30:00    TARAVAL</span></span>
<span id="cb324-9"><a href="choropleth-maps.html#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2  180315501  SUICIDE       ATTEMPTED SUICIDE BY JUMPING  Saturday 04/28/2018 17:54:00   NORTHERN</span></span>
<span id="cb324-10"><a href="choropleth-maps.html#cb324-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  180295674  SUICIDE              SUICIDE BY LACERATION  Saturday 04/21/2018 12:20:00   RICHMOND</span></span>
<span id="cb324-11"><a href="choropleth-maps.html#cb324-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4  180263659  SUICIDE                            SUICIDE   Tuesday 04/10/2018 05:13:00    CENTRAL</span></span>
<span id="cb324-12"><a href="choropleth-maps.html#cb324-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 5  180235523  SUICIDE     ATTEMPTED SUICIDE BY INGESTION    Friday 03/30/2018 09:15:00    TARAVAL</span></span>
<span id="cb324-13"><a href="choropleth-maps.html#cb324-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 6  180236515  SUICIDE            SUICIDE BY ASPHYXIATION  Thursday 03/29/2018 17:30:00   RICHMOND</span></span>
<span id="cb324-14"><a href="choropleth-maps.html#cb324-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   Resolution                 Address                                       Location         PdId year</span></span>
<span id="cb324-15"><a href="choropleth-maps.html#cb324-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1       NONE     0 Block of BRUCE AV  POINT (-122.45168059935614 37.72218061554315) 1.803189e+13 2018</span></span>
<span id="cb324-16"><a href="choropleth-maps.html#cb324-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2       NONE   700 Block of HAYES ST  POINT (-122.42876060987851 37.77620120112792) 1.803155e+13 2018</span></span>
<span id="cb324-17"><a href="choropleth-maps.html#cb324-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3       NONE   3700 Block of CLAY ST   POINT (-122.45462091999406 37.7881754224736) 1.802957e+13 2018</span></span>
<span id="cb324-18"><a href="choropleth-maps.html#cb324-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4       NONE     0 Block of DRUMM ST  POINT (-122.39642194376758 37.79414474237039) 1.802637e+13 2018</span></span>
<span id="cb324-19"><a href="choropleth-maps.html#cb324-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 5       NONE 0 Block of FAIRFIELD WY  POINT (-122.46324153155875 37.72679184368551) 1.802355e+13 2018</span></span>
<span id="cb324-20"><a href="choropleth-maps.html#cb324-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 6       NONE    300 Block of 29TH AV POINT (-122.48929119750689 37.782735835121265) 1.802365e+13 2018</span></span>
<span id="cb324-21"><a href="choropleth-maps.html#cb324-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                            nhood                   geometry</span></span>
<span id="cb324-22"><a href="choropleth-maps.html#cb324-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 1     Oceanview/Merced/Ingleside POINT (-122.4517 37.72218)</span></span>
<span id="cb324-23"><a href="choropleth-maps.html#cb324-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                   Hayes Valley  POINT (-122.4288 37.7762)</span></span>
<span id="cb324-24"><a href="choropleth-maps.html#cb324-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3               Presidio Heights POINT (-122.4546 37.78818)</span></span>
<span id="cb324-25"><a href="choropleth-maps.html#cb324-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Financial District/South Beach POINT (-122.3964 37.79414)</span></span>
<span id="cb324-26"><a href="choropleth-maps.html#cb324-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 5             West of Twin Peaks POINT (-122.4632 37.72679)</span></span>
<span id="cb324-27"><a href="choropleth-maps.html#cb324-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                 Outer Richmond POINT (-122.4893 37.78274)</span></span></code></pre></div>
<p>There is now the <em>nhood</em> column from the neighborhoods data, which says which neighborhood the suicide happened in. Now we can aggregate up to the neighborhood-level using <code>group_by()</code> and <code>summarize()</code> functions from the <code>dplyr</code> package.</p>
<p>We actually don’t have a variable with the number of suicides so we need to make that. We can simply call it <em>number_suicides</em> and give it the value of 1 since each row is only one suicide.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="choropleth-maps.html#cb325-1" aria-hidden="true" tabindex="-1"></a>suicide_agg<span class="sc">$</span>number_suicides <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Now we can aggregate the data and assign the results back into <em>suicide_agg</em>.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="choropleth-maps.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb326-2"><a href="choropleth-maps.html#cb326-2" aria-hidden="true" tabindex="-1"></a>suicide_agg <span class="ot">&lt;-</span> suicide_agg <span class="sc">%&gt;%</span></span>
<span id="cb326-3"><a href="choropleth-maps.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nhood) <span class="sc">%&gt;%</span></span>
<span id="cb326-4"><a href="choropleth-maps.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_suicides =</span> <span class="fu">sum</span>(number_suicides))</span></code></pre></div>
<p>Let’s check a summary of the <em>number_suicides</em> variable we made.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="choropleth-maps.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(suicide_agg<span class="sc">$</span>number_suicides)</span>
<span id="cb327-2"><a href="choropleth-maps.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb327-3"><a href="choropleth-maps.html#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    1.00   13.50   23.50   32.30   37.25  141.00</span></span></code></pre></div>
<p>The minimum is one suicide per neighborhood, 32 on average, and 141 in the neighborhood with the most suicides. So what do we make of this data? Well, there are some data issues that cause problems in these results. Let’s think about the minimum value. Did every single neighborhood in the city have at least one suicide? No. Take a look at the number of rows in this data, keeping in mind there should be one row per neighborhood.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="choropleth-maps.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(suicide_agg)</span>
<span id="cb328-2"><a href="choropleth-maps.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 40</span></span></code></pre></div>
<p>And let’s compare it to the <em>sf_neighborhoods</em> data.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="choropleth-maps.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(sf_neighborhoods)</span>
<span id="cb329-2"><a href="choropleth-maps.html#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 41</span></span></code></pre></div>
<p>The suicides data is missing 2 neighborhoods (one of the 40 values is missing and is NA, not a real neighborhood). That is because if no suicides occurred there, there would never be a matching row in the data so that neighborhood wouldn’t appear in the suicide data. That’s not going to be a major issue here but is something to keep in mind if this were a real research project.</p>
<p>The data is ready to merge with the <em>sf_neighborhoods</em> data. We’ll introduce a new function that makes merging data simple. This function also comes from the <code>dplyr</code> package.</p>
<p>The function we will use is <code>left_join()</code>, which takes two parameters, the two data sets to join together.</p>
<p><code>left_join(data1, data2)</code></p>
<p>This function joins these data and keeps all of the rows from the left data and every column from both data sets. It combines the data based on any matching columns (matching meaning same column name) in both data sets. Since in our data sets, the column <em>nhood</em> exists in both, it will merge the data based on that column.</p>
<p>There are two other functions that are similar but differ based on which rows they keep.</p>
<ul>
<li><code>left_join()</code> - All rows from Left data and all columns from Left and Right data</li>
<li><code>right_join()</code> - All rows from Right data and all columns from Left and Right data</li>
<li><code>full_join()</code> - All rows and all columns from Left and Right data</li>
</ul>
<p>We could alternatively use the <code>merge()</code> function, which is built into R, but that function is slower than the <code>dplyr</code> functions and requires us to manually set the matching columns.</p>
<p>We want to keep all rows in <em>sf_neighborhoods</em> (keep all neighborhoods) so we can use <code>left_join(sf_neighborhoods, suicide_agg)</code>. Let’s assign the results to a new data set called <em>sf_neighborhoods_suicide</em>.</p>
<p>We don’t need the spatial data for “suicide_agg” anymore, and it will cause problems with our join if we keep it, so let’s delete the “geometry” column from that data. We can do this by assigning the column the value of NULL.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="choropleth-maps.html#cb330-1" aria-hidden="true" tabindex="-1"></a>suicide_agg<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Now we can do our join.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="choropleth-maps.html#cb331-1" aria-hidden="true" tabindex="-1"></a>sf_neighborhoods_suicide <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sf_neighborhoods, suicide_agg)</span>
<span id="cb331-2"><a href="choropleth-maps.html#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining, by = &quot;nhood&quot;</span></span></code></pre></div>
<p>If we look at <code>summary()</code> again for <em>number_suicides</em> we can see that there are now two rows with NAs. These are the neighborhoods where there were no suicides so they weren’t present in the <em>suicide_agg</em> data.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="choropleth-maps.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sf_neighborhoods_suicide<span class="sc">$</span>number_suicides)</span>
<span id="cb332-2"><a href="choropleth-maps.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb332-3"><a href="choropleth-maps.html#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    1.00   15.00   24.00   33.08   38.50  141.00       2</span></span></code></pre></div>
<p>We need to convert these values to 0. We will use the <code>is.na()</code> function to conditionally find all rows with an NA value in the <em>number_suicides</em> column and use square bracket notation to change the value to 0.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="choropleth-maps.html#cb333-1" aria-hidden="true" tabindex="-1"></a>sf_neighborhoods_suicide<span class="sc">$</span>number_suicides[</span>
<span id="cb333-2"><a href="choropleth-maps.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(sf_neighborhoods_suicide<span class="sc">$</span>number_suicides)</span>
<span id="cb333-3"><a href="choropleth-maps.html#cb333-3" aria-hidden="true" tabindex="-1"></a>] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>Checking it again we see that the minimum is now 0 and the mean number of suicides decreases a bit to about 31.5 per neighborhood.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="choropleth-maps.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sf_neighborhoods_suicide<span class="sc">$</span>number_suicides)</span>
<span id="cb334-2"><a href="choropleth-maps.html#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb334-3"><a href="choropleth-maps.html#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    0.00   12.00   23.00   31.46   36.00  141.00</span></span></code></pre></div>
</div>
<div id="making-choropleth-maps" class="section level2 hasAnchor" number="17.2">
<h2><span class="header-section-number">17.2</span> Making choropleth maps<a href="choropleth-maps.html#making-choropleth-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Finally</strong> we are ready to make some choropleth maps.</p>
<p>For these maps we are going to use <code>ggplot2</code> again so we need to load it.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="choropleth-maps.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p><code>ggplot2</code>’s benefit is you can slowly build graphs or maps and improve the graph at every step. Earlier, we used functions such as <code>geom_line()</code> for line graphs and <code>geom_point()</code> for scatter plots. For mapping these polygons we will use <code>geom_sf()</code>, which knows how to handle spatial data.</p>
<p>As usual we will start with <code>ggplot()</code>, inputting our data first. Then inside of <code>aes</code> (the aesthetics of the graph/map) we use a new parameter <code>fill</code>. In <code>fill</code> we will put in the <em>number_suicides</em> column, and it will color the polygons (neighborhoods) based on values in that column. Then we can add the <code>geom_sf()</code>.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="choropleth-maps.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sf_neighborhoods_suicide, <span class="fu">aes</span>(<span class="at">fill =</span> number_suicides)) <span class="sc">+</span></span>
<span id="cb336-2"><a href="choropleth-maps.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-435-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>We have now created a choropleth map showing the number of suicides per neighborhood in San Francisco! Based on the legend, neighborhoods that are light blue have the most suicides while neighborhoods that are dark blue have the fewest (or none at all). Normally we’d want the opposite, with darker areas signifying a greater amount of whatever the map is showing.</p>
<p>We can use <code>scale_fill_gradient()</code> to set the colors to what we want. We input a color for low value and a color for high value, and it’ll make the map shade by those colors.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="choropleth-maps.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb337-2"><a href="choropleth-maps.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  sf_neighborhoods_suicide,</span>
<span id="cb337-3"><a href="choropleth-maps.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">fill =</span> number_suicides)</span>
<span id="cb337-4"><a href="choropleth-maps.html#cb337-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb337-5"><a href="choropleth-maps.html#cb337-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb337-6"><a href="choropleth-maps.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb337-7"><a href="choropleth-maps.html#cb337-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb337-8"><a href="choropleth-maps.html#cb337-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb337-9"><a href="choropleth-maps.html#cb337-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-436-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>This gives a much better map and clearly shows the areas where suicides are most common and where there were no suicides.</p>
<p>To make this map easier to read and look better, let’s add a title to the map and to the legend.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="choropleth-maps.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb338-2"><a href="choropleth-maps.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  sf_neighborhoods_suicide,</span>
<span id="cb338-3"><a href="choropleth-maps.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">fill =</span> number_suicides)</span>
<span id="cb338-4"><a href="choropleth-maps.html#cb338-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb338-5"><a href="choropleth-maps.html#cb338-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb338-6"><a href="choropleth-maps.html#cb338-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb338-7"><a href="choropleth-maps.html#cb338-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb338-8"><a href="choropleth-maps.html#cb338-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb338-9"><a href="choropleth-maps.html#cb338-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb338-10"><a href="choropleth-maps.html#cb338-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb338-11"><a href="choropleth-maps.html#cb338-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;# of suicides&quot;</span>,</span>
<span id="cb338-12"><a href="choropleth-maps.html#cb338-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Suicides in San Francisco, by neighborhood&quot;</span>,</span>
<span id="cb338-13"><a href="choropleth-maps.html#cb338-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;2003 - 2017&quot;</span></span>
<span id="cb338-14"><a href="choropleth-maps.html#cb338-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-437-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>Since the coordinates don’t add anything to the map, let’s get rid of them.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="choropleth-maps.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb339-2"><a href="choropleth-maps.html#cb339-2" aria-hidden="true" tabindex="-1"></a>  sf_neighborhoods_suicide,</span>
<span id="cb339-3"><a href="choropleth-maps.html#cb339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">fill =</span> number_suicides)</span>
<span id="cb339-4"><a href="choropleth-maps.html#cb339-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb339-5"><a href="choropleth-maps.html#cb339-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb339-6"><a href="choropleth-maps.html#cb339-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb339-7"><a href="choropleth-maps.html#cb339-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb339-8"><a href="choropleth-maps.html#cb339-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb339-9"><a href="choropleth-maps.html#cb339-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb339-10"><a href="choropleth-maps.html#cb339-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb339-11"><a href="choropleth-maps.html#cb339-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;# of suicides&quot;</span>,</span>
<span id="cb339-12"><a href="choropleth-maps.html#cb339-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Suicides in San Francisco, by neighborhood&quot;</span>,</span>
<span id="cb339-13"><a href="choropleth-maps.html#cb339-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;2003 - 2017&quot;</span></span>
<span id="cb339-14"><a href="choropleth-maps.html#cb339-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb339-15"><a href="choropleth-maps.html#cb339-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb339-16"><a href="choropleth-maps.html#cb339-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb339-17"><a href="choropleth-maps.html#cb339-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb339-18"><a href="choropleth-maps.html#cb339-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb339-19"><a href="choropleth-maps.html#cb339-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-438-1.png" width="100%" height="45%"  style="display: block; margin: auto;" /></p>
<p>So what should we take away from this map? There are more suicides in the downtown area than any other place in the city. Does this mean that people are more likely to kill themselves there than elsewhere? Not necessarily. A major mistake people make when making a choropleth map (or really any type of map) is accidentally making a population map. The darker shaded parts of our map are also where a lot of people live. So if there are more people, it is reasonable that there would be more suicides (or crimes, etc.). What we’d really want to do is make a rate per some population (usually per 100k though this assumes equal risk for every person in the city which isn’t really correct) to control for population differences.</p>
<p>We’ll use this data in Chapter <a href="interactive-maps.html#interactive-maps">18</a> to make interactive choropleth maps so let’s save it.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="choropleth-maps.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(sf_neighborhoods_suicide, <span class="at">file =</span> <span class="st">&quot;data/sf_neighborhoods_suicide.rda&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hotspot-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="interactive-maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": true,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/crimebythenumbers/edit/master/choropleth-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
