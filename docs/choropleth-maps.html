<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>16 Choropleth Maps | R 4 Criminology</title>
  <meta name="description" content="Notes for learning and applying R to questions about crime and the justice system." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="16 Choropleth Maps | R 4 Criminology" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://r4crim.com" />
  
  <meta property="og:description" content="Notes for learning and applying R to questions about crime and the justice system." />
  <meta name="github-repo" content="jacobkap/r4crim" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="16 Choropleth Maps | R 4 Criminology" />
  
  <meta name="twitter:description" content="Notes for learning and applying R to questions about crime and the justice system." />
  

<meta name="author" content="Jacob Kaplan" />
<meta name="author" content="Greg Ridgeway" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hotspot-maps.html">
<link rel="next" href="interactive-maps.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Criminology</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-math"><i class="fa fa-check"></i><b>1.1</b> Basic Math</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#combining-values-together-into-a-collection-or-vector"><i class="fa fa-check"></i><b>1.2</b> Combining values together into a collection (or vector)</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#assignment-of-values-to-variables-making-things"><i class="fa fa-check"></i><b>1.3</b> Assignment of values to variables (Making “things”)</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.4</b> Reading data into R</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#setting-the-working-directory"><i class="fa fa-check"></i><b>1.4.1</b> Setting the working directory</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#loading-data"><i class="fa fa-check"></i><b>1.4.2</b> Loading data</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#first-steps-to-explore-the-data"><i class="fa fa-check"></i><b>1.4.3</b> First steps to explore the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-rstudio.html"><a href="introduction-to-rstudio.html"><i class="fa fa-check"></i><b>2</b> Introduction to RStudio</a></li>
<li class="chapter" data-level="3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html"><i class="fa fa-check"></i><b>3</b> Subsetting: Making big things small</a><ul>
<li class="chapter" data-level="3.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-specific-values"><i class="fa fa-check"></i><b>3.1</b> Select specific values</a></li>
<li class="chapter" data-level="3.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#logical-values-and-operations"><i class="fa fa-check"></i><b>3.2</b> Logical values and operations</a><ul>
<li class="chapter" data-level="3.2.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#matching-a-single-value"><i class="fa fa-check"></i><b>3.2.1</b> Matching a single value</a></li>
<li class="chapter" data-level="3.2.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#matching-multiple-values"><i class="fa fa-check"></i><b>3.2.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="3.2.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#does-not-match"><i class="fa fa-check"></i><b>3.2.3</b> Does not match</a></li>
<li class="chapter" data-level="3.2.4" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>3.2.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="3.2.5" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>3.2.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>3.3</b> Subsetting a data.frame</a></li>
<li class="chapter" data-level="3.4" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-a-specific-column"><i class="fa fa-check"></i><b>3.4</b> Select a specific column</a><ul>
<li class="chapter" data-level="3.4.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-specific-rows-in-a-data.frame"><i class="fa fa-check"></i><b>3.4.1</b> Select specific rows in a data.frame</a></li>
<li class="chapter" data-level="3.4.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#battleships"><i class="fa fa-check"></i><b>3.4.2</b> Battleships</a></li>
<li class="chapter" data-level="3.4.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#subset-colorado-data"><i class="fa fa-check"></i><b>3.4.3</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#summary-and-table"><i class="fa fa-check"></i><b>4.1</b> Summary and Table</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#graphing-data"><i class="fa fa-check"></i><b>4.2</b> Graphing Data</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#aggregating-summaries-of-groups"><i class="fa fa-check"></i><b>4.3</b> Aggregating (summaries of groups)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>5</b> Dates and Times</a><ul>
<li class="chapter" data-level="5.1" data-path="dates-and-times.html"><a href="dates-and-times.html#why-do-dates-and-times-matter"><i class="fa fa-check"></i><b>5.1</b> Why do dates and times matter?</a></li>
<li class="chapter" data-level="5.2" data-path="dates-and-times.html"><a href="dates-and-times.html#lubridate"><i class="fa fa-check"></i><b>5.2</b> <code>lubridate</code></a></li>
<li class="chapter" data-level="5.3" data-path="dates-and-times.html"><a href="dates-and-times.html#working-with-dates"><i class="fa fa-check"></i><b>5.3</b> Working with dates</a></li>
<li class="chapter" data-level="5.4" data-path="dates-and-times.html"><a href="dates-and-times.html#chicago-crime-data"><i class="fa fa-check"></i><b>5.4</b> Chicago crime data</a></li>
<li class="chapter" data-level="5.5" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>5.5</b> Time zones</a><ul>
<li class="chapter" data-level="5.5.1" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises"><i class="fa fa-check"></i><b>5.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Regular Expressions</a><ul>
<li class="chapter" data-level="6.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>6.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="6.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>6.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="6.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>6.3</b> Useful special characters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>6.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>6.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>6.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string-and-not"><i class="fa fa-check"></i><b>6.3.4</b> Start of string and “not” <code>^</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>6.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="6.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>6.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="6.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>6.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="6.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>6.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="6.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>6.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="6.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>6.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="6.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>6.3.11</b> Optional text <code>?</code></a></li>
<li class="chapter" data-level="6.3.12" data-path="regular-expressions.html"><a href="regular-expressions.html#back-referencing"><i class="fa fa-check"></i><b>6.3.12</b> Back-referencing <code>()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>6.4</b> Changing capitalization</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Graphing with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="7.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>7.1</b> What does the data look like?</a><ul>
<li class="chapter" data-level="7.1.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-1"><i class="fa fa-check"></i><b>7.1.1</b> Exercises</a></li>
<li class="chapter" data-level="7.1.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-2"><i class="fa fa-check"></i><b>7.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#graphing-data-1"><i class="fa fa-check"></i><b>7.2</b> Graphing data</a></li>
<li class="chapter" data-level="7.3" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#time-series-plots"><i class="fa fa-check"></i><b>7.3</b> Time-Series Plots</a><ul>
<li class="chapter" data-level="7.3.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-3"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
<li class="chapter" data-level="7.3.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-4"><i class="fa fa-check"></i><b>7.3.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#should-we-trust-this-data"><i class="fa fa-check"></i><b>7.4</b> Should we trust this data?</a><ul>
<li class="chapter" data-level="7.4.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-5"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
<li class="chapter" data-level="7.4.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-6"><i class="fa fa-check"></i><b>7.4.2</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>8</b> Webscraping with <code>rvest</code></a><ul>
<li class="chapter" data-level="8.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>8.1</b> Scraping one page</a></li>
<li class="chapter" data-level="8.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning the webscraped data</a></li>
<li class="chapter" data-level="8.3" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#fixing-names"><i class="fa fa-check"></i><b>8.3</b> Fixing names</a><ul>
<li class="chapter" data-level="8.3.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#exercises-7"><i class="fa fa-check"></i><b>8.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>9</b> Functions</a><ul>
<li class="chapter" data-level="9.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>9.1</b> A simple function</a></li>
<li class="chapter" data-level="9.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>9.2</b> Adding parameters</a></li>
<li class="chapter" data-level="9.3" data-path="functions.html"><a href="functions.html#making-a-function-to-scrape-movie-data"><i class="fa fa-check"></i><b>9.3</b> Making a function to scrape movie data</a></li>
<li class="chapter" data-level="9.4" data-path="functions.html"><a href="functions.html#the-benefits-of-functions"><i class="fa fa-check"></i><b>9.4</b> The benefits of functions</a></li>
<li class="chapter" data-level="9.5" data-path="functions.html"><a href="functions.html#understanding-other-peoples-functions"><i class="fa fa-check"></i><b>9.5</b> Understanding other people’s functions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>10</b> For loops</a><ul>
<li class="chapter" data-level="10.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>10.1</b> Basic for loops</a></li>
<li class="chapter" data-level="10.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-days-of-movie"><i class="fa fa-check"></i><b>10.2</b> Scraping multiple days of movie</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="types-of-objects.html"><a href="types-of-objects.html"><i class="fa fa-check"></i><b>11</b> Types of objects</a><ul>
<li class="chapter" data-level="11.1" data-path="types-of-objects.html"><a href="types-of-objects.html#vectors"><i class="fa fa-check"></i><b>11.1</b> Vectors</a></li>
<li class="chapter" data-level="11.2" data-path="types-of-objects.html"><a href="types-of-objects.html#data-frames"><i class="fa fa-check"></i><b>11.2</b> Data frames</a></li>
<li class="chapter" data-level="11.3" data-path="types-of-objects.html"><a href="types-of-objects.html#lists"><i class="fa fa-check"></i><b>11.3</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>12</b> Reading and Writing Data</a><ul>
<li class="chapter" data-level="12.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>12.1</b> Reading Data into R</a><ul>
<li class="chapter" data-level="12.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-files"><i class="fa fa-check"></i><b>12.1.1</b> R files</a></li>
<li class="chapter" data-level="12.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-files"><i class="fa fa-check"></i><b>12.1.2</b> Excel files</a></li>
<li class="chapter" data-level="12.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-files"><i class="fa fa-check"></i><b>12.1.3</b> Stata files</a></li>
<li class="chapter" data-level="12.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-files"><i class="fa fa-check"></i><b>12.1.4</b> SAS files</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>12.2</b> Writing Data</a><ul>
<li class="chapter" data-level="12.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-files-1"><i class="fa fa-check"></i><b>12.2.1</b> R files</a></li>
<li class="chapter" data-level="12.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-files-1"><i class="fa fa-check"></i><b>12.2.2</b> Excel files</a></li>
<li class="chapter" data-level="12.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-files-1"><i class="fa fa-check"></i><b>12.2.3</b> Stata files</a></li>
<li class="chapter" data-level="12.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-files-1"><i class="fa fa-check"></i><b>12.2.4</b> SAS files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html"><i class="fa fa-check"></i><b>13</b> Scraping data from PDFs</a><ul>
<li class="chapter" data-level="13.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#downloading-officer-involved-shooting-files"><i class="fa fa-check"></i><b>13.1</b> Downloading officer-involved Shooting Files</a></li>
<li class="chapter" data-level="13.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-information-from-the-page"><i class="fa fa-check"></i><b>13.2</b> Scraping information from the page</a><ul>
<li class="chapter" data-level="13.2.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#combining-the-data-sets"><i class="fa fa-check"></i><b>13.2.1</b> Combining the data sets</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#extracting-data-from-pdfs"><i class="fa fa-check"></i><b>13.3</b> Extracting data from PDFs</a><ul>
<li class="chapter" data-level="13.3.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-a-single-pdf"><i class="fa fa-check"></i><b>13.3.1</b> Scraping a single PDF</a></li>
<li class="chapter" data-level="13.3.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#making-a-function"><i class="fa fa-check"></i><b>13.3.2</b> Making a function</a></li>
<li class="chapter" data-level="13.3.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#looping-through-every-pdf"><i class="fa fa-check"></i><b>13.3.3</b> Looping through every PDF</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>14</b> Geocoding</a><ul>
<li class="chapter" data-level="14.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>14.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="14.2" data-path="geocoding.html"><a href="geocoding.html#making-a-function-1"><i class="fa fa-check"></i><b>14.2</b> Making a function</a></li>
<li class="chapter" data-level="14.3" data-path="geocoding.html"><a href="geocoding.html#geocoding-officer-shooting-locations"><i class="fa fa-check"></i><b>14.3</b> Geocoding officer shooting locations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>15</b> Hotspot maps</a><ul>
<li class="chapter" data-level="15.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#creating-the-maps"><i class="fa fa-check"></i><b>15.1</b> Creating the maps</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>16</b> Choropleth Maps</a><ul>
<li class="chapter" data-level="16.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>16.1</b> Spatial joins</a></li>
<li class="chapter" data-level="16.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>16.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>17</b> Interactive Maps</a><ul>
<li class="chapter" data-level="17.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>17.1</b> Why do interactive graphs matter?</a><ul>
<li class="chapter" data-level="17.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>17.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="17.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>17.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>17.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="17.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>17.3</b> Adding popup information</a></li>
<li class="chapter" data-level="17.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>17.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="17.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-polygons"><i class="fa fa-check"></i><b>17.5</b> Interactive polygons</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html"><i class="fa fa-check"></i><b>18</b> Graphing Officer-Involved Shootings</a><ul>
<li class="chapter" data-level="18.1" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#graphing-a-single-variable"><i class="fa fa-check"></i><b>18.1</b> Graphing a single variable</a><ul>
<li class="chapter" data-level="18.1.1" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#numeric-variable"><i class="fa fa-check"></i><b>18.1.1</b> Numeric variable</a></li>
<li class="chapter" data-level="18.1.2" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#categorical-variable"><i class="fa fa-check"></i><b>18.1.2</b> Categorical variable</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#time-series"><i class="fa fa-check"></i><b>18.2</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html"><i class="fa fa-check"></i><b>19</b> Scraping Tables from PDFs</a><ul>
<li class="chapter" data-level="19.1" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html#scraping-the-first-table"><i class="fa fa-check"></i><b>19.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="19.2" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html#making-a-function-2"><i class="fa fa-check"></i><b>19.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html"><i class="fa fa-check"></i><b>20</b> Uniform Crime Report (UCR) Data</a><ul>
<li class="chapter" data-level="20.1" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#exploring-the-ucr-data"><i class="fa fa-check"></i><b>20.1</b> Exploring the UCR data</a></li>
<li class="chapter" data-level="20.2" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#finding-things-in-our-data"><i class="fa fa-check"></i><b>20.2</b> Finding things in our data</a></li>
<li class="chapter" data-level="20.3" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#manipulating-our-data"><i class="fa fa-check"></i><b>20.3</b> Manipulating our data</a><ul>
<li class="chapter" data-level="20.3.1" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#exercises-8"><i class="fa fa-check"></i><b>20.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html"><i class="fa fa-check"></i><b>21</b> Census Data from Social Explorer</a><ul>
<li class="chapter" data-level="21.1" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html#getting-census-data-from-social-explorer"><i class="fa fa-check"></i><b>21.1</b> Getting Census data from Social Explorer</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html"><i class="fa fa-check"></i><b>22</b> Census Data from IPUMS</a><ul>
<li class="chapter" data-level="22.1" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#getting-ipums-data"><i class="fa fa-check"></i><b>22.1</b> Getting IPUMS data</a></li>
<li class="chapter" data-level="22.2" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#cleaning-the-data"><i class="fa fa-check"></i><b>22.2</b> Cleaning the data</a></li>
<li class="chapter" data-level="22.3" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#aggregating-the-data"><i class="fa fa-check"></i><b>22.3</b> Aggregating the data</a></li>
<li class="chapter" data-level="22.4" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#graphing-the-data"><i class="fa fa-check"></i><b>22.4</b> Graphing the data</a></li>
<li class="chapter" data-level="22.5" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#mapping-the-data"><i class="fa fa-check"></i><b>22.5</b> Mapping the data</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html"><i class="fa fa-check"></i><b>23</b> National Incident-Based Reporting System (NIBRS) Data</a><ul>
<li class="chapter" data-level="23.1" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html#downloading-the-data"><i class="fa fa-check"></i><b>23.1</b> Downloading the data</a></li>
<li class="chapter" data-level="23.2" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html#reading-the-data"><i class="fa fa-check"></i><b>23.2</b> Reading the data</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="useful-resources.html"><a href="useful-resources.html"><i class="fa fa-check"></i><b>A</b> Useful Resources</a><ul>
<li class="chapter" data-level="A.1" data-path="useful-resources.html"><a href="useful-resources.html#learning-r-and-coding-issues"><i class="fa fa-check"></i><b>A.1</b> Learning R and coding issues</a></li>
<li class="chapter" data-level="A.2" data-path="useful-resources.html"><a href="useful-resources.html#data"><i class="fa fa-check"></i><b>A.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>B</b> Using R Markdown</a><ul>
<li class="chapter" data-level="B.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#code"><i class="fa fa-check"></i><b>B.1</b> Code</a><ul>
<li class="chapter" data-level="B.1.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#only-use-code-to-make-output"><i class="fa fa-check"></i><b>B.1.1</b> Only use code to make output</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#figures-and-tables"><i class="fa fa-check"></i><b>B.2</b> Figures and Tables</a></li>
<li class="chapter" data-level="B.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#finally-making-the-output-file"><i class="fa fa-check"></i><b>B.3</b> Finally, making the output file</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R 4 Criminology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="choropleth-maps" class="section level1">
<h1><span class="header-section-number">16</span> Choropleth Maps</h1>
<p>In Chapter <a href="hotspot-maps.html#hotspot-maps">15</a> we made hotspot maps to show which areas in Philadelphia had the most officer-involved shootings. We made the maps in a number of ways and consistently found that shootings were most prevalent in north and west Philly. In this lesson we will make choropleth maps, which are shaded maps and each region is a known area such as a state or country. Think of election maps where states are colored blue when a Democratic candidate wins that state and red when a Republican candidate wins. These are choropleth maps - each state is colored to indicate something. In this lesson we will continue to work on the officer-involved shooting data and make choropleth maps shaded by the number of shootings in each Census tract (we will define this later in the lesson) in the city.</p>
<p>Since we will be working more on the geocoded version of the police shooting data, let’s load it now.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/officer_shootings_geocoded.rda&quot;</span>)</code></pre>
<p>The package that we will use to handle geographic data and do most of the work in this lesson is <code>sf</code>. <code>sf</code> is a sophisticated package and does far more than we will cover in this lesson. For more information about the package’s features please see the website for it <a href="http://r-spatial.github.io/sf/">here</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="co">#&gt; Linking to GEOS 3.6.1, GDAL 2.2.3, PROJ 4.9.3</span></code></pre>
<p>The way <code>sf</code> reads in the shapefiles is through the <code>st_read()</code> function. Our input inside the () is a string with the name of the “.shp” file we want to read in (since we are telling R to read a file on the computer rather than an object that exists, it needs to be in quotes). This shapefile contains Census tracts for Philly so we’ll call the object “philly_tracts”.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/philly_census_tract/Census_Tracts_2010.shp&quot;</span>)
<span class="co">#&gt; Reading layer `Census_Tracts_2010&#39; from data source `C:\Users\user\Dropbox\R_project\r4crim\data\philly_census_tract\Census_Tracts_2010.shp&#39; using driver `ESRI Shapefile&#39;</span>
<span class="co">#&gt; Simple feature collection with 384 features and 14 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -75.28031 ymin: 39.86747 xmax: -74.95575 ymax: 40.13793</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></code></pre>
<p>Note that when we downloaded the data, it came with multiple files (some with extentions .cpg, .dbf, etc) but we only have the file with the .shp extention inside of <code>st_read()</code>. We still <strong>do</strong> need all of the files and <code>st_read()</code> is using them even if not explicitly called. So make sure every file downloaded is in the same working directory as the .shp file.</p>
<p>As always when dealing with a new data set, let’s peak at the first 6 rows.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(philly_tracts)
<span class="co">#&gt; Simple feature collection with 6 features and 14 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -75.24747 ymin: 39.96047 xmax: -75.15853 ymax: 39.98</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   OBJECTID STATEFP10 COUNTYFP10 TRACTCE10     GEOID10 NAME10</span>
<span class="co">#&gt; 1        1        42        101    009400 42101009400     94</span>
<span class="co">#&gt; 2        2        42        101    009500 42101009500     95</span>
<span class="co">#&gt; 3        3        42        101    009600 42101009600     96</span>
<span class="co">#&gt; 4        4        42        101    013800 42101013800    138</span>
<span class="co">#&gt; 5        5        42        101    013900 42101013900    139</span>
<span class="co">#&gt; 6        6        42        101    014000 42101014000    140</span>
<span class="co">#&gt;         NAMELSAD10 MTFCC10 FUNCSTAT10 ALAND10 AWATER10  INTPTLAT10</span>
<span class="co">#&gt; 1  Census Tract 94   G5020          S  366717        0 +39.9632709</span>
<span class="co">#&gt; 2  Census Tract 95   G5020          S  319070        0 +39.9658709</span>
<span class="co">#&gt; 3  Census Tract 96   G5020          S  405273        0 +39.9655396</span>
<span class="co">#&gt; 4 Census Tract 138   G5020          S  341256        0 +39.9764504</span>
<span class="co">#&gt; 5 Census Tract 139   G5020          S  562934        0 +39.9750563</span>
<span class="co">#&gt; 6 Census Tract 140   G5020          S  439802        0 +39.9735358</span>
<span class="co">#&gt;     INTPTLON10 LOGRECNO                       geometry</span>
<span class="co">#&gt; 1 -075.2322437    10429 MULTIPOLYGON (((-75.22927 3...</span>
<span class="co">#&gt; 2 -075.2379140    10430 MULTIPOLYGON (((-75.23536 3...</span>
<span class="co">#&gt; 3 -075.2435075    10431 MULTIPOLYGON (((-75.24343 3...</span>
<span class="co">#&gt; 4 -075.1771771    10468 MULTIPOLYGON (((-75.17341 3...</span>
<span class="co">#&gt; 5 -075.1711846    10469 MULTIPOLYGON (((-75.17313 3...</span>
<span class="co">#&gt; 6 -075.1630966    10470 MULTIPOLYGON (((-75.16141 3...</span></code></pre>
<p>The last column is important. In shapefiles the “geometry” column is the one with the instructions to make the map. This data has a single row for each Census tract in the city. So the “geometry” column in each row have a list of coordinates which, if connected in order, make up that tract. Since the “geometry” column contains the instructions to map, we can <code>plot()</code> it to show a map of the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(philly_tracts<span class="op">$</span>geometry)</code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-7-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Here we have a map of Philadelphia broken up into little pieces. Those pieces are Census tracts. Census tracts are small areas in a city with about 2,500-8,000 people and are used by the U.S. Census as a rough approximation of a neighborhood. Later in this lesson we will get some demographic and economic data about each of these tracts, but for now you can just think of them as neighborhoods.</p>
<p>In the <code>head()</code> results there was a section about something called “epsg” and “proj4string”. Let’s talk about that specifically since they are very important for working with spatial data. A way to get just those two results in the <code>st_crs()</code> function which is part of <code>sf</code>. Geographic datasets that describe locations on the surface of the earth have a “coordinate reference system” (CRS). Let’s extract the CRS for <code>philly_tracts</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_crs</span>(philly_tracts)
Coordinate Reference System<span class="op">:</span>
<span class="st">  </span>EPSG<span class="op">:</span><span class="st"> </span><span class="dv">4326</span> 
  proj4string<span class="op">:</span><span class="st"> &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span></code></pre>
<p>The <code>proj4string</code> tells us that the coordinate system used to describe the Census tract boundaries is longitude/latitude. Specifically, it uses the World Geodetic System 1984 (WGS84) maintained by the United States National Geospatial-Intelligence Agency, one of several standards to aid in navigation and geography. The European Petroleum Survey Group (EPSG) maintains a catalog of different coordinate systems (should be no surprise that oil exploration has driven the development of high quality geolocation standards). They have assigned the standard longitude/latitude coordinate system to be [EPSG4326]((<a href="http://spatialreference.org/ref/epsg/4326/" class="uri">http://spatialreference.org/ref/epsg/4326/</a>). You can find the full collection of coordinate systems at <a href="http://spatialreference.org/ref/epsg/">spatialreference.org</a>.</p>
<p>Many of us are comfortable with the longitude/latitude angular coordinate systems. However, the distance covered by a degree of longitude shrinks as you move towards the poles and only equals the distance covered by a degree of latitude at the equator. In addition, the earth is not very spherical so the coordinate system used for computing distances on the Earth’s surface might need to depend on where you are on the earth surface.</p>
<p>Almost all web mapping tools (Google Maps, ESRI, OpenStreetMaps) use the pseudo-Mercator projection (<a href="http://spatialreference.org/ref/epsg/3857/">EPSG3857</a>). Let’s convert our “philly_tracts” data to that coordinate system.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts &lt;-<span class="st"> </span><span class="kw">st_transform</span>(philly_tracts, <span class="dt">crs =</span> <span class="kw">st_crs</span>(<span class="st">&quot;+init=epsg:3857&quot;</span>))
<span class="kw">st_crs</span>(philly_tracts)
Coordinate Reference System<span class="op">:</span>
<span class="st">  </span>EPSG<span class="op">:</span><span class="st"> </span><span class="dv">3857</span> 
  proj4string<span class="op">:</span><span class="st"> &quot;+proj=merc +lon_0=0 +lat_ts=0 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +nadgrids=@null +units=m +no_defs&quot;</span></code></pre>
<p>Note that the <code>proj4string</code> now indicates that this is a Mercator projection with distance measured in meters (<code>+units=m</code>). Now if we ask for the centroids of the Census tracts, we get more accurate centroids and no warnings from R.</p>
<p>We can use the same projection, but modify it so that distances are measured in feet.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts &lt;-<span class="st"> </span><span class="kw">st_transform</span>(philly_tracts, <span class="dt">crs =</span> <span class="kw">st_crs</span>(<span class="st">&quot;+init=epsg:3857 +units=us-ft&quot;</span>))
<span class="kw">st_crs</span>(philly_tracts)
Coordinate Reference System<span class="op">:</span>
<span class="st">  </span>No EPSG code
  proj4string<span class="op">:</span><span class="st"> &quot;+proj=merc +lon_0=0 +lat_ts=0 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +nadgrids=@null +units=us-ft +no_defs&quot;</span></code></pre>
<p>There is a special coordinate system for every part of the world. A useful coordinate system for the Philadelphia area is <a href="http://spatialreference.org/ref/epsg/2272/">EPSG2272</a>. Let’s convert our philly_tracts data to that coordinate system.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts &lt;-<span class="st"> </span><span class="kw">st_transform</span>(philly_tracts, <span class="dt">crs =</span> <span class="dv">2272</span>)
<span class="kw">st_crs</span>(philly_tracts)
Coordinate Reference System<span class="op">:</span>
<span class="st">  </span>EPSG<span class="op">:</span><span class="st"> </span><span class="dv">2272</span> 
  proj4string<span class="op">:</span><span class="st"> &quot;+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs&quot;</span></code></pre>
<p>This coordinate system is the Lambert Conic Conformal (LCC). This particular projection of the <code>philly_tracts</code> is tuned to provide good precision for the southern part of Pennsylvania and distances are measured in feet (note the <code>+units=us-ft</code> tag in the <code>proj4string</code>).</p>
<div id="spatial-joins" class="section level2">
<h2><span class="header-section-number">16.1</span> Spatial joins</h2>
<p>What we want to do with these Census tracts is to find out which tract each shooting occurred in and sum up the number of shootings per tract. Once we do that we can do two things. First we can make a more accurate hotspot map by mapping at the Census tract level and being able to measure shootings-per-tract. The second thing is to be able to combine the tract-level shootings with other data sets. Since some data also comes at the tract-level we can merge the data sets together and see if there is any relationship between the variables. In this lesson we will do that using Census data.</p>
<p>Spatial joins is the process of linking two data sources by their geography. For the case of the officer-involved shooting data, we want to know how many shootings occurred in each tract To do this we need to drop each shooting point location into the PSA polygons and have R tell us in which polygon (in mapping terms each tract is a polygon) did each shooting land.</p>
<p>First we need to convert our “officer_shootings_geocoded” data frame to a spatial object, communicating to R that the <code>lon</code> and <code>lat</code> columns are special. At this stage we also have to communicate in what coordinate system are the <code>lon</code> and <code>lat</code> values. We want the same coordinate system in both the shootings data and the Census tracts data.</p>
<p>Right now our “officer_shootings_geocoded” data is in a data.frame with some info on each shootings and the longitude and latitude of the shooting in separate columns. We want to turn this data.frame into a spatial object to allow us to find which tract each shooting happened in. We can convert it into a spatial object using the <code>st_as_sf()</code> function from <code>sf</code>. Our input is first our data, “officer_shootings_geocoded”. Then in the <code>coords</code> parameter we put a vector of the column names so the function knows which columns are the latitude and longitude columns to convert to a GEOMETRY column like we saw in “philly_tracts” earlier.</p>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings_geocoded &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(officer_shootings_geocoded, 
                                       <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>), 
                                       <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +ellps=WGS84 +no_defs&quot;</span>)</code></pre>
<p>We want our shootings data in the same projection as the tracts data so we need to use <code>st_transform()</code> to change the projection. Since we want the CRS to be the same as in “philly_tracts”, we can set it using <code>st_crs(philly_tracts)</code> to copy the right CRS.</p>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings_geocoded &lt;-<span class="st"> </span><span class="kw">st_transform</span>(officer_shootings_geocoded, <span class="dt">crs =</span> <span class="kw">st_crs</span>(philly_tracts))</code></pre>
<p>Now we can take a look at <code>head()</code> to see if it was projected.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(officer_shootings_geocoded)
<span class="co">#&gt; Simple feature collection with 6 features and 3 fields</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 2677013 ymin: 226302.3 xmax: 2706722 ymax: 254283.8</span>
<span class="co">#&gt; epsg (SRID):    2272</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs</span>
<span class="co">#&gt;   shooting_number                                 location      dates</span>
<span class="co">#&gt; 1           19-04      4950 Hazel Avenue, Philadelphia, PA 2019-03-06</span>
<span class="co">#&gt; 2           19-06      1350 Kater Street, Philadelphia, PA 2019-03-28</span>
<span class="co">#&gt; 4           19 11     2150 Taney Terrace, Philadelphia, PA 2019-04-25</span>
<span class="co">#&gt; 5           19-13   1850 N. Broad Street, Philadelphia, PA 2019-05-11</span>
<span class="co">#&gt; 6           19 14          3450 G Street, Philadelphia, PA 2019-05-20</span>
<span class="co">#&gt; 7           18-01 2850 Kensington Avenue, Philadelphia, PA 2018-01-13</span>
<span class="co">#&gt;                   geometry</span>
<span class="co">#&gt; 1 POINT (2677013 235030.1)</span>
<span class="co">#&gt; 2 POINT (2693287 232708.6)</span>
<span class="co">#&gt; 4 POINT (2686167 226302.3)</span>
<span class="co">#&gt; 5 POINT (2694966 246773.4)</span>
<span class="co">#&gt; 6 POINT (2706722 254283.8)</span>
<span class="co">#&gt; 7 POINT (2705021 251022.7)</span></code></pre>
<p>We can see it is now a “simple feature collection” with the correct projection. And we can see there is a new column called “geometry” just like in “philly_tracts”. The type of data in “geometry” is POINT since our data is just a single location instead of a polygon like in the tracts data.</p>
<p>Since we have both the tracts and the shootings data let’s make a quick map to see the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(philly_tracts<span class="op">$</span>geometry)
<span class="kw">plot</span>(officer_shootings_geocoded<span class="op">$</span>geometry, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-15-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Our next step is to combine these two data sets to figure out how many shootings occurred in each Census tract. This will be a multi-step process so let’s plan it out before beginning. Our shooting data is one row for each shooting, our tract data is one row for each tract. Since our goal is to map at the tract-level we need to get the tract where each shooting occurred then aggregate up to the tract-level to get a count of the shootings-per-tract. Then we need to combine that with that the original tract data (since we need the “geometry” column) and we can then map it.</p>
<ol style="list-style-type: decimal">
<li>Find which tract each shooting happened in</li>
<li>Aggregate shooting data until we get one row per tract and a sum of shootings</li>
<li>Combine with the Census tract data</li>
<li>Make maps</li>
</ol>
<p>We’ll start by finding the tract where each shooting occurred using the function <code>st_join()</code> which is part of <code>sf</code>. This does a spatial join and finds the polygon where each point is located in. Since we will be aggregating the data let’s call the output of this function “shootings_agg”. The order in the () is important! For our aggregation we want the output to be at the shooting-level so we start with the “officer_shootings_geocoded” data. In the next step we’ll see why this matters.</p>
<pre class="sourceCode r"><code class="sourceCode r">shootings_agg &lt;-<span class="st"> </span><span class="kw">st_join</span>(officer_shootings_geocoded, philly_tracts)</code></pre>
<p>Let’s peak at the first 6 rows.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(shootings_agg)
<span class="co">#&gt; Simple feature collection with 6 features and 17 fields</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 2677013 ymin: 226302.3 xmax: 2706722 ymax: 254283.8</span>
<span class="co">#&gt; epsg (SRID):    2272</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs</span>
<span class="co">#&gt;   shooting_number                                 location      dates</span>
<span class="co">#&gt; 1           19-04      4950 Hazel Avenue, Philadelphia, PA 2019-03-06</span>
<span class="co">#&gt; 2           19-06      1350 Kater Street, Philadelphia, PA 2019-03-28</span>
<span class="co">#&gt; 4           19 11     2150 Taney Terrace, Philadelphia, PA 2019-04-25</span>
<span class="co">#&gt; 5           19-13   1850 N. Broad Street, Philadelphia, PA 2019-05-11</span>
<span class="co">#&gt; 6           19 14          3450 G Street, Philadelphia, PA 2019-05-20</span>
<span class="co">#&gt; 7           18-01 2850 Kensington Avenue, Philadelphia, PA 2018-01-13</span>
<span class="co">#&gt;   OBJECTID STATEFP10 COUNTYFP10 TRACTCE10     GEOID10 NAME10</span>
<span class="co">#&gt; 1      208        42        101    007900 42101007900     79</span>
<span class="co">#&gt; 2       33        42        101    001500 42101001500     15</span>
<span class="co">#&gt; 4      198        42        101    003600 42101003600     36</span>
<span class="co">#&gt; 5      384        42        101    037700 42101037700    377</span>
<span class="co">#&gt; 6       21        42        101    019200 42101019200    192</span>
<span class="co">#&gt; 7      244        42        101    017800 42101017800    178</span>
<span class="co">#&gt;         NAMELSAD10 MTFCC10 FUNCSTAT10 ALAND10 AWATER10  INTPTLAT10</span>
<span class="co">#&gt; 1  Census Tract 79   G5020          S  377950        0 +39.9504630</span>
<span class="co">#&gt; 2  Census Tract 15   G5020          S  239383        0 +39.9419037</span>
<span class="co">#&gt; 4  Census Tract 36   G5020          S  964539        0 +39.9279255</span>
<span class="co">#&gt; 5 Census Tract 377   G5020          S  736894        0 +39.9824381</span>
<span class="co">#&gt; 6 Census Tract 192   G5020          S  656913        0 +40.0006393</span>
<span class="co">#&gt; 7 Census Tract 178   G5020          S  662905        0 +39.9913734</span>
<span class="co">#&gt;     INTPTLON10 LOGRECNO                 geometry</span>
<span class="co">#&gt; 1 -075.2182570    10410 POINT (2677013 235030.1)</span>
<span class="co">#&gt; 2 -075.1591158    10356 POINT (2693287 232708.6)</span>
<span class="co">#&gt; 4 -075.1920206    10377 POINT (2686167 226302.3)</span>
<span class="co">#&gt; 5 -075.1506932    10694 POINT (2694966 246773.4)</span>
<span class="co">#&gt; 6 -075.1150648    10519 POINT (2706722 254283.8)</span>
<span class="co">#&gt; 7 -075.1173063    10510 POINT (2705021 251022.7)</span></code></pre>
<p>There are now columns from the Census tracts data which says which tract the shooting happened in. Now we can aggregate up to the tract-level. We just need to aggregate by a unique variable indicating which tract it is, we will then use this to merge with the “philly_tracts” data. Let’s look specifically at the “GEOID10” variable since that is actually important and common in dealing with Census data. And let’s also print out the columns “STATEFP10”, “COUNTYFP10”, and “TRACTCE10”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(shootings_agg[, <span class="kw">c</span>(<span class="st">&quot;STATEFP10&quot;</span>, <span class="st">&quot;COUNTYFP10&quot;</span>, <span class="st">&quot;TRACTCE10&quot;</span>, <span class="st">&quot;GEOID10&quot;</span>)])
<span class="co">#&gt; Simple feature collection with 6 features and 4 fields</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 2677013 ymin: 226302.3 xmax: 2706722 ymax: 254283.8</span>
<span class="co">#&gt; epsg (SRID):    2272</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs</span>
<span class="co">#&gt;   STATEFP10 COUNTYFP10 TRACTCE10     GEOID10                 geometry</span>
<span class="co">#&gt; 1        42        101    007900 42101007900 POINT (2677013 235030.1)</span>
<span class="co">#&gt; 2        42        101    001500 42101001500 POINT (2693287 232708.6)</span>
<span class="co">#&gt; 4        42        101    003600 42101003600 POINT (2686167 226302.3)</span>
<span class="co">#&gt; 5        42        101    037700 42101037700 POINT (2694966 246773.4)</span>
<span class="co">#&gt; 6        42        101    019200 42101019200 POINT (2706722 254283.8)</span>
<span class="co">#&gt; 7        42        101    017800 42101017800 POINT (2705021 251022.7)</span></code></pre>
<p>The GEOID10 column is a unique identifer for the Census tracts in Philly. It is made up by a few other identifers at higher geographic levels. All of the GEOID10s here start with the numbers 42 followed by 101. The first two numbers are the state identifiers code, 42, based on Census FIPS codes. FIPS stands for Federal Information Processing Standard and are unique geographic identifiers used in their data. These codes are used to merge different data sets (e.g. FBI crime data and Census data) together, a task that would be impossible (or very difficult) without a unique ID code in both data sets. The 101 is the county code, as seen in the column “COUNTYFP10”. The remaining numbers vary and indicate which tract it is. When combined it makes an 11 number code that is not repeated for any Census tract in the country. We will return to this code when combining this data with Census data.</p>
<p>For now we will use the code to aggregate the number of shootings per Census tract. Remember, the <code>aggregate()</code> command aggregates a numeric value by some categorical value. Here we aggregate the number of shootings per Census tract. So our code will be</p>
<p>aggregate(number_shootings ~ GEOID10, data = shootings_agg, FUN = sum)</p>
<p>We actually don’t have a variable with the number of shootings so we need to make that. We can simply call it “number_shootings” and give it that value of 1 since each row is only one shooting.</p>
<pre class="sourceCode r"><code class="sourceCode r">shootings_agg<span class="op">$</span>number_shootings &lt;-<span class="st"> </span><span class="dv">1</span></code></pre>
<p>Now we can write the <code>aggregate()</code> code and save the results back into “shootings_agg”.</p>
<pre class="sourceCode r"><code class="sourceCode r">shootings_agg &lt;-<span class="st"> </span><span class="kw">aggregate</span>(number_shootings <span class="op">~</span><span class="st"> </span>GEOID10, <span class="dt">data =</span> shootings_agg, <span class="dt">FUN =</span> sum)</code></pre>
<p>Let’s check a summary of the “number_shootings” variable we made.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(shootings_agg<span class="op">$</span>number_shootings)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   1.000   1.000   2.000   2.163   3.000   9.000</span></code></pre>
<p>The minimum is one shooting per tract, two on average, and 9 in the tract with the most shootings. So what do we make of this data? Well, there are some data issues that cause problems in these results. First, we know that shootings that didn’t get geocoded properly were given the coordinates of City Hall, likely making up that tract with 9 shootings. And then let’s think about the minimum value. Did every single tract in the city have at least one shooting? No, take a look at the number of rows in this data, keeping in mind there should be one row per tract.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(shootings_agg)
<span class="co">#&gt; [1] 203</span></code></pre>
<p>And let’s compare it to the “philly_tracts” data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(philly_tracts)
<span class="co">#&gt; [1] 384</span></code></pre>
<p>The shootings data is missing about 180 tracts. That is because if no shooting occurred there, there would never be a matching row in the data so that tract wouldn’t appear in the shooting data. That’s not going to be a major issue here but is something to keep in mind in future research. And given the sensitivity of this issue, is a good reason to carefully check your data before make any conclusions.</p>
<p>The data is ready to merge with the “philly_tracts” data. We’ll introduce a new function that makes merging data simple. This function comes from the <code>dplyr</code> package so we need to install and load it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span>
<span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span></code></pre>
<p>The function we will use is <code>left_join()</code> which takes two parameters, the two data sets to join together.</p>
<p><code>left_join(data1, data2)</code></p>
<p>This function joins these data and keeps all of the rows from the left data and every column from both data sets. It combines the data based on any matching columns (matching meaning same name) in both data sets. Since in our data sets, the column “GEOID10” exists in both, it will merge the data based on that column.</p>
<p>There are two other functions that are similar but differ based on which rows they keep.</p>
<ul>
<li>left_join - All rows from Left data and all columns from Left and Right data</li>
<li>right_join - All rows from Right data and all columns from Left and Right data</li>
<li>full_join - All rows and all columns from Left and Right data</li>
</ul>
<p>We could alternatively use the <code>merge()</code> function which is built into R but that function is slower than the <code>dplyr</code> functions and requires us to manually set the matching columns.</p>
<p>We want to keep all rows in “philly_tracts” (keep all tracts) so we can use <code>left_join(philly_tracts, shootings_agg)</code>. Let’s save the results into a new data.frame called “philly_tracts_shootings”.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts_shootings &lt;-<span class="st"> </span><span class="kw">left_join</span>(philly_tracts, shootings_agg)
<span class="co">#&gt; Joining, by = &quot;GEOID10&quot;</span></code></pre>
<p>If we look at <code>summary()</code> again for “number_shootings” we can see that there are now 181 rows with NAs. These are the tracts where there were no shootings so they weren’t present in the “shootings_agg” data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span class="co">#&gt;   1.000   1.000   2.000   2.163   3.000   9.000     181</span></code></pre>
<p>We need to convert these values to 0. We will use the <code>is.na()</code> function to conditionally find all rows with a NA value in the “number_shootings” column and use square bracket notation to change the value to 0.</p>
<pre class="sourceCode r"><code class="sourceCode r">philly_tracts_shootings<span class="op">$</span>number_shootings[<span class="kw">is.na</span>(philly_tracts_shootings<span class="op">$</span>number_shootings)] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre>
<p>Checking it again we see that the minimum is now 0 and the mean number of shootings drops to about 1.1 per tract.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.000   0.000   1.000   1.143   2.000   9.000</span></code></pre>
</div>
<div id="making-choropleth-maps" class="section level2">
<h2><span class="header-section-number">16.2</span> Making choropleth maps</h2>
<p><strong>Finally</strong> we are ready to make some choropleth maps.</p>
<p>For these maps we are going to use <code>ggplot2</code> again so we need to load it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)</code></pre>
<p><code>ggplot2</code>’s benefit is you can slowly build graphs or maps and improve the graph at every step. Before we used functions such as <code>geom_line()</code> for line graphs and <code>geom_point()</code> for scatter plots. For mapping these polygons we will use <code>geom_sf()</code> which knows how to handle spatial data.</p>
<p>As usual we will start with <code>ggplot()</code>, inputting our data first. Then inside of <code>aes</code> (the aesthetics of the graph/map) we use a new parameter <code>fill</code>. In <code>fill</code> we will put in the “number_shootings” column and it will color the polygons (tracts) based on values in that column. Then we can add the <code>geom_sf()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(philly_tracts_shootings, <span class="kw">aes</span>(<span class="dt">fill =</span> number_shootings)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>() </code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-31-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>We have now created a choropleth map showing the number of shootings per Census tract in Philly! Based on the legend tracts that are light blue have the most shootings while tracts that are dark blue have the fewest (or none at all). Normally we’d want the opposite, with darker (or brighter) areas signifying a greater amount of whatever the map is showing.</p>
<p>We can use <code>scale_fill_gradient()</code> to set the colors to what we want. We input a color for low value and a color for high value and it’ll make the map shading by those colors.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(philly_tracts_shootings, <span class="kw">aes</span>(<span class="dt">fill =</span> number_shootings)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) </code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-32-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>This gives a much better map and clearly shows the areas where shootings are most common and where there were no shootings.</p>
<p>To make this map easier to read and look better, let’s add a title to the map and to the legend.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(philly_tracts_shootings, <span class="kw">aes</span>(<span class="dt">fill =</span> number_shootings)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;# of Police Shootings&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Police Shootings in Philadelphia by Census Tract&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;January 2007 - mid-2019&quot;</span>) </code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-33-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Since the coordinates don’t add anything to the map, let’s get rid of them.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(philly_tracts_shootings, <span class="kw">aes</span>(<span class="dt">fill =</span> number_shootings)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;# of Police Shootings&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Police Shootings in Philadelphia by Census Tract&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;January 2007 - mid-2019&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-34-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>We’ll return to this data in Section <a href="interactive-maps.html#interactive-polygons">17.5</a> for the lesson on interactive maps so we need to save it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(philly_tracts_shootings, <span class="dt">file =</span> <span class="st">&quot;data/philly_tracts_shootings.rda&quot;</span>)</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hotspot-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="interactive-maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/r4crim/edit/master/choropleth-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
