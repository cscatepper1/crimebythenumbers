<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Reshaping data | Crime by the Numbers: A Criminologist’s Guide to R</title>
  <meta name="description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Reshaping data | Crime by the Numbers: A Criminologist’s Guide to R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  <meta name="github-repo" content="jacobkap/crimebythenumbers" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Reshaping data | Crime by the Numbers: A Criminologist’s Guide to R" />
  
  <meta name="twitter:description" content="A guide to learning R for the purpose of conducting quantitative research. This covers collecting and cleaning data, and visualizing it in graphs and maps." />
  

<meta name="author" content="Jacob Kaplan" />


<meta name="date" content="2022-09-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="regular-expressions.html"/>
<link rel="next" href="graphing-intro.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Crime by the Numbers: A Criminologist's Guide to R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-learn-to-program"><i class="fa fa-check"></i>Why learn to program?</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#scale"><i class="fa fa-check"></i>Scale</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-will-learn"><i class="fa fa-check"></i>What you will learn</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i>Skills</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-wont-learn"><i class="fa fa-check"></i>What you won’t learn</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#simple-vs-easy"><i class="fa fa-check"></i>Simple vs easy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-read-this-book"><i class="fa fa-check"></i>How to read this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citing-this-book"><i class="fa fa-check"></i>Citing this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute-to-this-book"><i class="fa fa-check"></i>How to contribute to this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#where-to-find-data-included-in-this-book"><i class="fa fa-check"></i>Where to find data included in this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#where-to-find-code-included-in-this-book"><i class="fa fa-check"></i>Where to find code included in this book</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the author</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html"><i class="fa fa-check"></i><b>1</b> A soup to nuts project example</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#big-picture-data-example"><i class="fa fa-check"></i><b>1.1</b> Big picture data example</a></li>
<li class="chapter" data-level="1.2" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#little-picture-data-example"><i class="fa fa-check"></i><b>1.2</b> Little picture data example</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#loading-packages"><i class="fa fa-check"></i><b>1.2.1</b> Loading packages</a></li>
<li class="chapter" data-level="1.2.2" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#loading-data"><i class="fa fa-check"></i><b>1.2.2</b> Loading data</a></li>
<li class="chapter" data-level="1.2.3" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#cleaning"><i class="fa fa-check"></i><b>1.2.3</b> Cleaning</a></li>
<li class="chapter" data-level="1.2.4" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#aggregating"><i class="fa fa-check"></i><b>1.2.4</b> Aggregating</a></li>
<li class="chapter" data-level="1.2.5" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#graphing"><i class="fa fa-check"></i><b>1.2.5</b> Graphing</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-soup-to-nuts-project-example.html"><a href="a-soup-to-nuts-project-example.html#reusing-and-modifying-code"><i class="fa fa-check"></i><b>1.3</b> Reusing and modifying code</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro-to-r.html"><a href="intro-to-r.html#using-rstudio"><i class="fa fa-check"></i><b>2.1</b> Using RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro-to-r.html"><a href="intro-to-r.html#opening-an-r-script"><i class="fa fa-check"></i><b>2.1.1</b> Opening an R Script</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro-to-r.html"><a href="intro-to-r.html#setting-the-working-directory"><i class="fa fa-check"></i><b>2.1.2</b> Setting the working directory</a></li>
<li class="chapter" data-level="2.1.3" data-path="intro-to-r.html"><a href="intro-to-r.html#changing-rstudio"><i class="fa fa-check"></i><b>2.1.3</b> Changing RStudio</a></li>
<li class="chapter" data-level="2.1.4" data-path="intro-to-r.html"><a href="intro-to-r.html#helpful-cheat-sheets"><i class="fa fa-check"></i><b>2.1.4</b> Helpful cheat sheets</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro-to-r.html"><a href="intro-to-r.html#assignment"><i class="fa fa-check"></i><b>2.2</b> Assigning variables</a></li>
<li class="chapter" data-level="2.3" data-path="intro-to-r.html"><a href="intro-to-r.html#functions-intro"><i class="fa fa-check"></i><b>2.3</b> What are functions (and packages)?</a></li>
<li class="chapter" data-level="2.4" data-path="intro-to-r.html"><a href="intro-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.4</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-to-r.html"><a href="intro-to-r.html#loading-data-intro"><i class="fa fa-check"></i><b>2.4.1</b> Loading data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-to-r.html"><a href="intro-to-r.html#first-steps-to-exploring-data"><i class="fa fa-check"></i><b>2.5</b> First steps to exploring data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>3</b> Data types and structures</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-types.html"><a href="data-types.html#section-data-types"><i class="fa fa-check"></i><b>3.1</b> Data types</a></li>
<li class="chapter" data-level="3.2" data-path="data-types.html"><a href="data-types.html#numeric-character-and-logical-boolean"><i class="fa fa-check"></i><b>3.2</b> Numeric, character, and logical (boolean)</a></li>
<li class="chapter" data-level="3.3" data-path="data-types.html"><a href="data-types.html#data-structures"><i class="fa fa-check"></i><b>3.3</b> Data structures</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-types.html"><a href="data-types.html#vectors"><i class="fa fa-check"></i><b>3.3.1</b> Vectors (collections of “things”)</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-types.html"><a href="data-types.html#dataframes"><i class="fa fa-check"></i><b>3.3.2</b> Data.frames</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-types.html"><a href="data-types.html#other-data-structures"><i class="fa fa-check"></i><b>3.3.3</b> Other data structures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>4.1</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r"><i class="fa fa-check"></i><b>4.1.1</b> R</a></li>
<li class="chapter" data-level="4.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel"><i class="fa fa-check"></i><b>4.1.2</b> Excel</a></li>
<li class="chapter" data-level="4.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata"><i class="fa fa-check"></i><b>4.1.3</b> Stata</a></li>
<li class="chapter" data-level="4.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas"><i class="fa fa-check"></i><b>4.1.4</b> SAS</a></li>
<li class="chapter" data-level="4.1.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss"><i class="fa fa-check"></i><b>4.1.5</b> SPSS</a></li>
<li class="chapter" data-level="4.1.6" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#fixed-width-ascii"><i class="fa fa-check"></i><b>4.1.6</b> Fixed-width ASCII</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>4.2</b> Writing data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-1"><i class="fa fa-check"></i><b>4.2.1</b> R</a></li>
<li class="chapter" data-level="4.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-1"><i class="fa fa-check"></i><b>4.2.2</b> Excel</a></li>
<li class="chapter" data-level="4.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-1"><i class="fa fa-check"></i><b>4.2.3</b> Stata</a></li>
<li class="chapter" data-level="4.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-1"><i class="fa fa-check"></i><b>4.2.4</b> SAS</a></li>
<li class="chapter" data-level="4.2.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss-1"><i class="fa fa-check"></i><b>4.2.5</b> SPSS</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="5" data-path="mise-en-place.html"><a href="mise-en-place.html"><i class="fa fa-check"></i><b>5</b> <em>Mise en place</em></a>
<ul>
<li class="chapter" data-level="5.1" data-path="mise-en-place.html"><a href="mise-en-place.html#starting-with-a-pencil-and-paper"><i class="fa fa-check"></i><b>5.1</b> Starting with a pencil and paper</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="mise-en-place.html"><a href="mise-en-place.html#tables-and-graphs"><i class="fa fa-check"></i><b>5.1.1</b> Tables and graphs</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="mise-en-place.html"><a href="mise-en-place.html#r-projects"><i class="fa fa-check"></i><b>5.2</b> R Projects</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mise-en-place.html"><a href="mise-en-place.html#folders"><i class="fa fa-check"></i><b>5.2.1</b> Folders</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mise-en-place.html"><a href="mise-en-place.html#modular-r-scripts"><i class="fa fa-check"></i><b>5.3</b> Modular R scripts</a></li>
<li class="chapter" data-level="5.4" data-path="mise-en-place.html"><a href="mise-en-place.html#modular-code"><i class="fa fa-check"></i><b>5.4</b> Modular code</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mise-en-place.html"><a href="mise-en-place.html#section-labels"><i class="fa fa-check"></i><b>5.4.1</b> Section labels</a></li>
<li class="chapter" data-level="5.4.2" data-path="mise-en-place.html"><a href="mise-en-place.html#helper-r-scripts"><i class="fa fa-check"></i><b>5.4.2</b> Helper R scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="collaboration.html"><a href="collaboration.html"><i class="fa fa-check"></i><b>6</b> Collaboration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="collaboration.html"><a href="collaboration.html#code-review"><i class="fa fa-check"></i><b>6.1</b> Code review</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="collaboration.html"><a href="collaboration.html#style-guidelines"><i class="fa fa-check"></i><b>6.1.1</b> Style guidelines</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="collaboration.html"><a href="collaboration.html#documentation"><i class="fa fa-check"></i><b>6.2</b> Documentation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="collaboration.html"><a href="collaboration.html#comments"><i class="fa fa-check"></i><b>6.2.1</b> Comments</a></li>
<li class="chapter" data-level="6.2.2" data-path="collaboration.html"><a href="collaboration.html#vignettes"><i class="fa fa-check"></i><b>6.2.2</b> Vignettes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>7</b> R Markdown</a>
<ul>
<li class="chapter" data-level="7.1" data-path="r-markdown.html"><a href="r-markdown.html#code-1"><i class="fa fa-check"></i><b>7.1</b> Code</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="r-markdown.html"><a href="r-markdown.html#hiding-code-in-the-output"><i class="fa fa-check"></i><b>7.1.1</b> Hiding code in the output</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="r-markdown.html"><a href="r-markdown.html#inline-code"><i class="fa fa-check"></i><b>7.2</b> Inline Code</a></li>
<li class="chapter" data-level="7.3" data-path="r-markdown.html"><a href="r-markdown.html#tables"><i class="fa fa-check"></i><b>7.3</b> Tables</a></li>
<li class="chapter" data-level="7.4" data-path="r-markdown.html"><a href="r-markdown.html#footnotes"><i class="fa fa-check"></i><b>7.4</b> Footnotes</a></li>
<li class="chapter" data-level="7.5" data-path="r-markdown.html"><a href="r-markdown.html#citation"><i class="fa fa-check"></i><b>7.5</b> Citation</a></li>
<li class="chapter" data-level="7.6" data-path="r-markdown.html"><a href="r-markdown.html#spell-check"><i class="fa fa-check"></i><b>7.6</b> Spell check</a></li>
<li class="chapter" data-level="7.7" data-path="r-markdown.html"><a href="r-markdown.html#making-the-output-file"><i class="fa fa-check"></i><b>7.7</b> Making the output file</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tests.html"><a href="tests.html"><i class="fa fa-check"></i><b>8</b> Testing your code</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tests.html"><a href="tests.html#why-test-your-code"><i class="fa fa-check"></i><b>8.1</b> Why test your code?</a></li>
<li class="chapter" data-level="8.2" data-path="tests.html"><a href="tests.html#unit-tests"><i class="fa fa-check"></i><b>8.2</b> Unit tests</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tests.html"><a href="tests.html#modular-test-scripts"><i class="fa fa-check"></i><b>8.2.1</b> Modular test scripts</a></li>
<li class="chapter" data-level="8.2.2" data-path="tests.html"><a href="tests.html#how-to-write-unit-tests"><i class="fa fa-check"></i><b>8.2.2</b> How to write unit tests</a></li>
<li class="chapter" data-level="8.2.3" data-path="tests.html"><a href="tests.html#what-to-test"><i class="fa fa-check"></i><b>8.2.3</b> What to test</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tests.html"><a href="tests.html#test-driven-development-tdd"><i class="fa fa-check"></i><b>8.3</b> Test-driven development (TDD)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>9</b> Git</a>
<ul>
<li class="chapter" data-level="9.1" data-path="git.html"><a href="git.html#what-is-git-and-why-do-i-need-it"><i class="fa fa-check"></i><b>9.1</b> What is Git, and why do I need it?</a></li>
<li class="chapter" data-level="9.2" data-path="git.html"><a href="git.html#git-basics"><i class="fa fa-check"></i><b>9.2</b> Git basics</a></li>
<li class="chapter" data-level="9.3" data-path="git.html"><a href="git.html#using-git"><i class="fa fa-check"></i><b>9.3</b> Using Git</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="git.html"><a href="git.html#setting-up-git"><i class="fa fa-check"></i><b>9.3.1</b> Setting up Git</a></li>
<li class="chapter" data-level="9.3.2" data-path="git.html"><a href="git.html#setting-up-github"><i class="fa fa-check"></i><b>9.3.2</b> Setting up GitHub</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="git.html"><a href="git.html#setting-up-git-on-an-already-made-r-project"><i class="fa fa-check"></i><b>9.4</b> Setting up Git on an already-made R Project</a></li>
<li class="chapter" data-level="9.5" data-path="git.html"><a href="git.html#using-git-through-rstudio"><i class="fa fa-check"></i><b>9.5</b> Using Git through RStudio</a></li>
<li class="chapter" data-level="9.6" data-path="git.html"><a href="git.html#when-to-commit"><i class="fa fa-check"></i><b>9.6</b> When to commit</a></li>
<li class="chapter" data-level="9.7" data-path="git.html"><a href="git.html#other-resources"><i class="fa fa-check"></i><b>9.7</b> Other resources</a></li>
</ul></li>
<li class="part"><span><b>III Clean</b></span></li>
<li class="chapter" data-level="10" data-path="subsetting-intro.html"><a href="subsetting-intro.html"><i class="fa fa-check"></i><b>10</b> Subsetting: Making big things small</a>
<ul>
<li class="chapter" data-level="10.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-values"><i class="fa fa-check"></i><b>10.1</b> Select specific values</a></li>
<li class="chapter" data-level="10.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#logical-values-and-operations"><i class="fa fa-check"></i><b>10.2</b> Logical values and operations</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-a-single-value"><i class="fa fa-check"></i><b>10.2.1</b> Matching a single value</a></li>
<li class="chapter" data-level="10.2.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-multiple-values"><i class="fa fa-check"></i><b>10.2.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="10.2.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#does-not-match"><i class="fa fa-check"></i><b>10.2.3</b> Does not match</a></li>
<li class="chapter" data-level="10.2.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>10.2.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="10.2.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>10.2.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>10.3</b> Subsetting a data.frame</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-columns"><i class="fa fa-check"></i><b>10.3.1</b> Select specific columns</a></li>
<li class="chapter" data-level="10.3.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-rows"><i class="fa fa-check"></i><b>10.3.2</b> Select specific rows</a></li>
<li class="chapter" data-level="10.3.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subset-colorado-data"><i class="fa fa-check"></i><b>10.3.3</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="explore.html"><a href="explore.html"><i class="fa fa-check"></i><b>11</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="explore.html"><a href="explore.html#summary-and-table"><i class="fa fa-check"></i><b>11.1</b> Summary and Table</a></li>
<li class="chapter" data-level="11.2" data-path="explore.html"><a href="explore.html#graphing-1"><i class="fa fa-check"></i><b>11.2</b> Graphing</a></li>
<li class="chapter" data-level="11.3" data-path="explore.html"><a href="explore.html#aggregate"><i class="fa fa-check"></i><b>11.3</b> Aggregating (summaries of groups)</a></li>
<li class="chapter" data-level="11.4" data-path="explore.html"><a href="explore.html#dplyr-pipes"><i class="fa fa-check"></i><b>11.4</b> Pipes in <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>12</b> Regular Expressions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>12.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="12.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>12.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="12.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>12.3</b> Useful special characters</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>12.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="12.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>12.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="12.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>12.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="12.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string"><i class="fa fa-check"></i><b>12.3.4</b> Start of string</a></li>
<li class="chapter" data-level="12.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>12.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="12.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>12.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="12.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>12.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="12.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>12.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="12.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>12.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="12.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>12.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="12.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>12.3.11</b> Optional text <code>?</code></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>12.4</b> Changing capitalization</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="reshaping.html"><a href="reshaping.html"><i class="fa fa-check"></i><b>13</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="reshaping.html"><a href="reshaping.html#reshaping-a-single-column"><i class="fa fa-check"></i><b>13.1</b> Reshaping a single column</a></li>
<li class="chapter" data-level="13.2" data-path="reshaping.html"><a href="reshaping.html#reshaping-multiple-columns"><i class="fa fa-check"></i><b>13.2</b> Reshaping multiple columns</a></li>
</ul></li>
<li class="part"><span><b>IV Visualize</b></span></li>
<li class="chapter" data-level="14" data-path="graphing-intro.html"><a href="graphing-intro.html"><i class="fa fa-check"></i><b>14</b> Graphing with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="14.1" data-path="graphing-intro.html"><a href="graphing-intro.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>14.1</b> What does the data look like?</a></li>
<li class="chapter" data-level="14.2" data-path="graphing-intro.html"><a href="graphing-intro.html#graphing-data"><i class="fa fa-check"></i><b>14.2</b> Graphing data</a></li>
<li class="chapter" data-level="14.3" data-path="graphing-intro.html"><a href="graphing-intro.html#time-series-plots"><i class="fa fa-check"></i><b>14.3</b> Time-series plots</a></li>
<li class="chapter" data-level="14.4" data-path="graphing-intro.html"><a href="graphing-intro.html#scatter-plots"><i class="fa fa-check"></i><b>14.4</b> Scatter plots</a></li>
<li class="chapter" data-level="14.5" data-path="graphing-intro.html"><a href="graphing-intro.html#color-blindness"><i class="fa fa-check"></i><b>14.5</b> Color blindness</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ois-graphs.html"><a href="ois-graphs.html"><i class="fa fa-check"></i><b>15</b> More graphing with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="15.1" data-path="ois-graphs.html"><a href="ois-graphs.html#exploring-data"><i class="fa fa-check"></i><b>15.1</b> Exploring data</a></li>
<li class="chapter" data-level="15.2" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-a-single-numeric-variable"><i class="fa fa-check"></i><b>15.2</b> Graphing a single numeric variable</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="ois-graphs.html"><a href="ois-graphs.html#histogram"><i class="fa fa-check"></i><b>15.2.1</b> Histogram</a></li>
<li class="chapter" data-level="15.2.2" data-path="ois-graphs.html"><a href="ois-graphs.html#density-plot"><i class="fa fa-check"></i><b>15.2.2</b> Density plot</a></li>
<li class="chapter" data-level="15.2.3" data-path="ois-graphs.html"><a href="ois-graphs.html#count-graph"><i class="fa fa-check"></i><b>15.2.3</b> Count graph</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-a-categorical-variable"><i class="fa fa-check"></i><b>15.3</b> Graphing a categorical variable</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="ois-graphs.html"><a href="ois-graphs.html#bar-graph"><i class="fa fa-check"></i><b>15.3.1</b> Bar graph</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-data-over-time"><i class="fa fa-check"></i><b>15.4</b> Graphing data over time</a></li>
<li class="chapter" data-level="15.5" data-path="ois-graphs.html"><a href="ois-graphs.html#pretty-graphs"><i class="fa fa-check"></i><b>15.5</b> Pretty graphs</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="ois-graphs.html"><a href="ois-graphs.html#themes"><i class="fa fa-check"></i><b>15.5.1</b> Themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>16</b> Hotspot maps</a>
<ul>
<li class="chapter" data-level="16.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#a-simple-map"><i class="fa fa-check"></i><b>16.1</b> A simple map</a></li>
<li class="chapter" data-level="16.2" data-path="hotspot-maps.html"><a href="hotspot-maps.html#what-really-are-maps"><i class="fa fa-check"></i><b>16.2</b> What really are maps?</a></li>
<li class="chapter" data-level="16.3" data-path="hotspot-maps.html"><a href="hotspot-maps.html#making-a-hotspot-map"><i class="fa fa-check"></i><b>16.3</b> Making a hotspot map</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#colors"><i class="fa fa-check"></i><b>16.3.1</b> Colors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>17</b> Choropleth maps</a>
<ul>
<li class="chapter" data-level="17.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>17.1</b> Spatial joins</a></li>
<li class="chapter" data-level="17.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>17.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>18</b> Interactive maps</a>
<ul>
<li class="chapter" data-level="18.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>18.1</b> Why do interactive graphs matter?</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>18.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="18.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>18.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>18.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="18.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>18.3</b> Adding popup information</a></li>
<li class="chapter" data-level="18.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>18.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="18.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-choropleth-maps"><i class="fa fa-check"></i><b>18.5</b> Interactive choropleth maps</a></li>
</ul></li>
<li class="part"><span><b>V Collect</b></span></li>
<li class="chapter" data-level="19" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>19</b> Webscraping with <code>rvest</code></a>
<ul>
<li class="chapter" data-level="19.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>19.1</b> Scraping one page</a></li>
<li class="chapter" data-level="19.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>19.2</b> Cleaning the webscraped data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>20</b> Functions</a>
<ul>
<li class="chapter" data-level="20.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>20.1</b> A simple function</a></li>
<li class="chapter" data-level="20.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>20.2</b> Adding parameters</a></li>
<li class="chapter" data-level="20.3" data-path="functions.html"><a href="functions.html#recipes-function"><i class="fa fa-check"></i><b>20.3</b> Making a function to scrape recipes</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>21</b> For loops</a>
<ul>
<li class="chapter" data-level="21.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>21.1</b> Basic for loops</a></li>
<li class="chapter" data-level="21.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-recipes"><i class="fa fa-check"></i><b>21.2</b> Scraping multiple recipes</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="scrape-table.html"><a href="scrape-table.html"><i class="fa fa-check"></i><b>22</b> Scraping tables from PDFs</a>
<ul>
<li class="chapter" data-level="22.1" data-path="scrape-table.html"><a href="scrape-table.html#scraping-the-first-table"><i class="fa fa-check"></i><b>22.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="22.2" data-path="scrape-table.html"><a href="scrape-table.html#making-a-function"><i class="fa fa-check"></i><b>22.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="scrape-table2.html"><a href="scrape-table2.html"><i class="fa fa-check"></i><b>23</b> More scraping tables from PDFs</a>
<ul>
<li class="chapter" data-level="23.1" data-path="scrape-table2.html"><a href="scrape-table2.html#texas-jail-data"><i class="fa fa-check"></i><b>23.1</b> Texas jail data</a></li>
<li class="chapter" data-level="23.2" data-path="scrape-table2.html"><a href="scrape-table2.html#pregnant-women-incarcerated"><i class="fa fa-check"></i><b>23.2</b> Pregnant women incarcerated</a></li>
<li class="chapter" data-level="23.3" data-path="scrape-table2.html"><a href="scrape-table2.html#making-pdf-scraped-data-available-to-others"><i class="fa fa-check"></i><b>23.3</b> Making PDF-scraped data available to others</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>24</b> Geocoding</a>
<ul>
<li class="chapter" data-level="24.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>24.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="24.2" data-path="geocoding.html"><a href="geocoding.html#geocoding-san-francisco-marijuana-dispensary-locations"><i class="fa fa-check"></i><b>24.2</b> Geocoding San Francisco marijuana dispensary locations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime by the Numbers: A Criminologist’s Guide to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reshaping" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Reshaping data<a href="reshaping.html#reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>For this chapter you’ll need the following file, which is available for download <a href="https://github.com/jacobkap/r4crimz/tree/master/data">here</a>: sqf-2019.xlsx. This file was initially downloaded from the New York City Police Department’s page <a href="https://www1.nyc.gov/site/nypd/stats/reports-analysis/stopfrisk.page">here</a>.</p>
<p>When you’re using data for research, the end result is usually a regression or a graph (or both), and that requires your data to be in a particular format. Usually your data should have one row for each unit of analysis, and each column should have information about that unit. As an example, if you wanted to study city-level crime over time, you’d have each row be a single city in a single time period. If you looked at 10 different time periods, say 10 years, you’d have 10 rows for each city. And each column would have information about that city in that time period, such as the number of murders that occurred.</p>
<p>This is what is known as “long” format, as this data often has many rows and few columns. The alternative is what’s known as “wide” format, where each row (in our example) is a single agency and you’d have 10 times as many columns in “long” data as there are 10 time periods. Whereas with “long” data you’d have, for example, a “murder” column and 10 rows showing the murder in each year, with “wide” data you’d have 10 murder columns showing the value for each year’s murder count. While long data is more commonly used in criminology research, some statistical and graphing approaches require wide data. If this seems like an abstract concept, bear with it for a bit as we’ll go over several examples in this chapter.</p>
<p>Ideally, our data comes in the exact format we need. In cases where it doesn’t, we need to be able to convert the data from long to wide or from wide to long format. This conversion is called “reshaping”. There are many approaches and packages to doing reshaping in R, which makes reshaping actually one of the most confusing things to do in R. In this chapter we’ll use an approach from the package <code>tidyr</code>, which, as the name suggests, is one of the packages from the tidyverse. To use this package we need to install it using <code>install.packages()</code>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="reshaping.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyr&quot;</span>)</span></code></pre></div>
<p>For this chapter we’ll use microdata from the New York City Police Department for every stop and frisk they conducted in 2019. The data is in an .xlsx format so we can use the <code>readxl</code> package to read it into R. Let’s call the data “sqf” as it is the abbreviation for “stop, question, and frisk,” which is the full name of the data set. Following traditional R naming conventions, we’ll keep the object name lowercased.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="reshaping.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb210-2"><a href="reshaping.html#cb210-2" aria-hidden="true" tabindex="-1"></a>sqf <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;data/sqf-2019.xlsx&quot;</span>)</span></code></pre></div>
<p>The first thing we want to do when loading in a new data set to R is to look at it. We can do this a few different ways, including using <code>View()</code>, which opens up an Excel-like tab where we can scroll through the data, and through <code>head()</code> which prints the first 6 rows of every column to the console. The <code>readxl</code> package converts the data into a “tibble”. which is essentially a modified data.frame. One of the modifications is that it doesn’t print out every single column when we use <code>head()</code> to view the first 6 rows of each column. That’s because tibble’s don’t want to print large amounts of text to the console.</p>
<p>Normally we’d use <code>head()</code> to look at the data, but as there are dozens of columns in this data, I don’t want to print out the first six rows of every column to the console as it will take up a lot of space in the book. If this were real data you were working on, you would use <code>head()</code> or <code>View()</code> to look at the data. Instead, here we’ll use <code>names()</code> to see what columns are in the data. Let’s also use <code>nrow()</code> to see how many rows of data we have.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="reshaping.html#cb211-1" aria-hidden="true" tabindex="-1"></a>sqf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(sqf)</span>
<span id="cb211-2"><a href="reshaping.html#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sqf)</span>
<span id="cb211-3"><a href="reshaping.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] &quot;STOP_ID_ANONY&quot;                                             </span></span>
<span id="cb211-4"><a href="reshaping.html#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  [2] &quot;STOP_FRISK_DATE&quot;                                           </span></span>
<span id="cb211-5"><a href="reshaping.html#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  [3] &quot;STOP_FRISK_TIME&quot;                                           </span></span>
<span id="cb211-6"><a href="reshaping.html#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  [4] &quot;YEAR2&quot;                                                     </span></span>
<span id="cb211-7"><a href="reshaping.html#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  [5] &quot;MONTH2&quot;                                                    </span></span>
<span id="cb211-8"><a href="reshaping.html#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  [6] &quot;DAY2&quot;                                                      </span></span>
<span id="cb211-9"><a href="reshaping.html#cb211-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  [7] &quot;STOP_WAS_INITIATED&quot;                                        </span></span>
<span id="cb211-10"><a href="reshaping.html#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  [8] &quot;RECORD_STATUS_CODE&quot;                                        </span></span>
<span id="cb211-11"><a href="reshaping.html#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  [9] &quot;ISSUING_OFFICER_RANK&quot;                                      </span></span>
<span id="cb211-12"><a href="reshaping.html#cb211-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [10] &quot;ISSUING_OFFICER_COMMAND_CODE&quot;                              </span></span>
<span id="cb211-13"><a href="reshaping.html#cb211-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [11] &quot;SUPERVISING_OFFICER_RANK&quot;                                  </span></span>
<span id="cb211-14"><a href="reshaping.html#cb211-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [12] &quot;SUPERVISING_OFFICER_COMMAND_CODE&quot;                          </span></span>
<span id="cb211-15"><a href="reshaping.html#cb211-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [13] &quot;LOCATION_IN_OUT_CODE&quot;                                      </span></span>
<span id="cb211-16"><a href="reshaping.html#cb211-16" aria-hidden="true" tabindex="-1"></a><span class="co"># [14] &quot;JURISDICTION_CODE&quot;                                         </span></span>
<span id="cb211-17"><a href="reshaping.html#cb211-17" aria-hidden="true" tabindex="-1"></a><span class="co"># [15] &quot;JURISDICTION_DESCRIPTION&quot;                                  </span></span>
<span id="cb211-18"><a href="reshaping.html#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co"># [16] &quot;OBSERVED_DURATION_MINUTES&quot;                                 </span></span>
<span id="cb211-19"><a href="reshaping.html#cb211-19" aria-hidden="true" tabindex="-1"></a><span class="co"># [17] &quot;SUSPECTED_CRIME_DESCRIPTION&quot;                               </span></span>
<span id="cb211-20"><a href="reshaping.html#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="co"># [18] &quot;STOP_DURATION_MINUTES&quot;                                     </span></span>
<span id="cb211-21"><a href="reshaping.html#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="co"># [19] &quot;OFFICER_EXPLAINED_STOP_FLAG&quot;                               </span></span>
<span id="cb211-22"><a href="reshaping.html#cb211-22" aria-hidden="true" tabindex="-1"></a><span class="co"># [20] &quot;OFFICER_NOT_EXPLAINED_STOP_DESCRIPTION&quot;                    </span></span>
<span id="cb211-23"><a href="reshaping.html#cb211-23" aria-hidden="true" tabindex="-1"></a><span class="co"># [21] &quot;OTHER_PERSON_STOPPED_FLAG&quot;                                 </span></span>
<span id="cb211-24"><a href="reshaping.html#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="co"># [22] &quot;SUSPECT_ARRESTED_FLAG&quot;                                     </span></span>
<span id="cb211-25"><a href="reshaping.html#cb211-25" aria-hidden="true" tabindex="-1"></a><span class="co"># [23] &quot;SUSPECT_ARREST_OFFENSE&quot;                                    </span></span>
<span id="cb211-26"><a href="reshaping.html#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="co"># [24] &quot;SUMMONS_ISSUED_FLAG&quot;                                       </span></span>
<span id="cb211-27"><a href="reshaping.html#cb211-27" aria-hidden="true" tabindex="-1"></a><span class="co"># [25] &quot;SUMMONS_OFFENSE_DESCRIPTION&quot;                               </span></span>
<span id="cb211-28"><a href="reshaping.html#cb211-28" aria-hidden="true" tabindex="-1"></a><span class="co"># [26] &quot;OFFICER_IN_UNIFORM_FLAG&quot;                                   </span></span>
<span id="cb211-29"><a href="reshaping.html#cb211-29" aria-hidden="true" tabindex="-1"></a><span class="co"># [27] &quot;ID_CARD_IDENTIFIES_OFFICER_FLAG&quot;                           </span></span>
<span id="cb211-30"><a href="reshaping.html#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="co"># [28] &quot;SHIELD_IDENTIFIES_OFFICER_FLAG&quot;                            </span></span>
<span id="cb211-31"><a href="reshaping.html#cb211-31" aria-hidden="true" tabindex="-1"></a><span class="co"># [29] &quot;VERBAL_IDENTIFIES_OFFICER_FLAG&quot;                            </span></span>
<span id="cb211-32"><a href="reshaping.html#cb211-32" aria-hidden="true" tabindex="-1"></a><span class="co"># [30] &quot;FRISKED_FLAG&quot;                                              </span></span>
<span id="cb211-33"><a href="reshaping.html#cb211-33" aria-hidden="true" tabindex="-1"></a><span class="co"># [31] &quot;SEARCHED_FLAG&quot;                                             </span></span>
<span id="cb211-34"><a href="reshaping.html#cb211-34" aria-hidden="true" tabindex="-1"></a><span class="co"># [32] &quot;ASK_FOR_CONSENT_FLG&quot;                                       </span></span>
<span id="cb211-35"><a href="reshaping.html#cb211-35" aria-hidden="true" tabindex="-1"></a><span class="co"># [33] &quot;CONSENT_GIVEN_FLG&quot;                                         </span></span>
<span id="cb211-36"><a href="reshaping.html#cb211-36" aria-hidden="true" tabindex="-1"></a><span class="co"># [34] &quot;OTHER_CONTRABAND_FLAG&quot;                                     </span></span>
<span id="cb211-37"><a href="reshaping.html#cb211-37" aria-hidden="true" tabindex="-1"></a><span class="co"># [35] &quot;FIREARM_FLAG&quot;                                              </span></span>
<span id="cb211-38"><a href="reshaping.html#cb211-38" aria-hidden="true" tabindex="-1"></a><span class="co"># [36] &quot;KNIFE_CUTTER_FLAG&quot;                                         </span></span>
<span id="cb211-39"><a href="reshaping.html#cb211-39" aria-hidden="true" tabindex="-1"></a><span class="co"># [37] &quot;OTHER_WEAPON_FLAG&quot;                                         </span></span>
<span id="cb211-40"><a href="reshaping.html#cb211-40" aria-hidden="true" tabindex="-1"></a><span class="co"># [38] &quot;WEAPON_FOUND_FLAG&quot;                                         </span></span>
<span id="cb211-41"><a href="reshaping.html#cb211-41" aria-hidden="true" tabindex="-1"></a><span class="co"># [39] &quot;PHYSICAL_FORCE_CEW_FLAG&quot;                                   </span></span>
<span id="cb211-42"><a href="reshaping.html#cb211-42" aria-hidden="true" tabindex="-1"></a><span class="co"># [40] &quot;PHYSICAL_FORCE_DRAW_POINT_FIREARM_FLAG&quot;                    </span></span>
<span id="cb211-43"><a href="reshaping.html#cb211-43" aria-hidden="true" tabindex="-1"></a><span class="co"># [41] &quot;PHYSICAL_FORCE_HANDCUFF_SUSPECT_FLAG&quot;                      </span></span>
<span id="cb211-44"><a href="reshaping.html#cb211-44" aria-hidden="true" tabindex="-1"></a><span class="co"># [42] &quot;PHYSICAL_FORCE_OC_SPRAY_USED_FLAG&quot;                         </span></span>
<span id="cb211-45"><a href="reshaping.html#cb211-45" aria-hidden="true" tabindex="-1"></a><span class="co"># [43] &quot;PHYSICAL_FORCE_OTHER_FLAG&quot;                                 </span></span>
<span id="cb211-46"><a href="reshaping.html#cb211-46" aria-hidden="true" tabindex="-1"></a><span class="co"># [44] &quot;PHYSICAL_FORCE_RESTRAINT_USED_FLAG&quot;                        </span></span>
<span id="cb211-47"><a href="reshaping.html#cb211-47" aria-hidden="true" tabindex="-1"></a><span class="co"># [45] &quot;PHYSICAL_FORCE_VERBAL_INSTRUCTION_FLAG&quot;                    </span></span>
<span id="cb211-48"><a href="reshaping.html#cb211-48" aria-hidden="true" tabindex="-1"></a><span class="co"># [46] &quot;PHYSICAL_FORCE_WEAPON_IMPACT_FLAG&quot;                         </span></span>
<span id="cb211-49"><a href="reshaping.html#cb211-49" aria-hidden="true" tabindex="-1"></a><span class="co"># [47] &quot;BACKROUND_CIRCUMSTANCES_VIOLENT_CRIME_FLAG&quot;                </span></span>
<span id="cb211-50"><a href="reshaping.html#cb211-50" aria-hidden="true" tabindex="-1"></a><span class="co"># [48] &quot;BACKROUND_CIRCUMSTANCES_SUSPECT_KNOWN_TO_CARRY_WEAPON_FLAG&quot;</span></span>
<span id="cb211-51"><a href="reshaping.html#cb211-51" aria-hidden="true" tabindex="-1"></a><span class="co"># [49] &quot;SUSPECTS_ACTIONS_CASING_FLAG&quot;                              </span></span>
<span id="cb211-52"><a href="reshaping.html#cb211-52" aria-hidden="true" tabindex="-1"></a><span class="co"># [50] &quot;SUSPECTS_ACTIONS_CONCEALED_POSSESSION_WEAPON_FLAG&quot;         </span></span>
<span id="cb211-53"><a href="reshaping.html#cb211-53" aria-hidden="true" tabindex="-1"></a><span class="co"># [51] &quot;SUSPECTS_ACTIONS_DECRIPTION_FLAG&quot;                          </span></span>
<span id="cb211-54"><a href="reshaping.html#cb211-54" aria-hidden="true" tabindex="-1"></a><span class="co"># [52] &quot;SUSPECTS_ACTIONS_DRUG_TRANSACTIONS_FLAG&quot;                   </span></span>
<span id="cb211-55"><a href="reshaping.html#cb211-55" aria-hidden="true" tabindex="-1"></a><span class="co"># [53] &quot;SUSPECTS_ACTIONS_IDENTIFY_CRIME_PATTERN_FLAG&quot;              </span></span>
<span id="cb211-56"><a href="reshaping.html#cb211-56" aria-hidden="true" tabindex="-1"></a><span class="co"># [54] &quot;SUSPECTS_ACTIONS_LOOKOUT_FLAG&quot;                             </span></span>
<span id="cb211-57"><a href="reshaping.html#cb211-57" aria-hidden="true" tabindex="-1"></a><span class="co"># [55] &quot;SUSPECTS_ACTIONS_OTHER_FLAG&quot;                               </span></span>
<span id="cb211-58"><a href="reshaping.html#cb211-58" aria-hidden="true" tabindex="-1"></a><span class="co"># [56] &quot;SUSPECTS_ACTIONS_PROXIMITY_TO_SCENE_FLAG&quot;                  </span></span>
<span id="cb211-59"><a href="reshaping.html#cb211-59" aria-hidden="true" tabindex="-1"></a><span class="co"># [57] &quot;SEARCH_BASIS_ADMISSION_FLAG&quot;                               </span></span>
<span id="cb211-60"><a href="reshaping.html#cb211-60" aria-hidden="true" tabindex="-1"></a><span class="co"># [58] &quot;SEARCH_BASIS_CONSENT_FLAG&quot;                                 </span></span>
<span id="cb211-61"><a href="reshaping.html#cb211-61" aria-hidden="true" tabindex="-1"></a><span class="co"># [59] &quot;SEARCH_BASIS_HARD_OBJECT_FLAG&quot;                             </span></span>
<span id="cb211-62"><a href="reshaping.html#cb211-62" aria-hidden="true" tabindex="-1"></a><span class="co"># [60] &quot;SEARCH_BASIS_INCIDENTAL_TO_ARREST_FLAG&quot;                    </span></span>
<span id="cb211-63"><a href="reshaping.html#cb211-63" aria-hidden="true" tabindex="-1"></a><span class="co"># [61] &quot;SEARCH_BASIS_OTHER_FLAG&quot;                                   </span></span>
<span id="cb211-64"><a href="reshaping.html#cb211-64" aria-hidden="true" tabindex="-1"></a><span class="co"># [62] &quot;SEARCH_BASIS_OUTLINE_FLAG&quot;                                 </span></span>
<span id="cb211-65"><a href="reshaping.html#cb211-65" aria-hidden="true" tabindex="-1"></a><span class="co"># [63] &quot;DEMEANOR_CODE&quot;                                             </span></span>
<span id="cb211-66"><a href="reshaping.html#cb211-66" aria-hidden="true" tabindex="-1"></a><span class="co"># [64] &quot;DEMEANOR_OF_PERSON_STOPPED&quot;                                </span></span>
<span id="cb211-67"><a href="reshaping.html#cb211-67" aria-hidden="true" tabindex="-1"></a><span class="co"># [65] &quot;SUSPECT_REPORTED_AGE&quot;                                      </span></span>
<span id="cb211-68"><a href="reshaping.html#cb211-68" aria-hidden="true" tabindex="-1"></a><span class="co"># [66] &quot;SUSPECT_SEX&quot;                                               </span></span>
<span id="cb211-69"><a href="reshaping.html#cb211-69" aria-hidden="true" tabindex="-1"></a><span class="co"># [67] &quot;SUSPECT_RACE_DESCRIPTION&quot;                                  </span></span>
<span id="cb211-70"><a href="reshaping.html#cb211-70" aria-hidden="true" tabindex="-1"></a><span class="co"># [68] &quot;SUSPECT_HEIGHT&quot;                                            </span></span>
<span id="cb211-71"><a href="reshaping.html#cb211-71" aria-hidden="true" tabindex="-1"></a><span class="co"># [69] &quot;SUSPECT_WEIGHT&quot;                                            </span></span>
<span id="cb211-72"><a href="reshaping.html#cb211-72" aria-hidden="true" tabindex="-1"></a><span class="co"># [70] &quot;SUSPECT_BODY_BUILD_TYPE&quot;                                   </span></span>
<span id="cb211-73"><a href="reshaping.html#cb211-73" aria-hidden="true" tabindex="-1"></a><span class="co"># [71] &quot;SUSPECT_EYE_COLOR&quot;                                         </span></span>
<span id="cb211-74"><a href="reshaping.html#cb211-74" aria-hidden="true" tabindex="-1"></a><span class="co"># [72] &quot;SUSPECT_HAIR_COLOR&quot;                                        </span></span>
<span id="cb211-75"><a href="reshaping.html#cb211-75" aria-hidden="true" tabindex="-1"></a><span class="co"># [73] &quot;SUSPECT_OTHER_DESCRIPTION&quot;                                 </span></span>
<span id="cb211-76"><a href="reshaping.html#cb211-76" aria-hidden="true" tabindex="-1"></a><span class="co"># [74] &quot;STOP_LOCATION_PRECINCT&quot;                                    </span></span>
<span id="cb211-77"><a href="reshaping.html#cb211-77" aria-hidden="true" tabindex="-1"></a><span class="co"># [75] &quot;STOP_LOCATION_SECTOR_CODE&quot;                                 </span></span>
<span id="cb211-78"><a href="reshaping.html#cb211-78" aria-hidden="true" tabindex="-1"></a><span class="co"># [76] &quot;STOP_LOCATION_APARTMENT&quot;                                   </span></span>
<span id="cb211-79"><a href="reshaping.html#cb211-79" aria-hidden="true" tabindex="-1"></a><span class="co"># [77] &quot;STOP_LOCATION_FULL_ADDRESS&quot;                                </span></span>
<span id="cb211-80"><a href="reshaping.html#cb211-80" aria-hidden="true" tabindex="-1"></a><span class="co"># [78] &quot;STOP_LOCATION_STREET_NAME&quot;                                 </span></span>
<span id="cb211-81"><a href="reshaping.html#cb211-81" aria-hidden="true" tabindex="-1"></a><span class="co"># [79] &quot;STOP_LOCATION_X&quot;                                           </span></span>
<span id="cb211-82"><a href="reshaping.html#cb211-82" aria-hidden="true" tabindex="-1"></a><span class="co"># [80] &quot;STOP_LOCATION_Y&quot;                                           </span></span>
<span id="cb211-83"><a href="reshaping.html#cb211-83" aria-hidden="true" tabindex="-1"></a><span class="co"># [81] &quot;STOP_LOCATION_ZIP_CODE&quot;                                    </span></span>
<span id="cb211-84"><a href="reshaping.html#cb211-84" aria-hidden="true" tabindex="-1"></a><span class="co"># [82] &quot;STOP_LOCATION_PATROL_BORO_NAME&quot;                            </span></span>
<span id="cb211-85"><a href="reshaping.html#cb211-85" aria-hidden="true" tabindex="-1"></a><span class="co"># [83] &quot;STOP_LOCATION_BORO_NAME&quot;</span></span>
<span id="cb211-86"><a href="reshaping.html#cb211-86" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(sqf)</span>
<span id="cb211-87"><a href="reshaping.html#cb211-87" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 13459</span></span></code></pre></div>
<p>Each row of data is a stop and frisk, and there were 13,459 in 2019. That number may seem low to you, especially if you’ve read articles about how frequent stop and frisks happens in New York City. It is correct - at least correct in terms of reported stops. Stop and frisks in New York City peaked in 2011 with nearly 700,000 conducted, and then fell sharply after that to fewer than 23,000 from 2015 through 2019 (the last year available at the time of this writing).</p>
<p>Looking at the results of <code>names()</code>, we can see that this is a rich data set with lots of information about each stop (though many columns also have missing data, so it is not as rich as it initially appears). Each stop has, for example, the date and time of the stop, whether an arrest was made and for what, physical characteristics (race, sex, age, height, weight, clothing) of the person stopped, and the location of the stop. One important variable that’s missing is a unique identifier for either the officer or the person stopped so we can see how often they are in the data. The “ISSUING_OFFICER_COMMAND_CODE” variable may be a unique ID for the officer, but it’s not clear that it is - there are different officer ranks for the same command code so this appears to me to be different officers.</p>
<div id="reshaping-a-single-column" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Reshaping a single column<a href="reshaping.html#reshaping-a-single-column" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Relative to most data sets in criminology, this is an enormous amount of information. So I encourage you to explore this data and practice your R skills. As this chapter focuses on reshaping, we won’t do much exploring of the data. This data is in long format as each row is a different stop, and the columns are information about that specific stop. We can’t convert this to wide format as there are no repeated entries in the data; each row is of a unique person stopped (at least as far as we can tell. In reality, there are likely to be many people stopped multiple times in the data). We could use another variable such as stopped persons’ race or gender and reshape it using that, but that’ll lead to many thousands of columns so is not a great idea.</p>
<p>Instead, we’ll first aggregate the data and then reshape that aggregated data. We’ll aggregate the data by month and by day of week and see how many people of each race were stopped at each month-day-of-week. In addition to <code>tidyr</code>, we’ll use functions from <code>dplyr</code> to aggregate our data. Since we’ve already installed that package we just need to use <code>library()</code> and don’t need to use <code>install.packages()</code> again.</p>
<p>We’ve already used the <code>group_by()</code> function in aggregating, and now we’ll introduce a new function: <code>count()</code>. In our earlier aggregation code (introduced in Section <a href="explore.html#aggregate">11.3</a>), we used the function <code>summarize()</code> and summed up columns that had a numeric variable (e.g. the number of murders). <code>count()</code> works similarly by sums up categorical variables, which in our case is the race of people stopped. Using <code>count()</code> we enter in the categorical column in the parentheses, and it’ll make a new column called “n”, which is the sum of each category. Since we’re aggregating the data let’s assign the result of our aggregating to a new object called “sqf_agg”.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="reshaping.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb212-2"><a href="reshaping.html#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb212-3"><a href="reshaping.html#cb212-3" aria-hidden="true" tabindex="-1"></a>sqf_agg <span class="ot">&lt;-</span> sqf <span class="sc">%&gt;%</span></span>
<span id="cb212-4"><a href="reshaping.html#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb212-5"><a href="reshaping.html#cb212-5" aria-hidden="true" tabindex="-1"></a>    MONTH2,</span>
<span id="cb212-6"><a href="reshaping.html#cb212-6" aria-hidden="true" tabindex="-1"></a>    DAY2</span>
<span id="cb212-7"><a href="reshaping.html#cb212-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb212-8"><a href="reshaping.html#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(SUSPECT_RACE_DESCRIPTION)</span></code></pre></div>
<p>Now let’s look at the <code>head()</code> of the result.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="reshaping.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg)</span>
<span id="cb213-2"><a href="reshaping.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 4</span></span>
<span id="cb213-3"><a href="reshaping.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   MONTH2, DAY2 [1]</span></span>
<span id="cb213-4"><a href="reshaping.html#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   MONTH2 DAY2   SUSPECT_RACE_DESC~1     n</span></span>
<span id="cb213-5"><a href="reshaping.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;               &lt;int&gt;</span></span>
<span id="cb213-6"><a href="reshaping.html#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday (null)                  1</span></span>
<span id="cb213-7"><a href="reshaping.html#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Friday ASIAN / PACIFIC IS~     1</span></span>
<span id="cb213-8"><a href="reshaping.html#cb213-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Friday BLACK                 104</span></span>
<span id="cb213-9"><a href="reshaping.html#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Friday BLACK HISPANIC         17</span></span>
<span id="cb213-10"><a href="reshaping.html#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Friday WHITE                  16</span></span>
<span id="cb213-11"><a href="reshaping.html#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Friday WHITE HISPANIC         31</span></span>
<span id="cb213-12"><a href="reshaping.html#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with abbreviated variable name</span></span>
<span id="cb213-13"><a href="reshaping.html#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="co"># #   1: SUSPECT_RACE_DESCRIPTION</span></span></code></pre></div>
<p>Each row is now a month-day-of-week-race combination, and we have two additional columns: first the person stopped’s race and then the “n” column, which says how many people of that race were stopped in that month-day-of-week. The first race is “(null)”, which means we don’t know the race. We could keep these values as an “unknown” race, but for simplicity we’ll just remove them using <code>filter()</code>.</p>
<p>To make sure we only have values we expect, we can use the <code>unique()</code> function to check that we have only months and week-days we expect, and that our race names are consistent. This is important because even though you know, for example, that there are only seven days in a week, there may be more in our data due to typos or erroneous data entry. So it is always good to check.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="reshaping.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(sqf_agg<span class="sc">$</span>MONTH2)</span>
<span id="cb214-2"><a href="reshaping.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] &quot;April&quot;     &quot;August&quot;    &quot;December&quot; </span></span>
<span id="cb214-3"><a href="reshaping.html#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  [4] &quot;February&quot;  &quot;January&quot;   &quot;July&quot;     </span></span>
<span id="cb214-4"><a href="reshaping.html#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  [7] &quot;June&quot;      &quot;March&quot;     &quot;May&quot;      </span></span>
<span id="cb214-5"><a href="reshaping.html#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [10] &quot;November&quot;  &quot;October&quot;   &quot;September&quot;</span></span>
<span id="cb214-6"><a href="reshaping.html#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(sqf_agg<span class="sc">$</span>DAY2)</span>
<span id="cb214-7"><a href="reshaping.html#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;Friday&quot;    &quot;Monday&quot;    &quot;Saturday&quot; </span></span>
<span id="cb214-8"><a href="reshaping.html#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] &quot;Sunday&quot;    &quot;Thursday&quot;  &quot;Tuesday&quot;  </span></span>
<span id="cb214-9"><a href="reshaping.html#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [7] &quot;Wednesday&quot;</span></span>
<span id="cb214-10"><a href="reshaping.html#cb214-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(sqf_agg<span class="sc">$</span>SUSPECT_RACE_DESCRIPTION)</span>
<span id="cb214-11"><a href="reshaping.html#cb214-11" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;(null)&quot;                   </span></span>
<span id="cb214-12"><a href="reshaping.html#cb214-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] &quot;ASIAN / PACIFIC ISLANDER&quot; </span></span>
<span id="cb214-13"><a href="reshaping.html#cb214-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] &quot;BLACK&quot;                    </span></span>
<span id="cb214-14"><a href="reshaping.html#cb214-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] &quot;BLACK HISPANIC&quot;           </span></span>
<span id="cb214-15"><a href="reshaping.html#cb214-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [5] &quot;WHITE&quot;                    </span></span>
<span id="cb214-16"><a href="reshaping.html#cb214-16" aria-hidden="true" tabindex="-1"></a><span class="co"># [6] &quot;WHITE HISPANIC&quot;           </span></span>
<span id="cb214-17"><a href="reshaping.html#cb214-17" aria-hidden="true" tabindex="-1"></a><span class="co"># [7] &quot;AMERICAN INDIAN/ALASKAN N&quot;</span></span></code></pre></div>
<p>The months and days of the week look good. For an actual data analysis we may want to combine the Hispanic values to a single “Hispanic” value instead of splitting it between “BLACK HISPANIC” and “WHITE HISPANIC”, but for this lesson we’ll leave it as it is.</p>
<p>Now, we want to reshape the data from its current long format to a wide format. We do this using the <code>pivot_wider()</code> function from the <code>tidyr</code> package. In the function we need to input two values, the name of the column, which identifies what each value in the row means, and the column that has that value. In our case this is the “SUSPECT_RACE_DESCRIPTION” column and the “n” column. We don’t need to put the column names in quotes. These function parameters are called “names_from” and “values_from” so we’ll also include that in the <code>pivot_wider()</code> function. And finally before we run <code>pivot_wider()</code>, we’ll first use <code>filter()</code> to remove any row where the race is “(null)”. We’ll assign the result of this code to an object called “sqf_agg_wide” and use <code>head()</code> to look at this result.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="reshaping.html#cb215-1" aria-hidden="true" tabindex="-1"></a>sqf_agg_wide <span class="ot">&lt;-</span> sqf_agg <span class="sc">%&gt;%</span></span>
<span id="cb215-2"><a href="reshaping.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SUSPECT_RACE_DESCRIPTION <span class="sc">!=</span> <span class="st">&quot;(null)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="reshaping.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb215-4"><a href="reshaping.html#cb215-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> SUSPECT_RACE_DESCRIPTION,</span>
<span id="cb215-5"><a href="reshaping.html#cb215-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> n</span>
<span id="cb215-6"><a href="reshaping.html#cb215-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb215-7"><a href="reshaping.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg_wide)</span>
<span id="cb215-8"><a href="reshaping.html#cb215-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 8</span></span>
<span id="cb215-9"><a href="reshaping.html#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   MONTH2, DAY2 [6]</span></span>
<span id="cb215-10"><a href="reshaping.html#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   MONTH2 DAY2     ASIAN /~1 BLACK BLACK~2</span></span>
<span id="cb215-11"><a href="reshaping.html#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;        &lt;int&gt; &lt;int&gt;   &lt;int&gt;</span></span>
<span id="cb215-12"><a href="reshaping.html#cb215-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday           1   104      17</span></span>
<span id="cb215-13"><a href="reshaping.html#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Monday           1    92      10</span></span>
<span id="cb215-14"><a href="reshaping.html#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Saturday         3   115      24</span></span>
<span id="cb215-15"><a href="reshaping.html#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Sunday           2    96      12</span></span>
<span id="cb215-16"><a href="reshaping.html#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Thursday         2   122      10</span></span>
<span id="cb215-17"><a href="reshaping.html#cb215-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Tuesday          7   137      14</span></span>
<span id="cb215-18"><a href="reshaping.html#cb215-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with 3 more variables:</span></span>
<span id="cb215-19"><a href="reshaping.html#cb215-19" aria-hidden="true" tabindex="-1"></a><span class="co"># #   WHITE &lt;int&gt;, `WHITE HISPANIC` &lt;int&gt;,</span></span>
<span id="cb215-20"><a href="reshaping.html#cb215-20" aria-hidden="true" tabindex="-1"></a><span class="co"># #   `AMERICAN INDIAN/ALASKAN N` &lt;int&gt;,</span></span>
<span id="cb215-21"><a href="reshaping.html#cb215-21" aria-hidden="true" tabindex="-1"></a><span class="co"># #   and abbreviated variable names</span></span>
<span id="cb215-22"><a href="reshaping.html#cb215-22" aria-hidden="true" tabindex="-1"></a><span class="co"># #   1: `ASIAN / PACIFIC ISLANDER`,</span></span>
<span id="cb215-23"><a href="reshaping.html#cb215-23" aria-hidden="true" tabindex="-1"></a><span class="co"># #   2: `BLACK HISPANIC`</span></span>
<span id="cb215-24"><a href="reshaping.html#cb215-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # i Use `colnames()` to see all variable names</span></span></code></pre></div>
<p>Now instead of having one row be a month-day-of-week-race combination, each row is a month-day-of-week pair, and we have one column for every race in our data. Each of these race columns tell us how many people of that race were stopped in that month-day-of-week. This allows for really easy comparison of things like racial differences in stops for each month-day-of-week as we just look at different columns in the same row. We have now successfully done our first reshaping, moving this data from long to wide format!</p>
<p>Now we want to reshape it again to go from wide to long. Our race columns names just took the values from the race column, which means that we have column names all in capital letters and with spaces and slashes in them. We could technically use this as it is, but it’s a bit trickier to use any name with punctuation in it, and is against R column name convention, so we’ll quickly fix this. To do so we’ll use the <code>make_clean_names()</code> function from the <code>janitor</code> package that automatically makes all character inputs to the function lowercase and replaces all punctuation with an underscore. First, we need to install the package with <code>install.packages()</code>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="reshaping.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;janitor&quot;</span>)</span></code></pre></div>
<p>To use this function on the column names we’ll make the input of the function <code>names(sqf_agg_wide)</code>, which returns the names of the “sqf_agg_wide” data, and assign the result back into <code>names(sqf_agg_wide)</code>. It might look weird to put a function inside of a function, but R is completely fine with it. Running <code>names(sqf_agg_wide)</code> at the end will print out the column names so we can check that it worked.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="reshaping.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb217-2"><a href="reshaping.html#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb217-3"><a href="reshaping.html#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Attaching package: &#39;janitor&#39;</span></span>
<span id="cb217-4"><a href="reshaping.html#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb217-5"><a href="reshaping.html#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb217-6"><a href="reshaping.html#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     chisq.test, fisher.test</span></span>
<span id="cb217-7"><a href="reshaping.html#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sqf_agg_wide) <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(<span class="fu">names</span>(sqf_agg_wide))</span>
<span id="cb217-8"><a href="reshaping.html#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sqf_agg_wide)</span>
<span id="cb217-9"><a href="reshaping.html#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;month2&quot;                   </span></span>
<span id="cb217-10"><a href="reshaping.html#cb217-10" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] &quot;day2&quot;                     </span></span>
<span id="cb217-11"><a href="reshaping.html#cb217-11" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] &quot;asian_pacific_islander&quot;   </span></span>
<span id="cb217-12"><a href="reshaping.html#cb217-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] &quot;black&quot;                    </span></span>
<span id="cb217-13"><a href="reshaping.html#cb217-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [5] &quot;black_hispanic&quot;           </span></span>
<span id="cb217-14"><a href="reshaping.html#cb217-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [6] &quot;white&quot;                    </span></span>
<span id="cb217-15"><a href="reshaping.html#cb217-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [7] &quot;white_hispanic&quot;           </span></span>
<span id="cb217-16"><a href="reshaping.html#cb217-16" aria-hidden="true" tabindex="-1"></a><span class="co"># [8] &quot;american_indian_alaskan_n&quot;</span></span></code></pre></div>
<p>Now each column name is lowercased and has only underscores instead of spaces and slashes.</p>
<p>To reshape this wide data to long format, we’ll use the <code>tidyr</code> function <code>pivot_longer()</code>. There are three inputs here: “cols”, which takes a vector of column names which have our value variables; “names_to”, which is what it’ll call the newly created categorical variable; and “values_to”, which is what it’ll call the newly created values column. For “cols” we want to include each of our race columns, and these column names must be in quotes and in a vector as there are multiple columns. For “names_to” we can call it whatever we want, but here we’ll call it “race” as the variable is about the race of the person who was stopped. And for “values_to” we’ll call it “number_of_people_stopped” though we can call it whatever we like.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="reshaping.html#cb218-1" aria-hidden="true" tabindex="-1"></a>sqf_agg_long <span class="ot">&lt;-</span> sqf_agg_wide <span class="sc">%&gt;%</span></span>
<span id="cb218-2"><a href="reshaping.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb218-3"><a href="reshaping.html#cb218-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb218-4"><a href="reshaping.html#cb218-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;asian_pacific_islander&quot;</span>,</span>
<span id="cb218-5"><a href="reshaping.html#cb218-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;black&quot;</span>,</span>
<span id="cb218-6"><a href="reshaping.html#cb218-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;black_hispanic&quot;</span>,</span>
<span id="cb218-7"><a href="reshaping.html#cb218-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;white&quot;</span>,</span>
<span id="cb218-8"><a href="reshaping.html#cb218-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;white_hispanic&quot;</span>,</span>
<span id="cb218-9"><a href="reshaping.html#cb218-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;american_indian_alaskan_n&quot;</span></span>
<span id="cb218-10"><a href="reshaping.html#cb218-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb218-11"><a href="reshaping.html#cb218-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;race&quot;</span>,</span>
<span id="cb218-12"><a href="reshaping.html#cb218-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;number_of_people_stopped&quot;</span></span>
<span id="cb218-13"><a href="reshaping.html#cb218-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb218-14"><a href="reshaping.html#cb218-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg_long)</span>
<span id="cb218-15"><a href="reshaping.html#cb218-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 4</span></span>
<span id="cb218-16"><a href="reshaping.html#cb218-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   month2, day2 [1]</span></span>
<span id="cb218-17"><a href="reshaping.html#cb218-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   month2 day2   race              numbe~1</span></span>
<span id="cb218-18"><a href="reshaping.html#cb218-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;               &lt;int&gt;</span></span>
<span id="cb218-19"><a href="reshaping.html#cb218-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday asian_pacific_is~       1</span></span>
<span id="cb218-20"><a href="reshaping.html#cb218-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Friday black                 104</span></span>
<span id="cb218-21"><a href="reshaping.html#cb218-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Friday black_hispanic         17</span></span>
<span id="cb218-22"><a href="reshaping.html#cb218-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Friday white                  16</span></span>
<span id="cb218-23"><a href="reshaping.html#cb218-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Friday white_hispanic         31</span></span>
<span id="cb218-24"><a href="reshaping.html#cb218-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Friday american_indian_~      NA</span></span>
<span id="cb218-25"><a href="reshaping.html#cb218-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with abbreviated variable name</span></span>
<span id="cb218-26"><a href="reshaping.html#cb218-26" aria-hidden="true" tabindex="-1"></a><span class="co"># #   1: number_of_people_stopped</span></span></code></pre></div>
<p>In some cases you’ll have many columns that you want to include while reshaping, which makes writing them all out by hand time consuming. If all of the columns are sequential you can use a trick in this function by writing <code>first_column:last_column</code> where the : will make it include each column (in order) from the first one you input to the last one. This is doing the same thing as <code>1:3</code>, which returns 1, 2, and 3, but for columns instead of numbers. This doesn’t work in most cases but does work for many tidyverse packages. There are also a large number of functions from the <code>dplyr</code> package that are for selecting columns, and are very helpful for doing things like this. The functions are numerous and have changed relatively frequently in the past so I won’t cover them in this book, but if you’re interested you can look at them on <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html">this page</a> of <code>dplyr</code>’s website.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="reshaping.html#cb219-1" aria-hidden="true" tabindex="-1"></a>sqf_agg_long <span class="ot">&lt;-</span> sqf_agg_wide <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="reshaping.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb219-3"><a href="reshaping.html#cb219-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> asian_pacific_islander<span class="sc">:</span>american_indian_alaskan_n,</span>
<span id="cb219-4"><a href="reshaping.html#cb219-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;race&quot;</span>,</span>
<span id="cb219-5"><a href="reshaping.html#cb219-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;number_of_people_stopped&quot;</span></span>
<span id="cb219-6"><a href="reshaping.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb219-7"><a href="reshaping.html#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg_long)</span>
<span id="cb219-8"><a href="reshaping.html#cb219-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 4</span></span>
<span id="cb219-9"><a href="reshaping.html#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   month2, day2 [1]</span></span>
<span id="cb219-10"><a href="reshaping.html#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   month2 day2   race              numbe~1</span></span>
<span id="cb219-11"><a href="reshaping.html#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;               &lt;int&gt;</span></span>
<span id="cb219-12"><a href="reshaping.html#cb219-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday asian_pacific_is~       1</span></span>
<span id="cb219-13"><a href="reshaping.html#cb219-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Friday black                 104</span></span>
<span id="cb219-14"><a href="reshaping.html#cb219-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Friday black_hispanic         17</span></span>
<span id="cb219-15"><a href="reshaping.html#cb219-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Friday white                  16</span></span>
<span id="cb219-16"><a href="reshaping.html#cb219-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Friday white_hispanic         31</span></span>
<span id="cb219-17"><a href="reshaping.html#cb219-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Friday american_indian_~      NA</span></span>
<span id="cb219-18"><a href="reshaping.html#cb219-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with abbreviated variable name</span></span>
<span id="cb219-19"><a href="reshaping.html#cb219-19" aria-hidden="true" tabindex="-1"></a><span class="co"># #   1: number_of_people_stopped</span></span></code></pre></div>
</div>
<div id="reshaping-multiple-columns" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Reshaping multiple columns<a href="reshaping.html#reshaping-multiple-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far we’ve just been reshaping using a single column. This is the simplest method, but in some cases we’ll need to reshape using multiple columns. As an example, let’s make a new column called “n2” in our “sqf_agg” data set, which just adds 10 to the value in our “n” column.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="reshaping.html#cb220-1" aria-hidden="true" tabindex="-1"></a>sqf_agg<span class="sc">$</span>n2 <span class="ot">&lt;-</span> sqf_agg<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">10</span></span></code></pre></div>
<p>Since these columns both relate to the race column (called “SUSPECT_RACE_DESCRIPTION”) we can reuse the <code>pivot_wider()</code> code from before, but now the <code>values_from</code> parameter takes a vector of column names instead of a single column name. Here we want to include both the “n” and the “n2” column. Since it’s a <code>dplyr</code> function it’s not necessary to put the column names in quotes. We also want to keep our <code>filter()</code> function from before which removes “(null)” races and then add a <code>head()</code> function at the end so it prints out the first six rows of our resulting data set.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="reshaping.html#cb221-1" aria-hidden="true" tabindex="-1"></a>sqf_agg_wide <span class="ot">&lt;-</span> sqf_agg <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="reshaping.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SUSPECT_RACE_DESCRIPTION <span class="sc">!=</span> <span class="st">&quot;(null)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-3"><a href="reshaping.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb221-4"><a href="reshaping.html#cb221-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> SUSPECT_RACE_DESCRIPTION,</span>
<span id="cb221-5"><a href="reshaping.html#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(n, n2)</span>
<span id="cb221-6"><a href="reshaping.html#cb221-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb221-7"><a href="reshaping.html#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sqf_agg_wide) <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(<span class="fu">names</span>(sqf_agg_wide))</span>
<span id="cb221-8"><a href="reshaping.html#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg_wide)</span>
<span id="cb221-9"><a href="reshaping.html#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 14</span></span>
<span id="cb221-10"><a href="reshaping.html#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   month2, day2 [6]</span></span>
<span id="cb221-11"><a href="reshaping.html#cb221-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   month2 day2     n_asi~1 n_black n_bla~2</span></span>
<span id="cb221-12"><a href="reshaping.html#cb221-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;      &lt;int&gt;   &lt;int&gt;   &lt;int&gt;</span></span>
<span id="cb221-13"><a href="reshaping.html#cb221-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday         1     104      17</span></span>
<span id="cb221-14"><a href="reshaping.html#cb221-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Monday         1      92      10</span></span>
<span id="cb221-15"><a href="reshaping.html#cb221-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Saturday       3     115      24</span></span>
<span id="cb221-16"><a href="reshaping.html#cb221-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Sunday         2      96      12</span></span>
<span id="cb221-17"><a href="reshaping.html#cb221-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Thursday       2     122      10</span></span>
<span id="cb221-18"><a href="reshaping.html#cb221-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Tuesday        7     137      14</span></span>
<span id="cb221-19"><a href="reshaping.html#cb221-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with 9 more variables:</span></span>
<span id="cb221-20"><a href="reshaping.html#cb221-20" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n_white &lt;int&gt;,</span></span>
<span id="cb221-21"><a href="reshaping.html#cb221-21" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n_white_hispanic &lt;int&gt;,</span></span>
<span id="cb221-22"><a href="reshaping.html#cb221-22" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n_american_indian_alaskan_n &lt;int&gt;,</span></span>
<span id="cb221-23"><a href="reshaping.html#cb221-23" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n2_asian_pacific_islander &lt;dbl&gt;,</span></span>
<span id="cb221-24"><a href="reshaping.html#cb221-24" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n2_black &lt;dbl&gt;,</span></span>
<span id="cb221-25"><a href="reshaping.html#cb221-25" aria-hidden="true" tabindex="-1"></a><span class="co"># #   n2_black_hispanic &lt;dbl&gt;, ...</span></span>
<span id="cb221-26"><a href="reshaping.html#cb221-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # i Use `colnames()` to see all variable names</span></span></code></pre></div>
<p>We now have the same wide data set as before, but now there are twice as many race columns. And the <code>pivot_wider()</code> function renamed the columns so we can tell the “n” columns from the “n2” columns. The easiest way to reshape this data from wide to long is to again use the <code>pivot_longer()</code> function but now use it twice: first to reshape the “n” columns and then to reshape the “n2” columns. We’ll use the exact same code as before, but change the column names to suit their new names.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="reshaping.html#cb222-1" aria-hidden="true" tabindex="-1"></a>sqf_agg_long <span class="ot">&lt;-</span> sqf_agg_wide <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="reshaping.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb222-3"><a href="reshaping.html#cb222-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb222-4"><a href="reshaping.html#cb222-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_asian_pacific_islander&quot;</span>,</span>
<span id="cb222-5"><a href="reshaping.html#cb222-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_black&quot;</span>,</span>
<span id="cb222-6"><a href="reshaping.html#cb222-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_black_hispanic&quot;</span>,</span>
<span id="cb222-7"><a href="reshaping.html#cb222-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_white&quot;</span>,</span>
<span id="cb222-8"><a href="reshaping.html#cb222-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_white_hispanic&quot;</span>,</span>
<span id="cb222-9"><a href="reshaping.html#cb222-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_american_indian_alaskan_n&quot;</span></span>
<span id="cb222-10"><a href="reshaping.html#cb222-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb222-11"><a href="reshaping.html#cb222-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;race&quot;</span>,</span>
<span id="cb222-12"><a href="reshaping.html#cb222-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;number_of_people_stopped&quot;</span></span>
<span id="cb222-13"><a href="reshaping.html#cb222-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb222-14"><a href="reshaping.html#cb222-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb222-15"><a href="reshaping.html#cb222-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb222-16"><a href="reshaping.html#cb222-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_asian_pacific_islander&quot;</span>,</span>
<span id="cb222-17"><a href="reshaping.html#cb222-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_black&quot;</span>,</span>
<span id="cb222-18"><a href="reshaping.html#cb222-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_black_hispanic&quot;</span>,</span>
<span id="cb222-19"><a href="reshaping.html#cb222-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_white&quot;</span>,</span>
<span id="cb222-20"><a href="reshaping.html#cb222-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_white_hispanic&quot;</span>,</span>
<span id="cb222-21"><a href="reshaping.html#cb222-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n2_american_indian_alaskan_n&quot;</span></span>
<span id="cb222-22"><a href="reshaping.html#cb222-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb222-23"><a href="reshaping.html#cb222-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;race2&quot;</span>,</span>
<span id="cb222-24"><a href="reshaping.html#cb222-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;number_of_people_stopped2&quot;</span></span>
<span id="cb222-25"><a href="reshaping.html#cb222-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb222-26"><a href="reshaping.html#cb222-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sqf_agg_long)</span>
<span id="cb222-27"><a href="reshaping.html#cb222-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 x 6</span></span>
<span id="cb222-28"><a href="reshaping.html#cb222-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # Groups:   month2, day2 [1]</span></span>
<span id="cb222-29"><a href="reshaping.html#cb222-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   month2 day2   race        numbe~1 race2</span></span>
<span id="cb222-30"><a href="reshaping.html#cb222-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb222-31"><a href="reshaping.html#cb222-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 April  Friday n_asian_pa~       1 n2_a~</span></span>
<span id="cb222-32"><a href="reshaping.html#cb222-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 April  Friday n_asian_pa~       1 n2_b~</span></span>
<span id="cb222-33"><a href="reshaping.html#cb222-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 April  Friday n_asian_pa~       1 n2_b~</span></span>
<span id="cb222-34"><a href="reshaping.html#cb222-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 April  Friday n_asian_pa~       1 n2_w~</span></span>
<span id="cb222-35"><a href="reshaping.html#cb222-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 April  Friday n_asian_pa~       1 n2_w~</span></span>
<span id="cb222-36"><a href="reshaping.html#cb222-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 April  Friday n_asian_pa~       1 n2_a~</span></span>
<span id="cb222-37"><a href="reshaping.html#cb222-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # ... with 1 more variable:</span></span>
<span id="cb222-38"><a href="reshaping.html#cb222-38" aria-hidden="true" tabindex="-1"></a><span class="co"># #   number_of_people_stopped2 &lt;dbl&gt;, and</span></span>
<span id="cb222-39"><a href="reshaping.html#cb222-39" aria-hidden="true" tabindex="-1"></a><span class="co"># #   abbreviated variable name</span></span>
<span id="cb222-40"><a href="reshaping.html#cb222-40" aria-hidden="true" tabindex="-1"></a><span class="co"># #   1: number_of_people_stopped</span></span>
<span id="cb222-41"><a href="reshaping.html#cb222-41" aria-hidden="true" tabindex="-1"></a><span class="co"># # i Use `colnames()` to see all variable names</span></span></code></pre></div>
<p>This now gives us two race columns - “race” and “race2” - which are ordered differently so we need to make sure to either reorder the data to be the same ordering or to keep that in mind when comparing the “number_of_people_stopped” and “number_of_people_stopped2” columns as they frequently refer to different races.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="regular-expressions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphing-intro.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": true,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/crimebythenumbers/edit/master/reshaping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
