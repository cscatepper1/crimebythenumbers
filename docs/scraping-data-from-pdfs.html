<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Scraping data from PDFs | R 4 Criminology</title>
  <meta name="description" content="These notes introduce the programming language R and are meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information such as cleaning the data, graphing it, or running statistical tests on the data. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Scraping data from PDFs | R 4 Criminology" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://r4crim.com" />
  <meta property="og:image" content="https://r4crim.comRuby-throated_HummingBird.jpg" />
  <meta property="og:description" content="These notes introduce the programming language R and are meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information such as cleaning the data, graphing it, or running statistical tests on the data. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="github-repo" content="jacobkap/r4crim" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Scraping data from PDFs | R 4 Criminology" />
  
  <meta name="twitter:description" content="These notes introduce the programming language R and are meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information such as cleaning the data, graphing it, or running statistical tests on the data. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="twitter:image" content="https://r4crim.comRuby-throated_HummingBird.jpg" />

<meta name="author" content="Jacob Kaplan" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading-and-writing-data.html">
<link rel="next" href="scrape-table.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Criminology</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-will-learn"><i class="fa fa-check"></i>What you will learn</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i>Skills</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i>Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-wont-learn"><i class="fa fa-check"></i>What you won’t learn</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#simple-vs-easy"><i class="fa fa-check"></i>Simple vs Easy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to Contribute</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#why-learn-to-program"><i class="fa fa-check"></i><b>1.1</b> Why learn to program?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#scale"><i class="fa fa-check"></i><b>1.1.1</b> Scale</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#reproducibility"><i class="fa fa-check"></i><b>1.1.2</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#using-rstudio"><i class="fa fa-check"></i><b>1.2</b> Using RStudio</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#opening-an-r-script"><i class="fa fa-check"></i><b>1.2.1</b> Opening an R Script</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#setting-the-working-directory"><i class="fa fa-check"></i><b>1.2.2</b> Setting the working directory</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#changing-rstudio"><i class="fa fa-check"></i><b>1.2.3</b> Changing RStudio</a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#helpful-cheatsheets"><i class="fa fa-check"></i><b>1.2.4</b> Helpful cheatsheets</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.3</b> Reading data into R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#loading-data"><i class="fa fa-check"></i><b>1.3.1</b> Loading data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#first-steps-to-exploring-data"><i class="fa fa-check"></i><b>1.4</b> First steps to exploring data</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#finding-help-about-functions"><i class="fa fa-check"></i><b>1.5</b> Finding help about functions</a></li>
</ul></li>
<li class="part"><span><b>I Clean</b></span></li>
<li class="chapter" data-level="2" data-path="subsetting-intro.html"><a href="subsetting-intro.html"><i class="fa fa-check"></i><b>2</b> Subsetting: Making big things small</a><ul>
<li class="chapter" data-level="2.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-values"><i class="fa fa-check"></i><b>2.1</b> Select specific values</a></li>
<li class="chapter" data-level="2.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#assignment"><i class="fa fa-check"></i><b>2.2</b> Assignment values to objects (Making “things”)</a></li>
<li class="chapter" data-level="2.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#vectors"><i class="fa fa-check"></i><b>2.3</b> Vectors (collections of “things”)</a></li>
<li class="chapter" data-level="2.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#logical-values-and-operations"><i class="fa fa-check"></i><b>2.4</b> Logical values and operations</a><ul>
<li class="chapter" data-level="2.4.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-a-single-value"><i class="fa fa-check"></i><b>2.4.1</b> Matching a single value</a></li>
<li class="chapter" data-level="2.4.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-multiple-values"><i class="fa fa-check"></i><b>2.4.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="2.4.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#does-not-match"><i class="fa fa-check"></i><b>2.4.3</b> Does not match</a></li>
<li class="chapter" data-level="2.4.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>2.4.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="2.4.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>2.4.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>2.5</b> Subsetting a data.frame</a><ul>
<li class="chapter" data-level="2.5.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-columns"><i class="fa fa-check"></i><b>2.5.1</b> Select specific columns</a></li>
<li class="chapter" data-level="2.5.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-rows"><i class="fa fa-check"></i><b>2.5.2</b> Select specific rows</a></li>
<li class="chapter" data-level="2.5.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#battleships"><i class="fa fa-check"></i><b>2.5.3</b> Battleships</a></li>
<li class="chapter" data-level="2.5.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subset-colorado-data"><i class="fa fa-check"></i><b>2.5.4</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="explore.html"><a href="explore.html"><i class="fa fa-check"></i><b>3</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="explore.html"><a href="explore.html#summary-and-table"><i class="fa fa-check"></i><b>3.1</b> Summary and Table</a></li>
<li class="chapter" data-level="3.2" data-path="explore.html"><a href="explore.html#graphing"><i class="fa fa-check"></i><b>3.2</b> Graphing</a></li>
<li class="chapter" data-level="3.3" data-path="explore.html"><a href="explore.html#aggregate"><i class="fa fa-check"></i><b>3.3</b> Aggregating (summaries of groups)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>4</b> Dates and Times</a><ul>
<li class="chapter" data-level="4.1" data-path="dates-and-times.html"><a href="dates-and-times.html#why-do-dates-and-times-matter"><i class="fa fa-check"></i><b>4.1</b> Why do dates and times matter?</a></li>
<li class="chapter" data-level="4.2" data-path="dates-and-times.html"><a href="dates-and-times.html#lubridate"><i class="fa fa-check"></i><b>4.2</b> <code>lubridate</code></a></li>
<li class="chapter" data-level="4.3" data-path="dates-and-times.html"><a href="dates-and-times.html#working-with-dates"><i class="fa fa-check"></i><b>4.3</b> Working with dates</a></li>
<li class="chapter" data-level="4.4" data-path="dates-and-times.html"><a href="dates-and-times.html#chicago-crime-data"><i class="fa fa-check"></i><b>4.4</b> Chicago crime data</a><ul>
<li class="chapter" data-level="4.4.1" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises"><i class="fa fa-check"></i><b>4.4.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>5</b> Regular Expressions</a><ul>
<li class="chapter" data-level="5.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>5.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="5.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>5.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="5.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>5.3</b> Useful special characters</a><ul>
<li class="chapter" data-level="5.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>5.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>5.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>5.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="5.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string-and-not"><i class="fa fa-check"></i><b>5.3.4</b> Start of string and “not” <code>^</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>5.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="5.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>5.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="5.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>5.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="5.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>5.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="5.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>5.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="5.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>5.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="5.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>5.3.11</b> Optional text <code>?</code></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>5.4</b> Changing capitalization</a></li>
</ul></li>
<li class="part"><span><b>II Collect</b></span></li>
<li class="chapter" data-level="6" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>6</b> Webscraping with <code>rvest</code></a><ul>
<li class="chapter" data-level="6.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>6.1</b> Scraping one page</a></li>
<li class="chapter" data-level="6.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>6.2</b> Cleaning the webscraped data</a></li>
<li class="chapter" data-level="6.3" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#fixing-names"><i class="fa fa-check"></i><b>6.3</b> Fixing names</a><ul>
<li class="chapter" data-level="6.3.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#exercises-1"><i class="fa fa-check"></i><b>6.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>7</b> Functions</a><ul>
<li class="chapter" data-level="7.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>7.1</b> A simple function</a></li>
<li class="chapter" data-level="7.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>7.2</b> Adding parameters</a></li>
<li class="chapter" data-level="7.3" data-path="functions.html"><a href="functions.html#movie_function"><i class="fa fa-check"></i><b>7.3</b> Making a function to scrape movie data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>8</b> For loops</a><ul>
<li class="chapter" data-level="8.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>8.1</b> Basic for loops</a></li>
<li class="chapter" data-level="8.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-days-of-movie-data"><i class="fa fa-check"></i><b>8.2</b> Scraping multiple days of movie data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>9</b> Reading and Writing Data</a><ul>
<li class="chapter" data-level="9.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>9.1</b> Reading Data into R</a><ul>
<li class="chapter" data-level="9.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r"><i class="fa fa-check"></i><b>9.1.1</b> R</a></li>
<li class="chapter" data-level="9.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel"><i class="fa fa-check"></i><b>9.1.2</b> Excel</a></li>
<li class="chapter" data-level="9.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata"><i class="fa fa-check"></i><b>9.1.3</b> Stata</a></li>
<li class="chapter" data-level="9.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas"><i class="fa fa-check"></i><b>9.1.4</b> SAS</a></li>
<li class="chapter" data-level="9.1.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss"><i class="fa fa-check"></i><b>9.1.5</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>9.2</b> Writing Data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-1"><i class="fa fa-check"></i><b>9.2.1</b> R</a></li>
<li class="chapter" data-level="9.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-1"><i class="fa fa-check"></i><b>9.2.2</b> Excel</a></li>
<li class="chapter" data-level="9.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-1"><i class="fa fa-check"></i><b>9.2.3</b> Stata</a></li>
<li class="chapter" data-level="9.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-1"><i class="fa fa-check"></i><b>9.2.4</b> SAS</a></li>
<li class="chapter" data-level="9.2.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss-1"><i class="fa fa-check"></i><b>9.2.5</b> SPSS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html"><i class="fa fa-check"></i><b>10</b> Scraping data from PDFs</a><ul>
<li class="chapter" data-level="10.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#downloading-officer-involved-shooting-files"><i class="fa fa-check"></i><b>10.1</b> Downloading officer-involved Shooting Files</a></li>
<li class="chapter" data-level="10.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-information-from-the-page"><i class="fa fa-check"></i><b>10.2</b> Scraping information from the page</a><ul>
<li class="chapter" data-level="10.2.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#combining-the-data-sets"><i class="fa fa-check"></i><b>10.2.1</b> Combining the data sets</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#extracting-data-from-pdfs"><i class="fa fa-check"></i><b>10.3</b> Extracting data from PDFs</a><ul>
<li class="chapter" data-level="10.3.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-a-single-pdf"><i class="fa fa-check"></i><b>10.3.1</b> Scraping a single PDF</a></li>
<li class="chapter" data-level="10.3.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#making-a-function"><i class="fa fa-check"></i><b>10.3.2</b> Making a function</a></li>
<li class="chapter" data-level="10.3.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#looping-through-every-pdf"><i class="fa fa-check"></i><b>10.3.3</b> Looping through every PDF</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="scrape-table.html"><a href="scrape-table.html"><i class="fa fa-check"></i><b>11</b> Scraping Tables from PDFs</a><ul>
<li class="chapter" data-level="11.1" data-path="scrape-table.html"><a href="scrape-table.html#scraping-the-first-table"><i class="fa fa-check"></i><b>11.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="11.2" data-path="scrape-table.html"><a href="scrape-table.html#making-a-function-1"><i class="fa fa-check"></i><b>11.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>12</b> Geocoding</a><ul>
<li class="chapter" data-level="12.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>12.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="12.2" data-path="geocoding.html"><a href="geocoding.html#making-a-function-2"><i class="fa fa-check"></i><b>12.2</b> Making a function</a></li>
<li class="chapter" data-level="12.3" data-path="geocoding.html"><a href="geocoding.html#geocoding-officer-shooting-locations"><i class="fa fa-check"></i><b>12.3</b> Geocoding officer shooting locations</a></li>
</ul></li>
<li class="part"><span><b>III Visualize</b></span></li>
<li class="chapter" data-level="13" data-path="graphing-intro.html"><a href="graphing-intro.html"><i class="fa fa-check"></i><b>13</b> Graphing with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="13.1" data-path="graphing-intro.html"><a href="graphing-intro.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>13.1</b> What does the data look like?</a></li>
<li class="chapter" data-level="13.2" data-path="graphing-intro.html"><a href="graphing-intro.html#graphing-data"><i class="fa fa-check"></i><b>13.2</b> Graphing data</a></li>
<li class="chapter" data-level="13.3" data-path="graphing-intro.html"><a href="graphing-intro.html#time-series-plots"><i class="fa fa-check"></i><b>13.3</b> Time-Series Plots</a></li>
<li class="chapter" data-level="13.4" data-path="graphing-intro.html"><a href="graphing-intro.html#color-blindness"><i class="fa fa-check"></i><b>13.4</b> Color blindness</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>14</b> Hotspot maps</a><ul>
<li class="chapter" data-level="14.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#a-simple-map"><i class="fa fa-check"></i><b>14.1</b> A simple map</a></li>
<li class="chapter" data-level="14.2" data-path="hotspot-maps.html"><a href="hotspot-maps.html#what-really-are-maps"><i class="fa fa-check"></i><b>14.2</b> What really are maps?</a></li>
<li class="chapter" data-level="14.3" data-path="hotspot-maps.html"><a href="hotspot-maps.html#making-a-hotspot-map"><i class="fa fa-check"></i><b>14.3</b> Making a hotspot map</a><ul>
<li class="chapter" data-level="14.3.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#colors"><i class="fa fa-check"></i><b>14.3.1</b> Colors</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="hotspot-maps.html"><a href="hotspot-maps.html#looping-through-each-year"><i class="fa fa-check"></i><b>14.4</b> Looping through each year</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>15</b> Choropleth Maps</a><ul>
<li class="chapter" data-level="15.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>15.1</b> Spatial joins</a></li>
<li class="chapter" data-level="15.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>15.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>16</b> Interactive Maps</a><ul>
<li class="chapter" data-level="16.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>16.1</b> Why do interactive graphs matter?</a><ul>
<li class="chapter" data-level="16.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>16.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="16.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>16.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>16.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="16.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>16.3</b> Adding popup information</a></li>
<li class="chapter" data-level="16.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>16.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="16.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-choropleth-maps"><i class="fa fa-check"></i><b>16.5</b> Interactive choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="ois-graphs.html"><a href="ois-graphs.html"><i class="fa fa-check"></i><b>17</b> More Graphing with <code>ggplot</code></a><ul>
<li class="chapter" data-level="17.1" data-path="ois-graphs.html"><a href="ois-graphs.html#graphing-a-single-variable"><i class="fa fa-check"></i><b>17.1</b> Graphing a single variable</a><ul>
<li class="chapter" data-level="17.1.1" data-path="ois-graphs.html"><a href="ois-graphs.html#numeric-variable"><i class="fa fa-check"></i><b>17.1.1</b> Numeric variable</a></li>
<li class="chapter" data-level="17.1.2" data-path="ois-graphs.html"><a href="ois-graphs.html#categorical-variable"><i class="fa fa-check"></i><b>17.1.2</b> Categorical variable</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="ois-graphs.html"><a href="ois-graphs.html#time-series"><i class="fa fa-check"></i><b>17.2</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>18</b> R Markdown</a><ul>
<li class="chapter" data-level="18.1" data-path="r-markdown.html"><a href="r-markdown.html#code-1"><i class="fa fa-check"></i><b>18.1</b> Code</a><ul>
<li class="chapter" data-level="18.1.1" data-path="r-markdown.html"><a href="r-markdown.html#hiding-code-in-the-output"><i class="fa fa-check"></i><b>18.1.1</b> Hiding code in the output</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="r-markdown.html"><a href="r-markdown.html#making-tables"><i class="fa fa-check"></i><b>18.2</b> Making tables</a></li>
<li class="chapter" data-level="18.3" data-path="r-markdown.html"><a href="r-markdown.html#making-the-output-file"><i class="fa fa-check"></i><b>18.3</b> Making the output file</a></li>
</ul></li>
<li class="part"><span><b>IV Data</b></span></li>
<li class="chapter" data-level="19" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>19</b> Introduction</a></li>
<li class="chapter" data-level="20" data-path="ucr.html"><a href="ucr.html"><i class="fa fa-check"></i><b>20</b> Uniform Crime Report (UCR) Data - Offenses Known and Clearances by Arrest</a><ul>
<li class="chapter" data-level="20.1" data-path="ucr.html"><a href="ucr.html#exploring-the-ucr-data"><i class="fa fa-check"></i><b>20.1</b> Exploring the UCR data</a></li>
<li class="chapter" data-level="20.2" data-path="ucr.html"><a href="ucr.html#oris---unique-agency-identifies"><i class="fa fa-check"></i><b>20.2</b> ORIs - Unique agency identifies</a></li>
<li class="chapter" data-level="20.3" data-path="ucr.html"><a href="ucr.html#hierarchy-rule"><i class="fa fa-check"></i><b>20.3</b> Hierarchy Rule</a></li>
<li class="chapter" data-level="20.4" data-path="ucr.html"><a href="ucr.html#which-crimes-are-included"><i class="fa fa-check"></i><b>20.4</b> Which crimes are included</a><ul>
<li class="chapter" data-level="20.4.1" data-path="ucr.html"><a href="ucr.html#index-crimes"><i class="fa fa-check"></i><b>20.4.1</b> Index Crimes</a></li>
<li class="chapter" data-level="20.4.2" data-path="ucr.html"><a href="ucr.html#the-problem-with-using-index-crimes"><i class="fa fa-check"></i><b>20.4.2</b> The problem with using index crimes</a></li>
<li class="chapter" data-level="20.4.3" data-path="ucr.html"><a href="ucr.html#rape-definition-change"><i class="fa fa-check"></i><b>20.4.3</b> Rape definition change</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="ucr.html"><a href="ucr.html#actual-offenses-clearances-and-unfounded-offenses"><i class="fa fa-check"></i><b>20.5</b> Actual offenses, clearances, and unfounded offenses</a><ul>
<li class="chapter" data-level="20.5.1" data-path="ucr.html"><a href="ucr.html#actual"><i class="fa fa-check"></i><b>20.5.1</b> Actual</a></li>
<li class="chapter" data-level="20.5.2" data-path="ucr.html"><a href="ucr.html#total-cleared"><i class="fa fa-check"></i><b>20.5.2</b> Total Cleared</a></li>
<li class="chapter" data-level="20.5.3" data-path="ucr.html"><a href="ucr.html#cleared-where-all-offenders-are-under-18"><i class="fa fa-check"></i><b>20.5.3</b> Cleared Where All Offenders Are Under 18</a></li>
<li class="chapter" data-level="20.5.4" data-path="ucr.html"><a href="ucr.html#unfounded"><i class="fa fa-check"></i><b>20.5.4</b> Unfounded</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html"><i class="fa fa-check"></i><b>21</b> Census Data from Social Explorer</a><ul>
<li class="chapter" data-level="21.1" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html#getting-census-data-from-social-explorer"><i class="fa fa-check"></i><b>21.1</b> Getting Census data from Social Explorer</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html"><i class="fa fa-check"></i><b>22</b> Census Data from IPUMS</a><ul>
<li class="chapter" data-level="22.1" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#getting-ipums-data"><i class="fa fa-check"></i><b>22.1</b> Getting IPUMS data</a></li>
<li class="chapter" data-level="22.2" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#cleaning-the-data"><i class="fa fa-check"></i><b>22.2</b> Cleaning the data</a></li>
<li class="chapter" data-level="22.3" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#aggregating-the-data"><i class="fa fa-check"></i><b>22.3</b> Aggregating the data</a></li>
<li class="chapter" data-level="22.4" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#graphing-the-data"><i class="fa fa-check"></i><b>22.4</b> Graphing the data</a></li>
<li class="chapter" data-level="22.5" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#mapping-the-data"><i class="fa fa-check"></i><b>22.5</b> Mapping the data</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="nibrs.html"><a href="nibrs.html"><i class="fa fa-check"></i><b>23</b> National Incident-Based Reporting System (NIBRS) Data</a><ul>
<li class="chapter" data-level="23.1" data-path="nibrs.html"><a href="nibrs.html#downloading-the-data"><i class="fa fa-check"></i><b>23.1</b> Downloading the data</a></li>
<li class="chapter" data-level="23.2" data-path="nibrs.html"><a href="nibrs.html#reading-the-data"><i class="fa fa-check"></i><b>23.2</b> Reading the data</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="useful-resources.html"><a href="useful-resources.html"><i class="fa fa-check"></i><b>A</b> Useful Resources</a><ul>
<li class="chapter" data-level="A.0.1" data-path="useful-resources.html"><a href="useful-resources.html#learning-r-and-coding-issues"><i class="fa fa-check"></i><b>A.0.1</b> Learning R and coding issues</a></li>
<li class="chapter" data-level="A.0.2" data-path="useful-resources.html"><a href="useful-resources.html#data-1"><i class="fa fa-check"></i><b>A.0.2</b> Data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R 4 Criminology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping-data-from-pdfs" class="section level1">
<h1><span class="header-section-number">10</span> Scraping data from PDFs</h1>
<p>Many government agencies will release reports as PDF files with useful data included as tables in the PDF rather than in a more readily accessible form such as a .csv file. This makes it difficult to use as we can’t simply load the PDF into R and start working on the data as we’ve done before. We need to take the data inside the PDF and turn it into a format that R can understand. In Chapter @ref(#scrape-table) we will work on grabbing an entire table from a PDF, in this lesson we will just grab a line of text from the PDF.</p>
<p>For this lesson we’ll use data on officer-involved shootings from the Philadelphia Police Department’s website available <a href="http://www.phillypolice.com/ois/">here</a>. The site contains information about each shooting such as the location and date - which we will scrape from the website - as well as information inside each shooting’s descriptive PDF which we will learn to scrape here.</p>
<p>Our goal here and in the following lessons is to see how the number of officer-involved shootings changed over time and see where in Philadelphia they occurred. For this we need two pieces of information: the date each shooting occurred, and the location of each shooting.</p>
<div id="downloading-officer-involved-shooting-files" class="section level2">
<h2><span class="header-section-number">10.1</span> Downloading officer-involved Shooting Files</h2>
<p>We will use the package <code>rvest</code> which we used to webscrape movie data to help download these files and to get some information off the web page.</p>
<p>As always, we need to use <code>library()</code> to tell R we are going to use functions from this package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
<span class="co">#&gt; Loading required package: xml2</span></code></pre>
<p>The last time we used <code>rvest</code> we did so to get information about movie ticket sales by grabbing data from a table on the page. In this case we are using it for two purposes: to get the link of each PDF on the page to download and to get the address of each incident. Each year of data has its own table with a link to the PDF and the street address of where the shooting took place. For years after 2012 it also includes some useful information about the shooting but we will not be using that information in this lesson.</p>
<p>First we need to get the links of each PDF to download. Since links are simply a special type of text on the page, we can use a similar method to webscraping movie data to get all of the links.</p>
<p>Again we start with using <code>read_html()</code> to read in the page to R and we will save that in an object called “links” since that is what we want to end up with.</p>
<pre class="sourceCode r"><code class="sourceCode r">links &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.phillypolice.com/ois/&quot;</span>)</code></pre>
<p>In this case we don’t need to look on the site to determine the CSS selector, we simply use “a” which will find all links on the page. <code>html_attr("href")</code> converts the XML code for the links to text which we can understand.</p>
<pre class="sourceCode r"><code class="sourceCode r">links &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(links, <span class="st">&quot;a&quot;</span>)
links &lt;-<span class="st"> </span><span class="kw">html_attr</span>(links, <span class="st">&quot;href&quot;</span>)</code></pre>
<p>Now we can take a look at the results and check how many results there are.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(links)
<span class="co">#&gt; [1] &quot;https://www.phillypolice.com/&quot; &quot;/news/index.html&quot;             </span>
<span class="co">#&gt; [3] &quot;/districts-units/index.html&quot;   &quot;/accountability/index.html&quot;   </span>
<span class="co">#&gt; [5] &quot;/programs-services/index.html&quot; &quot;/forms/index.html&quot;</span>
<span class="kw">length</span>(links)
<span class="co">#&gt; [1] 521</span></code></pre>
<p>There are 521 results and of the first 6 none of them are PDFs. This makes sense as our code grabbed every single link on the page, PDF or not. We need a way to subset these links to just those that are PDFs. Since we know that every PDF will end with the text “.pdf” we can use <code>grep()</code> to subset the links to only return those which include “.pdf” in the name. Sometimes the .pdf extension is written .PDF so we will set the parameter <code>ignore.case</code> to TRUE to ignore capitalization.</p>
<pre class="sourceCode r"><code class="sourceCode r">links &lt;-<span class="st"> </span>links[<span class="kw">grep</span>(<span class="st">&quot;.pdf&quot;</span>, links, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(links)
<span class="co">#&gt; [1] &quot;/assets/directives/D10.1.pdf&quot;                                                          </span>
<span class="co">#&gt; [2] &quot;/assets/directives/D10.2-UseOfModerateLimitedForce.pdf&quot;                                </span>
<span class="co">#&gt; [3] &quot;/assets/directives/D10.3-UseOfLessLethalForce.pdf&quot;                                     </span>
<span class="co">#&gt; [4] &quot;/assets/directives/D10.4-UseOfForceReviewBoard.pdf&quot;                                    </span>
<span class="co">#&gt; [5] &quot;/assets/crime-maps-stats/officer-involved-shootings/master-report-ois.pdf&quot;             </span>
<span class="co">#&gt; [6] &quot;/assets/crime-maps-stats/officer-involved-shootings/master-report-explanations-ois.pdf&quot;</span></code></pre>
<p>This looks better but there are still a few files we don’t want even though they are PDFs. By looking through our list of links, and looking at the website as a comparison, it seems that the PDFs with information on officer shootings have the text “officer-involved-shootings” in the name. We can use <code>grep()</code> again to just grab those links.</p>
<pre class="sourceCode r"><code class="sourceCode r">links &lt;-<span class="st"> </span>links[<span class="kw">grep</span>(<span class="st">&quot;officer-involved-shootings&quot;</span>, links)]</code></pre>
<p>Let’s look at the first 10 links to see what files we still have.</p>
<pre class="sourceCode r"><code class="sourceCode r">links[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]
<span class="co">#&gt;  [1] &quot;/assets/crime-maps-stats/officer-involved-shootings/master-report-ois.pdf&quot;             </span>
<span class="co">#&gt;  [2] &quot;/assets/crime-maps-stats/officer-involved-shootings/master-report-explanations-ois.pdf&quot;</span>
<span class="co">#&gt;  [3] &quot;/assets/crime-maps-stats/officer-involved-shootings/Citywide-SV-OIS-2019-Q2.pdf&quot;       </span>
<span class="co">#&gt;  [4] &quot;/assets/crime-maps-stats/officer-involved-shootings/Citywide-Gun-Crime-OIS-2019-Q2.pdf&quot;</span>
<span class="co">#&gt;  [5] &quot;/assets/crime-maps-stats/officer-involved-shootings/ois-19-04.pdf&quot;                     </span>
<span class="co">#&gt;  [6] &quot;/assets/crime-maps-stats/officer-involved-shootings/19-06.pdf&quot;                         </span>
<span class="co">#&gt;  [7] &quot;/assets/crime-maps-stats/officer-involved-shootings/19-09.pdf&quot;                         </span>
<span class="co">#&gt;  [8] &quot;/assets/crime-maps-stats/officer-involved-shootings/19-11.pdf&quot;                         </span>
<span class="co">#&gt;  [9] &quot;/assets/crime-maps-stats/officer-involved-shootings/19-13.pdf&quot;                         </span>
<span class="co">#&gt; [10] &quot;/assets/crime-maps-stats/officer-involved-shootings/19-14.pdf&quot;</span></code></pre>
<p>A few of these PDFs are general reports rather than descriptions of specific shootings. We could specifically delete these through subsetting them out but since it is only a few files we can just download them then not use them.</p>
<p>Now that we have all the links we need, we can use a for loop to download them. To download files in R we will use the function <code>download.file()</code> which, as the name implies, just downloads a file from the internet to your computer. This function takes two inputs: the parameter <code>url</code> is the URL where the file to download is stored (the links in our case), and parameter <code>destfile</code> is the name we will call the file we download.</p>
<p>The links we have do not actually have the full URL we need. Notice that they begin with “/assets” but if you click a link on the web page, the links all start “<a href="http://www.phillypolice.com/assets" class="uri">http://www.phillypolice.com/assets</a>”. In our code we can paste the “<a href="http://www.phillypolice.com" class="uri">http://www.phillypolice.com</a>” part to our link name to make a complete URL to download.</p>
<p>Since all the files have a similar pattern, we can use <code>gsub()</code> to make the name shorter than the long link it comes in. Note that for every link the pattern is the the real file name is at the very end and there are a number of categories broken up by forward slashes. For a quick <code>gsub()</code> can use the special character <code>.</code> (the period or dot) to indicate anything and the special character <code>*</code> (asterix) to indicate “0 or more of the previous character” to say find every character up to and including the forward slash and replace it with nothing.</p>
<p>Using the very first link as an example, the <code>gsub()</code> removes everything except the very last part of the link. It replaces every character up to and including the latest forward slash with an empty string, leaving a useful file name.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="st">&quot;.*/&quot;</span>, <span class="st">&quot;&quot;</span>, links[<span class="dv">1</span>])
<span class="co">#&gt; [1] &quot;master-report-ois.pdf&quot;</span></code></pre>
<p><code>download.file()</code> downloads the file into the current working directory so make sure it is set to where you want the files to go (for this many files it is wise to make a new folder specifically to hold these files). We will set the parameter <code>mode</code> to “wb”. This isn’t strictly necessary but in some cases R has an issue downloading files and this seems to fix it. Since sometimes scraping data from the same page too often causes a download to fail, we will add the code <code>Sys.sleep(1)</code> which forces R to sleep for 1 second. This slows down the code and makes sure we don’t overload the site.</p>
<p>There are 468 files so it will take some time to download them all.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>)

<span class="cf">for</span> (file <span class="cf">in</span> links) {
   url &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;http://www.phillypolice.com&quot;</span>, file, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
   save_name &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;.*/&quot;</span>, <span class="st">&quot;&quot;</span>, file)
   <span class="kw">download.file</span>(<span class="dt">url =</span> url, <span class="dt">destfile =</span> save_name, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)
   <span class="kw">Sys.sleep</span>(<span class="dv">1</span>)
}</code></pre>
</div>
<div id="scraping-information-from-the-page" class="section level2">
<h2><span class="header-section-number">10.2</span> Scraping information from the page</h2>
<p>We also want the date and address of every shooting. While that data is available in the PDFs, it isn’t in a consistent format which would make it difficult to get. The webpage we downloaded the PDFs from does contain the address of each shooting in a convenient table so we will scrape the data from there. While the PDFs have the date for every shooting, starting in 2017 the date isn’t in an easy to scrape format so we will scrape the date column that is present for all years starting in 2013. Since we will want to merge the location with the data from the PDF, we will also scrape the Police Shooting Number column so we have something consistent in both the PDF and the scraped data to merge by.</p>
<p>As before, we will start by using <code>read_html()</code> to read the page into R. We will call this object “page” as we are going to use it for scraping the location, date, and the shooting number so we don’t want to overwrite the object.</p>
<pre class="sourceCode r"><code class="sourceCode r">page &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.phillypolice.com/ois/&quot;</span>)</code></pre>
<p>We need to</p>
<p><img src="images/pdf_scrape_2.PNG" /></p>
<p><img src="images/pdf_scrape_3.PNG" /></p>
<p><img src="images/pdf_scrape_4.PNG" /></p>
<p><img src="images/pdf_scrape_5.PNG" /></p>
<p><img src="images/pdf_scrape_6.PNG" /></p>
<p><img src="images/pdf_scrape_7.PNG" /></p>
<pre class="sourceCode r"><code class="sourceCode r">location &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(page, <span class="st">&quot;.span3 td+ td , td:nth-child(3)&quot;</span>)</code></pre>
<p>To convert that into values we can read, we use the function <code>html_text()</code>. This is similar to <code>html_table()</code> we used before which told R to convert the data as a table. In this case the data are strings so we use <code>html_text()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">location &lt;-<span class="st"> </span><span class="kw">html_text</span>(location)</code></pre>
<p>If we do the same thing for the Shooting Numbers we find that the CSS selector is “td:nth-child(1)”</p>
<pre class="sourceCode r"><code class="sourceCode r">shooting_numbers &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(page, <span class="st">&quot;td:nth-child(1)&quot;</span>)
shooting_numbers &lt;-<span class="st"> </span><span class="kw">html_text</span>(shooting_numbers)</code></pre>
<p>Finally we can get the date information. Be careful when selecting date, if you just click on a row in the Date column, it will include the Location column for years 2007-2012. This is because SelectorGadget knows you clicked the second column in a table, but doesn’t know that that means Date in certain tables in Location in others. Click one of the highlighted Location rows in 2007-2012 tables to deselect them.</p>
<pre class="sourceCode r"><code class="sourceCode r">dates &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(page, <span class="st">&quot;.span12 td:nth-child(2)&quot;</span>)
dates &lt;-<span class="st"> </span><span class="kw">html_text</span>(dates)</code></pre>
<p>Note that there are 467 values for location and shooting_numbers, 148 values for dates, and 468 values for links of the PDFs we downloaded? Why is this? -1 of the shootings do not have a PDF associated with the shooting so there is no link to that PDF to download. As data from 2007-2012 do not have dates on the table, there is nothing to scrape, leading to many fewer values than the location or shooting_numbers.</p>
<div id="combining-the-data-sets" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Combining the data sets</h3>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">shooting_number =</span> shooting_numbers,
                                <span class="dt">location        =</span> location,
                                <span class="dt">dates           =</span> date,
                                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Error in as.data.frame.default(x[[i]], optional = TRUE): cannot coerce class &#39;&quot;function&quot;&#39; to a data.frame</span></code></pre>
<p>Trying to make a data.frame this way returns an error because while there are 467 shootings, only the shooting number and location variable have all 467 values. Since the dates don’t exist for 2007-2012, we only have 148 values for that data. While there are a few ways to solve this (as is true with nearly every problem in R), we will expand the “dates” object to make it 467 values long.</p>
<p>The function <code>rep()</code> is used to repeat values.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">10</span>)
<span class="co">#&gt;  [1] &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot;</span>
<span class="co">#&gt;  [9] &quot;hello&quot; &quot;hello&quot;</span></code></pre>
<p>Above we repeated the word “hello” 10 times. To solve our issue we need to repeat some value 319 times and add that to the end of the “dates” object to make it 467 values long. For our value we will use NA to indicate that those values are missing.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="ot">NA</span>, (<span class="kw">length</span>(location) <span class="op">-</span><span class="st"> </span><span class="kw">length</span>(dates)))
<span class="co">#&gt;   [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt;  [24] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt;  [47] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt;  [70] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt;  [93] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [116] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [139] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [162] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [185] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [208] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [231] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [254] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [277] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
<span class="co">#&gt; [300] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span></code></pre>
<p>To combine the “dates” object with all these repeated NA’s we will use <code>c()</code> which combines vectors. Make sure we put “dates” first to maintain the correct order.</p>
<pre class="sourceCode r"><code class="sourceCode r">dates &lt;-<span class="st"> </span><span class="kw">c</span>(dates, <span class="kw">rep</span>(<span class="ot">NA</span>, (<span class="kw">length</span>(location) <span class="op">-</span><span class="st"> </span><span class="kw">length</span>(dates))))</code></pre>
<p>And we can now check the length of “dates”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(dates)
<span class="co">#&gt; [1] 467</span></code></pre>
<p>Since “dates” is 467 values long now, let’s try making the data.frame again.</p>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">shooting_number =</span> shooting_numbers,
                                <span class="dt">location        =</span> location,
                                <span class="dt">dates           =</span> dates,
                                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre>
<p>It works. Let’s look at the first 6 values. We can compare our results from the table on the page to make sure we did it correctly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(officer_shootings)
<span class="co">#&gt;   shooting_number                            location      dates</span>
<span class="co">#&gt; 1           19-04          4900 block of Hazel Avenue 03/06/2019</span>
<span class="co">#&gt; 2           19-06          1300 block of Kater Street 03/28/2019</span>
<span class="co">#&gt; 3           19-09 Bridge Street &amp; Roosevelt Boulevard 04/20/2019</span>
<span class="co">#&gt; 4           19 11         2100 block of Taney Terrace 04/25/2019</span>
<span class="co">#&gt; 5           19-13       1800 block of N. Broad Street 05/11/2019</span>
<span class="co">#&gt; 6           19 14              3400 block of G Street 05/20/2019</span></code></pre>
<p>And for good measure we can look at the bottom 6 rows, expecting NAs for the dates column.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(officer_shootings)
<span class="co">#&gt;     shooting_number                    location dates</span>
<span class="co">#&gt; 462           07-83              5224 Wayne Ave  &lt;NA&gt;</span>
<span class="co">#&gt; 463           07-84 1500 block of N. Frazier St  &lt;NA&gt;</span>
<span class="co">#&gt; 464           07-85    2300 block of N. 16th St  &lt;NA&gt;</span>
<span class="co">#&gt; 465           07-88    100 block of Chestnut St  &lt;NA&gt;</span>
<span class="co">#&gt; 466           07-93    2900 block of Mascher St  &lt;NA&gt;</span>
<span class="co">#&gt; 467           07-94    5400 block of Erdrick St  &lt;NA&gt;</span></code></pre>
</div>
</div>
<div id="extracting-data-from-pdfs" class="section level2">
<h2><span class="header-section-number">10.3</span> Extracting data from PDFs</h2>
<p>We scraped dates for shootings from 2013 and more recent and now need to get the dates for 2012 and before. We will do so by scraping the PDFs and taking the line that says the date of the shooting.</p>
<p>For this we will use the package <code>pdftools</code> which lets R scrape PDFs.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;pdftools&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pdftools)</code></pre>
<div id="scraping-a-single-pdf" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Scraping a single PDF</h3>
<p><code>pdf_text()</code> lets us scrape the text from a PDF. The input in the () is the name (in quotes as it is saying to R, go to the file on the computer) of the PDF to be read. Make sure your working directory is set to where the file is. As an example we will look at the last shooting in 2016 which we called “16-01.pdf”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>)
pdf &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(<span class="st">&quot;16-01.pdf&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pdf
<span class="co">#&gt; [1] &quot;PS# 16-01\r\n1/07/16\r\nOn Thursday, January 7, 2016, at approximately 11:41 P.M., a uniformed\r\nofficer in a marked police vehicle was traveling north in the 300 block of S.\r\n60th Street, when he observed a male approaching his vehicle near the\r\nintersection of 60th and Spruce Streets. The male was armed with a firearm.\r\nWithout warning, the offender discharged the firearm, striking the officer as\r\nhe remained seated inside his police vehicle. The offender advanced to the\r\ndriver’s door of the police vehicle and leaned in through the shattered\r\nwindow, still discharging his firearm at the officer. The offender then fled on\r\nfoot, but continued to discharge his weapon at the officer. The officer exited\r\nhis police vehicle and returned fire striking the offender. The offender was\r\napprehended by responding officers in the 5900 block of Delancey Street.\r\nThe officer was transported to Penn-Presbyterian Hospital where he was\r\nadmitted.\r\nThe offender was transported to the Hospital of the University of\r\nPennsylvania for treatment.\r\nThe offender’s firearm, a Glock, 9MM, semi-automatic pistol, which had been\r\nreported stolen, was recovered empty, with the slide locked to the rear, at the\r\nscene.\r\nThere were no other injuries as a result of this firearm discharge.\r\n  *** Information posted in the original summary reflects a preliminary\r\nunderstanding of what occurred at the time of the incident. This information\r\nis posted shortly after the incident and may be updated as the investigation\r\nleads to new information. The DA’s Office is provided all the information\r\nfrom the PPD’s investigation prior to their charging decision.\r\n&quot;</span></code></pre>
<p>When we print the file we can see that it is a single big block of text. Near the beginning of the text we can see a date, 1/07/16. When comparing the PDF which we can read ourselves on Adobe Acrobat or a web browser, it is clear that all the line breaks in the PDF disappeared when we used <code>pdf_text()</code>. More specifically, the line breaks were replaced by <code>\n</code> which is R’s way of saying “this is a line break”.</p>
<p><img src="images/pdf_scrape_1.PNG" /></p>
<p>We want to grab just the date from this file. Since the file is in a single block of text, we need to break it up based on where there should be a line break (turning each line back into an individual part of the file) and grab only the line with the date.</p>
<p>When splitting up a string (which is just what the PDF is now), we can use the function <code>strsplit()</code> which splits up a string based on some pattern.</p>
<p>Let’s see a simple example, splitting up the word “criminology” by the letter “n”. Note that it deletes the character it is splitting by!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">strsplit</span>(<span class="st">&quot;criminology&quot;</span>, <span class="dt">split =</span> <span class="st">&quot;n&quot;</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;crimi&quot; &quot;ology&quot;</span></code></pre>
<p>It now returns two words “crimi” amd “ology”, the two parts of the word “criminology” on each side of the letter “n”. It returns the value inside a list - which is why you see the [[1]] above the result. To get the value we actually want, we need to get the first element inside that list, using double bracket notation.</p>
<pre class="sourceCode r"><code class="sourceCode r">split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="st">&quot;criminology&quot;</span>, <span class="dt">split =</span> <span class="st">&quot;n&quot;</span>)
split &lt;-<span class="st"> </span>split[[<span class="dv">1</span>]]
split
<span class="co">#&gt; [1] &quot;crimi&quot; &quot;ology&quot;</span></code></pre>
<p>From the pattern we see in the PDF we scraped, and comparing it to the PDF we can see in Adobe Acrobat or a web browser, it is clear that we can use split at the characters <code>\r\n</code> and it will give us each line in its own element (for Mac users you may need to split at <code>\n</code> rather than <code>\r\n</code>). Let’s do that and just return the first element so we don’t get a list. Let’s call the object we make “pdf_split”.</p>
<pre class="sourceCode r"><code class="sourceCode r">pdf_split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(pdf, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\r\n</span><span class="st">&quot;</span>)
pdf_split &lt;-<span class="st"> </span>pdf_split[[<span class="dv">1</span>]]
pdf_split
<span class="co">#&gt;  [1] &quot;PS# 16-01&quot;                                                                      </span>
<span class="co">#&gt;  [2] &quot;1/07/16&quot;                                                                        </span>
<span class="co">#&gt;  [3] &quot;On Thursday, January 7, 2016, at approximately 11:41 P.M., a uniformed&quot;         </span>
<span class="co">#&gt;  [4] &quot;officer in a marked police vehicle was traveling north in the 300 block of S.&quot;  </span>
<span class="co">#&gt;  [5] &quot;60th Street, when he observed a male approaching his vehicle near the&quot;          </span>
<span class="co">#&gt;  [6] &quot;intersection of 60th and Spruce Streets. The male was armed with a firearm.&quot;    </span>
<span class="co">#&gt;  [7] &quot;Without warning, the offender discharged the firearm, striking the officer as&quot;  </span>
<span class="co">#&gt;  [8] &quot;he remained seated inside his police vehicle. The offender advanced to the&quot;     </span>
<span class="co">#&gt;  [9] &quot;driver’s door of the police vehicle and leaned in through the shattered&quot;        </span>
<span class="co">#&gt; [10] &quot;window, still discharging his firearm at the officer. The offender then fled on&quot;</span>
<span class="co">#&gt; [11] &quot;foot, but continued to discharge his weapon at the officer. The officer exited&quot; </span>
<span class="co">#&gt; [12] &quot;his police vehicle and returned fire striking the offender. The offender was&quot;   </span>
<span class="co">#&gt; [13] &quot;apprehended by responding officers in the 5900 block of Delancey Street.&quot;       </span>
<span class="co">#&gt; [14] &quot;The officer was transported to Penn-Presbyterian Hospital where he was&quot;         </span>
<span class="co">#&gt; [15] &quot;admitted.&quot;                                                                      </span>
<span class="co">#&gt; [16] &quot;The offender was transported to the Hospital of the University of&quot;              </span>
<span class="co">#&gt; [17] &quot;Pennsylvania for treatment.&quot;                                                    </span>
<span class="co">#&gt; [18] &quot;The offender’s firearm, a Glock, 9MM, semi-automatic pistol, which had been&quot;    </span>
<span class="co">#&gt; [19] &quot;reported stolen, was recovered empty, with the slide locked to the rear, at the&quot;</span>
<span class="co">#&gt; [20] &quot;scene.&quot;                                                                         </span>
<span class="co">#&gt; [21] &quot;There were no other injuries as a result of this firearm discharge.&quot;            </span>
<span class="co">#&gt; [22] &quot;  *** Information posted in the original summary reflects a preliminary&quot;        </span>
<span class="co">#&gt; [23] &quot;understanding of what occurred at the time of the incident. This information&quot;   </span>
<span class="co">#&gt; [24] &quot;is posted shortly after the incident and may be updated as the investigation&quot;   </span>
<span class="co">#&gt; [25] &quot;leads to new information. The DA’s Office is provided all the information&quot;      </span>
<span class="co">#&gt; [26] &quot;from the PPD’s investigation prior to their charging decision.&quot;</span></code></pre>
<p>We need a way to only take the row with the date. In most cases the second row is the one with the date, however this isn’t true in every case. Therefore, we can’t just grab the second element. We can use <code>grep()</code> to search for a pattern that is unique to the row with the date to get that row.</p>
<p>So what pattern does our date have? It is always one or two numbers followed by a / followed again by two numbers, another / and two more numbers.</p>
<p>1/07/16</p>
<p>So our pattern in <code>grep()</code> will be</p>
<p><code>^[0-9]+/[0-9]+/[0-9]+</code></p>
<p>The <code>^</code> is a special character saying that whatever follows it is the start of the string. <code>[0-9]</code> means any number. The + is a special character which says “one or more of the previous character” so <code>[0-9]</code> means “one or more numbers”. Some files (such as this one) have multiple dates in the text so we want to only get rows starting with a date.</p>
<p>By default <code>grep()</code> will return a number indicating the element where it found a match. If we set the parameter <code>value</code> to TRUE, it will print out that element.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(<span class="st">&quot;^[0-9]+/[0-9]+/[0-9]+&quot;</span>, pdf_split, <span class="dt">value =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] &quot;1/07/16&quot;</span></code></pre>
</div>
<div id="making-a-function" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Making a function</h3>
<p>Since we need to do this process for hundreds of PDFs we will make a function and then for loop through it for every PDF. Here we are following the same steps as scraping the movie data - make code work for a single file/date, turn it into a function to work for any file/date, and write a for loop so it works for every file/date we have. That’s the general process you will use when writing code meant for multiple inputs. Make sure code works first in a specific case (a specific date), then make it work in the general case (any date).</p>
<p>When making a function from code you’ve already written, a good method is to just copy all the code so it is together, then start building the function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>))
pdf &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(<span class="st">&quot;16-01.pdf&quot;</span>)
pdf_split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(pdf, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\r\n</span><span class="st">&quot;</span>)
pdf_split &lt;-<span class="st"> </span>pdf_split[[<span class="dv">1</span>]]
<span class="kw">grep</span>(<span class="st">&quot;^[0-9]+/[0-9]+/[0-9]+&quot;</span>, pdf_split, <span class="dt">value =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] &quot;1/07/16&quot;</span></code></pre>
<p>Above is our code to scrape a specific PDF. Now let’s make the standard function skeleton without including any code just yet. We can call the function “get_date_from_pdf” since that is a good description for what our function will do. We want to input a file name and get a date returned. So we will call our parameter in the () “file_name” and our return object “date”.</p>
<pre class="sourceCode r"><code class="sourceCode r">get_date_from_pdf &lt;-<span class="st"> </span><span class="cf">function</span>(file_name) {
   
   <span class="kw">return</span>(date)
}</code></pre>
<p>Now we can add in our code.</p>
<pre class="sourceCode r"><code class="sourceCode r">get_date_from_pdf &lt;-<span class="st"> </span><span class="cf">function</span>(file_name) {
   <span class="kw">setwd</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>))
   pdf &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(<span class="st">&quot;16-01.pdf&quot;</span>)
   pdf_split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(pdf, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\r\n</span><span class="st">&quot;</span>)
   pdf_split &lt;-<span class="st"> </span>pdf_split[[<span class="dv">1</span>]]
   <span class="kw">return</span>(date)
}</code></pre>
<p>There are two steps remaining to turn our code into a working function. As it is, the code still writes <code>pdf_text("16-01.pdf")</code>. We want it to run <code>pdf_text(file_name)</code> on any file we input so let’s change “16-01.pdf” to say “file_name” (not in quotes since it is an object). And we want the function to return an object called “date” which has the date from the PDF. We know the date is printed by the <code>grep()</code> code we wrote, so let’s save that as “date”.</p>
<pre class="sourceCode r"><code class="sourceCode r">get_date_from_pdf &lt;-<span class="st"> </span><span class="cf">function</span>(file_name) {
   <span class="kw">setwd</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>))
   pdf &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(file_name)
   pdf_split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(pdf, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\r\n</span><span class="st">&quot;</span>)
   pdf_split &lt;-<span class="st"> </span>pdf_split[[<span class="dv">1</span>]]
   date &lt;-<span class="st">  </span><span class="kw">grep</span>(<span class="st">&quot;^[0-9]+/[0-9]+/[0-9]+&quot;</span>, pdf_split, <span class="dt">value =</span> <span class="ot">TRUE</span>)
   <span class="kw">return</span>(date)
}</code></pre>
<p>Now let’s try it our using another PDF, let’s say “16-01.pdf”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_date_from_pdf</span>(<span class="st">&quot;16-01.pdf&quot;</span>)
<span class="co">#&gt; [1] &quot;1/07/16&quot;</span></code></pre>
</div>
<div id="looping-through-every-pdf" class="section level3">
<h3><span class="header-section-number">10.3.3</span> Looping through every PDF</h3>
<p>Before we write the for loop let’s think about what our goal is and what we currently have. We have a data set which has a single row for every shooting and information about when and where each shooting took place. The object “officer_shootings” that we made earlier has most of that. It contains the location for every shooting and the date for all of those from 2013-2019. So we want to scrape the PDFs for years prior to 2013 to get the date of each shooting. And we made a function that gives us the date in the file we input. Since we know the dates for 2013-2019 (and 2017-2019 make it hard to get the date from the PDF), we only want to scrape the PDFs from 2007-2012.</p>
<p>We need to do two things now:</p>
<ol style="list-style-type: decimal">
<li><p>Select only PDFs from 2007-2012</p></li>
<li><p>For each PDF figure out a way to select the right row in the “officer_shootings” object to add the date</p></li>
</ol>
<p>We can take this one piece at a time. First we need to select only PDFs from 2007-2012. The function <code>list.files()</code> will provide a list of every file in the working directory. We will use it to get a list of all files in the folder we stored the PDFs and then subset it to just keep the files we want. Let’s call the object “pdf_files”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;data/philly_officer_shootings&quot;</span>)
pdf_files &lt;-<span class="st"> </span><span class="kw">list.files</span>()</code></pre>
<p>Looking at <code>head()</code> we can see it is a vector of file names.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(pdf_files)
<span class="co">#&gt; [1] &quot;07-01 4400 N 17 ST.pdf&quot;      &quot;07-02 2400 N 10 ST.pdf&quot;     </span>
<span class="co">#&gt; [3] &quot;07-03 1700 N 59 ST.pdf&quot;      &quot;07-04 900 MARKET ST.pdf&quot;    </span>
<span class="co">#&gt; [5] &quot;07-05 2800 E PACIFIC ST.pdf&quot; &quot;07-06 6300 DITMAN ST.pdf&quot;</span></code></pre>
<p>There is a pattern in these names where they start with two characters indicating the year (2016 starts with “PS” then “16” though since we don’t need 2016 data that doesn’t affect this process). We will use this pattern to just get files that start with “0” or begin “10”, “11”, or “12”. We will use <code>grep()</code> and make use of the <code>^</code> special character which indicates that the characters following it are the start of the string. We will also use the <code>|</code> special character which indicates “thing on left or right” of the <code>|</code> are both a match.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(<span class="st">&quot;^0|^10|^11|^12&quot;</span>, pdf_files)
<span class="co">#&gt;   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17</span>
<span class="co">#&gt;  [18]  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34</span>
<span class="co">#&gt;  [35]  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51</span>
<span class="co">#&gt;  [52]  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68</span>
<span class="co">#&gt;  [69]  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85</span>
<span class="co">#&gt;  [86]  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 102</span>
<span class="co">#&gt; [103] 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119</span>
<span class="co">#&gt; [120] 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136</span>
<span class="co">#&gt; [137] 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153</span>
<span class="co">#&gt; [154] 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170</span>
<span class="co">#&gt; [171] 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187</span>
<span class="co">#&gt; [188] 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204</span>
<span class="co">#&gt; [205] 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221</span>
<span class="co">#&gt; [222] 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238</span>
<span class="co">#&gt; [239] 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255</span>
<span class="co">#&gt; [256] 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272</span>
<span class="co">#&gt; [273] 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289</span>
<span class="co">#&gt; [290] 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306</span>
<span class="co">#&gt; [307] 307 308 309 310 311 312 313 314 315 316 317</span></code></pre>
<p>This prints out a list of which elements in “pdf_files” are a match. We can use square bracket notation <code>[]</code> subsetting to just keep the elements in “pdf_files” that we want. And let’s save that object as “pdf_files”, overwriting our initial object with just the values we want. This way we minimize the number of objects we need to keep track of.</p>
<pre class="sourceCode r"><code class="sourceCode r">pdf_files &lt;-<span class="st"> </span>pdf_files[<span class="kw">grep</span>(<span class="st">&quot;^0|^10|^11|^12&quot;</span>, pdf_files)]</code></pre>
<p>We have accomplished our first task, getting just the PDFs from 2007-2012. Now we need to find a way to match the correct row in “officer_shootings” with each file. Let’s think again about patterns in the file names.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(pdf_files)
<span class="co">#&gt; [1] &quot;07-01 4400 N 17 ST.pdf&quot;      &quot;07-02 2400 N 10 ST.pdf&quot;     </span>
<span class="co">#&gt; [3] &quot;07-03 1700 N 59 ST.pdf&quot;      &quot;07-04 900 MARKET ST.pdf&quot;    </span>
<span class="co">#&gt; [5] &quot;07-05 2800 E PACIFIC ST.pdf&quot; &quot;07-06 6300 DITMAN ST.pdf&quot;</span></code></pre>
<p>Each file name starts with the same 5 character (“year-unique ID”) value indicating the shooting number that we scraped from the table. The files then occasionally have the address of the shooting and end with “.pdf”. This is our match. For each file we want to just keep the first 5 characters which are an exact match to the “shooting_number” column. There are a few ways to do this but we’ll use the function <code>substr()</code> as it well-suited for this task.</p>
<p><code>substr()</code> takes a string and returns nth-mth (inclusive) characters in that string. Let’s see how this works using the word “apple”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">substr</span>(<span class="st">&quot;apple&quot;</span>, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">3</span>)
<span class="co">#&gt; [1] &quot;app&quot;</span></code></pre>
<p>Here we input the word “apple” and set the parameter <code>start</code> to 1 and <code>stop</code> to 3. This says, take the word “apple” and return the 1st through the 3rd element (i.e. letter) in that string. This is very useful for taking only a small piece of a string. In our case we just want the first 5 characters in the PDF file name.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">substr</span>(pdf_files[<span class="dv">1</span>], <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
<span class="co">#&gt; [1] &quot;07-01&quot;</span></code></pre>
<p>And here we have the officer shooting number for the first PDF which we can use to match with the correct row in the “officer_shootings” file.</p>
<p>We can now create the for loop. Let’s start with a skeleton of the for loop then slowly add our code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (file <span class="cf">in</span> pdf_files) {
   
}</code></pre>
<p>For loops take the form “for x in some group of x, do this thing”. In our case our “group of x” is the “pdf_files” object, a group of file names. We want the loop to go through every file in “pdf_files”, find the police shooting number from the file name to match with the correct row in “officer_shootings”, get the date from the file, and then put the date in the right row.</p>
<p>We can add in the code we wrote to get the police shooting number.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (file <span class="cf">in</span> pdf_files) {
   police_shooting_number &lt;-<span class="st"> </span><span class="kw">substr</span>(file, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
}</code></pre>
<p>And the code to get the date from the function we made.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (file <span class="cf">in</span> pdf_files) {
   police_shooting_number &lt;-<span class="st"> </span><span class="kw">substr</span>(file, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
   date &lt;-<span class="st"> </span><span class="kw">get_date_from_pdf</span>(file)
}</code></pre>
<p>Finally we add in code that uses square bracket notation <code>[]</code> to say change the value in the “dates” column in the row where the shooting number matches the shooting number we made from the file name to the date we got from the PDF.</p>
<p>The for loop is done and we can run it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (file <span class="cf">in</span> pdf_files) {
   police_shooting_number &lt;-<span class="st"> </span><span class="kw">substr</span>(file, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
   date &lt;-<span class="st"> </span><span class="kw">get_date_from_pdf</span>(file)
   officer_shootings<span class="op">$</span>dates[officer_shootings<span class="op">$</span>shooting_number <span class="op">==</span><span class="st"> </span>police_shooting_number] &lt;-<span class="st"> </span>date
}</code></pre>
<p>We have one final thing to do, make the date column Date type. The date in the “dates” column aren’t in the Date format for R which means that while we can easy read it, R doesn’t know that it is a date and can’t do any date-related functions like grabbing the year or months from it. We can use the <code>lubridate</code> package we worked with earlier to turn it into a date. Since this date is in the month-day-year order we will use the function <code>mdy()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;lubridate&#39;</span>
<span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     date</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings<span class="op">$</span>dates &lt;-<span class="st"> </span><span class="kw">mdy</span>(officer_shootings<span class="op">$</span>dates)</code></pre>
<p>Now our “officer_shootings” file contains the date and address of every officer-involved shooting in Philadelphia from 2007 to early 2019. 3 of the shootings do not have a PDF associated with it. Let’s remove them since we are unable to verify information on the table. These rows have a value of "" in the “shooting_number” column so we’ll subset the “officer_shootings” data.frame to keep only rows where the shooting number is not "".</p>
<pre class="sourceCode r"><code class="sourceCode r">officer_shootings &lt;-<span class="st"> </span>officer_shootings[officer_shootings<span class="op">$</span>shooting_number <span class="op">!=</span><span class="st"> &quot;&quot;</span>, ]</code></pre>
<p>We will save the file for now and in Chapter <a href="geocoding.html#geocoding">12</a> learn how to geocode the address into coordinates that allow us to plot the shootings onto a map of Philadelphia.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>))
<span class="kw">save</span>(officer_shootings, <span class="dt">file =</span> <span class="st">&quot;officer_shootings.rda&quot;</span>)</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-and-writing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scrape-table.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/r4crim/edit/master/pdf-scraping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
