<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Webscraping with rvest | R 4 Criminology</title>
  <meta name="description" content="Notes for learning and applying R to questions about crime and the justice system." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Webscraping with rvest | R 4 Criminology" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://r4crim.com" />
  
  <meta property="og:description" content="Notes for learning and applying R to questions about crime and the justice system." />
  <meta name="github-repo" content="jacobkap/r4crim" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Webscraping with rvest | R 4 Criminology" />
  
  <meta name="twitter:description" content="Notes for learning and applying R to questions about crime and the justice system." />
  

<meta name="author" content="Jacob Kaplan" />
<meta name="author" content="Greg Ridgeway" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="graphing-with-ggplot2.html">
<link rel="next" href="functions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Criminology</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-math"><i class="fa fa-check"></i><b>1.1</b> Basic Math</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#combining-values-together-into-a-collection-or-vector"><i class="fa fa-check"></i><b>1.2</b> Combining values together into a collection (or vector)</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#assignment-of-values-to-variables-making-things"><i class="fa fa-check"></i><b>1.3</b> Assignment of values to variables (Making “things”)</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.4</b> Reading data into R</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#setting-the-working-directory"><i class="fa fa-check"></i><b>1.4.1</b> Setting the working directory</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#loading-data"><i class="fa fa-check"></i><b>1.4.2</b> Loading data</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#first-steps-to-explore-the-data"><i class="fa fa-check"></i><b>1.4.3</b> First steps to explore the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-rstudio.html"><a href="introduction-to-rstudio.html"><i class="fa fa-check"></i><b>2</b> Introduction to RStudio</a></li>
<li class="chapter" data-level="3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html"><i class="fa fa-check"></i><b>3</b> Subsetting: Making big things small</a><ul>
<li class="chapter" data-level="3.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-specific-values"><i class="fa fa-check"></i><b>3.1</b> Select specific values</a></li>
<li class="chapter" data-level="3.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#logical-values-and-operations"><i class="fa fa-check"></i><b>3.2</b> Logical values and operations</a><ul>
<li class="chapter" data-level="3.2.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#matching-a-single-value"><i class="fa fa-check"></i><b>3.2.1</b> Matching a single value</a></li>
<li class="chapter" data-level="3.2.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#matching-multiple-values"><i class="fa fa-check"></i><b>3.2.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="3.2.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#does-not-match"><i class="fa fa-check"></i><b>3.2.3</b> Does not match</a></li>
<li class="chapter" data-level="3.2.4" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>3.2.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="3.2.5" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>3.2.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>3.3</b> Subsetting a data.frame</a></li>
<li class="chapter" data-level="3.4" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-a-specific-column"><i class="fa fa-check"></i><b>3.4</b> Select a specific column</a><ul>
<li class="chapter" data-level="3.4.1" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#select-specific-rows-in-a-data.frame"><i class="fa fa-check"></i><b>3.4.1</b> Select specific rows in a data.frame</a></li>
<li class="chapter" data-level="3.4.2" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#battleships"><i class="fa fa-check"></i><b>3.4.2</b> Battleships</a></li>
<li class="chapter" data-level="3.4.3" data-path="subsetting-making-big-things-small.html"><a href="subsetting-making-big-things-small.html#subset-colorado-data"><i class="fa fa-check"></i><b>3.4.3</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#summary-and-table"><i class="fa fa-check"></i><b>4.1</b> Summary and Table</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#graphing-data"><i class="fa fa-check"></i><b>4.2</b> Graphing Data</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#aggregating-summaries-of-groups"><i class="fa fa-check"></i><b>4.3</b> Aggregating (summaries of groups)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>5</b> Dates and Times</a><ul>
<li class="chapter" data-level="5.1" data-path="dates-and-times.html"><a href="dates-and-times.html#why-do-dates-and-times-matter"><i class="fa fa-check"></i><b>5.1</b> Why do dates and times matter?</a></li>
<li class="chapter" data-level="5.2" data-path="dates-and-times.html"><a href="dates-and-times.html#lubridate"><i class="fa fa-check"></i><b>5.2</b> <code>lubridate</code></a></li>
<li class="chapter" data-level="5.3" data-path="dates-and-times.html"><a href="dates-and-times.html#working-with-dates"><i class="fa fa-check"></i><b>5.3</b> Working with dates</a></li>
<li class="chapter" data-level="5.4" data-path="dates-and-times.html"><a href="dates-and-times.html#chicago-crime-data"><i class="fa fa-check"></i><b>5.4</b> Chicago crime data</a></li>
<li class="chapter" data-level="5.5" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>5.5</b> Time zones</a><ul>
<li class="chapter" data-level="5.5.1" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises"><i class="fa fa-check"></i><b>5.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Regular Expressions</a><ul>
<li class="chapter" data-level="6.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>6.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="6.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>6.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="6.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>6.3</b> Useful special characters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>6.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>6.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>6.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string-and-not"><i class="fa fa-check"></i><b>6.3.4</b> Start of string and “not” <code>^</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>6.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="6.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>6.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="6.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>6.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="6.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>6.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="6.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>6.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="6.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>6.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="6.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>6.3.11</b> Optional text <code>?</code></a></li>
<li class="chapter" data-level="6.3.12" data-path="regular-expressions.html"><a href="regular-expressions.html#back-referencing"><i class="fa fa-check"></i><b>6.3.12</b> Back-referencing <code>()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>6.4</b> Changing capitalization</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Graphing with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="7.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>7.1</b> What does the data look like?</a><ul>
<li class="chapter" data-level="7.1.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-1"><i class="fa fa-check"></i><b>7.1.1</b> Exercises</a></li>
<li class="chapter" data-level="7.1.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-2"><i class="fa fa-check"></i><b>7.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#graphing-data-1"><i class="fa fa-check"></i><b>7.2</b> Graphing data</a></li>
<li class="chapter" data-level="7.3" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#time-series-plots"><i class="fa fa-check"></i><b>7.3</b> Time-Series Plots</a><ul>
<li class="chapter" data-level="7.3.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-3"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
<li class="chapter" data-level="7.3.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-4"><i class="fa fa-check"></i><b>7.3.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#should-we-trust-this-data"><i class="fa fa-check"></i><b>7.4</b> Should we trust this data?</a><ul>
<li class="chapter" data-level="7.4.1" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-5"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
<li class="chapter" data-level="7.4.2" data-path="graphing-with-ggplot2.html"><a href="graphing-with-ggplot2.html#exercises-6"><i class="fa fa-check"></i><b>7.4.2</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>8</b> Webscraping with <code>rvest</code></a><ul>
<li class="chapter" data-level="8.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>8.1</b> Scraping one page</a></li>
<li class="chapter" data-level="8.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning the webscraped data</a></li>
<li class="chapter" data-level="8.3" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#fixing-names"><i class="fa fa-check"></i><b>8.3</b> Fixing names</a><ul>
<li class="chapter" data-level="8.3.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#exercises-7"><i class="fa fa-check"></i><b>8.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>9</b> Functions</a><ul>
<li class="chapter" data-level="9.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>9.1</b> A simple function</a></li>
<li class="chapter" data-level="9.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>9.2</b> Adding parameters</a></li>
<li class="chapter" data-level="9.3" data-path="functions.html"><a href="functions.html#making-a-function-to-scrape-movie-data"><i class="fa fa-check"></i><b>9.3</b> Making a function to scrape movie data</a></li>
<li class="chapter" data-level="9.4" data-path="functions.html"><a href="functions.html#the-benefits-of-functions"><i class="fa fa-check"></i><b>9.4</b> The benefits of functions</a></li>
<li class="chapter" data-level="9.5" data-path="functions.html"><a href="functions.html#understanding-other-peoples-functions"><i class="fa fa-check"></i><b>9.5</b> Understanding other people’s functions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>10</b> For loops</a><ul>
<li class="chapter" data-level="10.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>10.1</b> Basic for loops</a></li>
<li class="chapter" data-level="10.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-days-of-movie"><i class="fa fa-check"></i><b>10.2</b> Scraping multiple days of movie</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="types-of-objects.html"><a href="types-of-objects.html"><i class="fa fa-check"></i><b>11</b> Types of objects</a><ul>
<li class="chapter" data-level="11.1" data-path="types-of-objects.html"><a href="types-of-objects.html#vectors"><i class="fa fa-check"></i><b>11.1</b> Vectors</a></li>
<li class="chapter" data-level="11.2" data-path="types-of-objects.html"><a href="types-of-objects.html#data-frames"><i class="fa fa-check"></i><b>11.2</b> Data frames</a></li>
<li class="chapter" data-level="11.3" data-path="types-of-objects.html"><a href="types-of-objects.html#lists"><i class="fa fa-check"></i><b>11.3</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>12</b> Reading and Writing Data</a><ul>
<li class="chapter" data-level="12.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>12.1</b> Reading Data into R</a><ul>
<li class="chapter" data-level="12.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-files"><i class="fa fa-check"></i><b>12.1.1</b> R files</a></li>
<li class="chapter" data-level="12.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-files"><i class="fa fa-check"></i><b>12.1.2</b> Excel files</a></li>
<li class="chapter" data-level="12.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-files"><i class="fa fa-check"></i><b>12.1.3</b> Stata files</a></li>
<li class="chapter" data-level="12.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-files"><i class="fa fa-check"></i><b>12.1.4</b> SAS files</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>12.2</b> Writing Data</a><ul>
<li class="chapter" data-level="12.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-files-1"><i class="fa fa-check"></i><b>12.2.1</b> R files</a></li>
<li class="chapter" data-level="12.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-files-1"><i class="fa fa-check"></i><b>12.2.2</b> Excel files</a></li>
<li class="chapter" data-level="12.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-files-1"><i class="fa fa-check"></i><b>12.2.3</b> Stata files</a></li>
<li class="chapter" data-level="12.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-files-1"><i class="fa fa-check"></i><b>12.2.4</b> SAS files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html"><i class="fa fa-check"></i><b>13</b> Scraping data from PDFs</a><ul>
<li class="chapter" data-level="13.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#downloading-officer-involved-shooting-files"><i class="fa fa-check"></i><b>13.1</b> Downloading officer-involved Shooting Files</a></li>
<li class="chapter" data-level="13.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-information-from-the-page"><i class="fa fa-check"></i><b>13.2</b> Scraping information from the page</a><ul>
<li class="chapter" data-level="13.2.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#combining-the-data-sets"><i class="fa fa-check"></i><b>13.2.1</b> Combining the data sets</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#extracting-data-from-pdfs"><i class="fa fa-check"></i><b>13.3</b> Extracting data from PDFs</a><ul>
<li class="chapter" data-level="13.3.1" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#scraping-a-single-pdf"><i class="fa fa-check"></i><b>13.3.1</b> Scraping a single PDF</a></li>
<li class="chapter" data-level="13.3.2" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#making-a-function"><i class="fa fa-check"></i><b>13.3.2</b> Making a function</a></li>
<li class="chapter" data-level="13.3.3" data-path="scraping-data-from-pdfs.html"><a href="scraping-data-from-pdfs.html#looping-through-every-pdf"><i class="fa fa-check"></i><b>13.3.3</b> Looping through every PDF</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>14</b> Geocoding</a><ul>
<li class="chapter" data-level="14.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>14.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="14.2" data-path="geocoding.html"><a href="geocoding.html#making-a-function-1"><i class="fa fa-check"></i><b>14.2</b> Making a function</a></li>
<li class="chapter" data-level="14.3" data-path="geocoding.html"><a href="geocoding.html#geocoding-officer-shooting-locations"><i class="fa fa-check"></i><b>14.3</b> Geocoding officer shooting locations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>15</b> Hotspot maps</a><ul>
<li class="chapter" data-level="15.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#creating-the-maps"><i class="fa fa-check"></i><b>15.1</b> Creating the maps</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>16</b> Choropleth Maps</a><ul>
<li class="chapter" data-level="16.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>16.1</b> Spatial joins</a></li>
<li class="chapter" data-level="16.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>16.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>17</b> Interactive Maps</a><ul>
<li class="chapter" data-level="17.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>17.1</b> Why do interactive graphs matter?</a><ul>
<li class="chapter" data-level="17.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>17.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="17.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>17.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>17.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="17.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>17.3</b> Adding popup information</a></li>
<li class="chapter" data-level="17.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>17.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="17.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-polygons"><i class="fa fa-check"></i><b>17.5</b> Interactive polygons</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html"><i class="fa fa-check"></i><b>18</b> Graphing Officer-Involved Shootings</a><ul>
<li class="chapter" data-level="18.1" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#graphing-a-single-variable"><i class="fa fa-check"></i><b>18.1</b> Graphing a single variable</a><ul>
<li class="chapter" data-level="18.1.1" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#numeric-variable"><i class="fa fa-check"></i><b>18.1.1</b> Numeric variable</a></li>
<li class="chapter" data-level="18.1.2" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#categorical-variable"><i class="fa fa-check"></i><b>18.1.2</b> Categorical variable</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="graphing-officer-involved-shootings.html"><a href="graphing-officer-involved-shootings.html#time-series"><i class="fa fa-check"></i><b>18.2</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html"><i class="fa fa-check"></i><b>19</b> Scraping Tables from PDFs</a><ul>
<li class="chapter" data-level="19.1" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html#scraping-the-first-table"><i class="fa fa-check"></i><b>19.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="19.2" data-path="scraping-tables-from-pdfs.html"><a href="scraping-tables-from-pdfs.html#making-a-function-2"><i class="fa fa-check"></i><b>19.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html"><i class="fa fa-check"></i><b>20</b> Uniform Crime Report (UCR) Data</a><ul>
<li class="chapter" data-level="20.1" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#exploring-the-ucr-data"><i class="fa fa-check"></i><b>20.1</b> Exploring the UCR data</a></li>
<li class="chapter" data-level="20.2" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#finding-things-in-our-data"><i class="fa fa-check"></i><b>20.2</b> Finding things in our data</a></li>
<li class="chapter" data-level="20.3" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#manipulating-our-data"><i class="fa fa-check"></i><b>20.3</b> Manipulating our data</a><ul>
<li class="chapter" data-level="20.3.1" data-path="uniform-crime-report-ucr-data.html"><a href="uniform-crime-report-ucr-data.html#exercises-8"><i class="fa fa-check"></i><b>20.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html"><i class="fa fa-check"></i><b>21</b> Census Data from Social Explorer</a><ul>
<li class="chapter" data-level="21.1" data-path="census-data-from-social-explorer.html"><a href="census-data-from-social-explorer.html#getting-census-data-from-social-explorer"><i class="fa fa-check"></i><b>21.1</b> Getting Census data from Social Explorer</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html"><i class="fa fa-check"></i><b>22</b> Census Data from IPUMS</a><ul>
<li class="chapter" data-level="22.1" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#getting-ipums-data"><i class="fa fa-check"></i><b>22.1</b> Getting IPUMS data</a></li>
<li class="chapter" data-level="22.2" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#cleaning-the-data"><i class="fa fa-check"></i><b>22.2</b> Cleaning the data</a></li>
<li class="chapter" data-level="22.3" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#aggregating-the-data"><i class="fa fa-check"></i><b>22.3</b> Aggregating the data</a></li>
<li class="chapter" data-level="22.4" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#graphing-the-data"><i class="fa fa-check"></i><b>22.4</b> Graphing the data</a></li>
<li class="chapter" data-level="22.5" data-path="census-data-from-ipums.html"><a href="census-data-from-ipums.html#mapping-the-data"><i class="fa fa-check"></i><b>22.5</b> Mapping the data</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html"><i class="fa fa-check"></i><b>23</b> National Incident-Based Reporting System (NIBRS) Data</a><ul>
<li class="chapter" data-level="23.1" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html#downloading-the-data"><i class="fa fa-check"></i><b>23.1</b> Downloading the data</a></li>
<li class="chapter" data-level="23.2" data-path="national-incident-based-reporting-system-nibrs-data.html"><a href="national-incident-based-reporting-system-nibrs-data.html#reading-the-data"><i class="fa fa-check"></i><b>23.2</b> Reading the data</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="useful-resources.html"><a href="useful-resources.html"><i class="fa fa-check"></i><b>A</b> Useful Resources</a><ul>
<li class="chapter" data-level="A.1" data-path="useful-resources.html"><a href="useful-resources.html#learning-r-and-coding-issues"><i class="fa fa-check"></i><b>A.1</b> Learning R and coding issues</a></li>
<li class="chapter" data-level="A.2" data-path="useful-resources.html"><a href="useful-resources.html#data"><i class="fa fa-check"></i><b>A.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="using-r-markdown.html"><a href="using-r-markdown.html"><i class="fa fa-check"></i><b>B</b> Using R Markdown</a><ul>
<li class="chapter" data-level="B.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#code"><i class="fa fa-check"></i><b>B.1</b> Code</a><ul>
<li class="chapter" data-level="B.1.1" data-path="using-r-markdown.html"><a href="using-r-markdown.html#only-use-code-to-make-output"><i class="fa fa-check"></i><b>B.1.1</b> Only use code to make output</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="using-r-markdown.html"><a href="using-r-markdown.html#figures-and-tables"><i class="fa fa-check"></i><b>B.2</b> Figures and Tables</a></li>
<li class="chapter" data-level="B.3" data-path="using-r-markdown.html"><a href="using-r-markdown.html#finally-making-the-output-file"><i class="fa fa-check"></i><b>B.3</b> Finally, making the output file</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R 4 Criminology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="webscraping-with-rvest" class="section level1">
<h1><span class="header-section-number">8</span> Webscraping with <code>rvest</code></h1>
<p>You may come across data online that are relevant to your interests or research (for example, past students have scraped data from sex offender registries and sporting information from Wikipedia). Not all online data is in a tidy, downloadable format such as a .csv or .rda file. Yet, patterns in the page provide a valuable way to “scrape” data from that webpage. Here, we’re going to work through an example of webscraping. We’re going to get data on ticket sales of every movie, for every day in a single year.</p>
<p>For our purposes we will be using the R package <a href="https://github.com/tidyverse/rvest"><code>rvest</code></a>. This package makes it relatively easy to scrape data from websites, especially when that data is already in a table on the page as our will be.</p>
<p>If you haven’t done so before, make sure to install <code>rvest</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;rvest&quot;</span>)</code></pre>
<p>And every time you start R, if you want to use <code>rvest</code> you must tell R so by using <code>library()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
<span class="co">#&gt; Loading required package: xml2</span></code></pre>
<p>We will be scraping movie ticket data from the website <a href="http://www.the-numbers.com">The-Numbers</a>. This site has daily information on how much money each movie in theaters made that day. The data includes the name of the movie, the number of theaters it played in, how much it made that day, how much it made since it started playing, and how many days it has been in theaters. Conveniently, this is all found in a single table on that page.</p>
<p>Here is a screenshot of data from July 4th, 2018</p>
<div class="figure">
<img src="images/the-numbers_example.PNG" alt="Here is a screenshot of data from July 4th, 2018" />
<p class="caption">Here is a screenshot of data from July 4th, 2018</p>
</div>
<p>Have a look at the webpage <a href="http://www.the-numbers.com/box-office-chart/daily/2018/07/04">http://www.the-numbers.com/box-office-chart/daily/2018/07/04</a> .</p>
<div id="scraping-one-page" class="section level2">
<h2><span class="header-section-number">8.1</span> Scraping one page</h2>
<p>In later lessons we’ll learn how to scrape an entire year of data from this site. For now, let’s focus on just getting data from July 4th, 2018.</p>
<p>The first step to scraping a page is to read in that page’s information to R using the function <code>read_html()</code>. The input for the () is the URL of the page we want to scrape. In a later lesson, we will manipulate this URL to be able to scrape data from many pages.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_html</span>(<span class="st">&quot;http://www.the-numbers.com/box-office-chart/daily/2018/07/04&quot;</span>)
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;html&gt;</span>
<span class="co">#&gt; [1] &lt;head&gt;\n&lt;!-- Global site tag (gtag.js) - Google Analytics --&gt;&lt;script ...</span>
<span class="co">#&gt; [2] &lt;body&gt;\n\r\n&lt;script&gt;\r\n  window.fbAsyncInit = function() {\r\n    F ...</span></code></pre>
<p>When running the above code, it returns an XML Document. The <code>rvest</code> package is well suited for interpreting this and turning it into something we already know how to work with. To be able to work on this data, we need to save the output of <code>read_html()</code> into an object which we’ll call “movie_data” since that is our end goal.</p>
<pre class="sourceCode r"><code class="sourceCode r">movie_data &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.the-numbers.com/box-office-chart/daily/2018/07/04&quot;</span>)</code></pre>
<p>We now need to select only a small part of page which has the relevant information - in this case the data in the table.</p>
<p>Right click somewhere in the table and then click “Inspect Element”.</p>
<p><img src="images/the-numbers_2.PNG" /></p>
<p>This will open up a tab on the screen and allows you to see the building blocks on that page. When you move your cursor over parts of this tab, the parts of the page it relates to will be highlighted in blue. Want want all of the data from the table so move your cursor to where it starts with “&lt;table”. Doing so will highlight the entire table in blue.</p>
<p><img src="images/the-numbers_3.PNG" /></p>
<p>Right click the “table” area and click Copy then CSS Selector. That will copy what we need. Essentially this says which part of the page is the table and lets us grab only that from the XML Document we made earlier.</p>
<p><img src="images/the-numbers_4.PNG" /></p>
<p>We will use the function <code>html_nodes()</code> to just grab the parts of the page (based on the CSS selectors) that we want. The input for this function is first the object made from <code>read_html()</code> (which we called “movie_data”) and then we can paste the text we copied from thr website (putting it in quotes).</p>
<p>Note that when doing this in Google Chrome, you follow the same steps except click “Copy selector” rather than “CSS Selector”. The value copied also differs between Chrome and Firefox though the result is the same in our code.</p>
<pre class="sourceCode r"><code class="sourceCode r">movie_data &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(movie_data, <span class="st">&quot;#page_filling_chart &gt; center:nth-child(2) &gt; table&quot;</span>)</code></pre>
<p>Since we are getting data from a table, we need to tell rvest that the format of the scraped data is a table. We do with using <code>html_table()</code> and our input in the () is the the object made in the function <code>html_nodes()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">movie_data &lt;-<span class="st"> </span><span class="kw">html_table</span>(movie_data)</code></pre>
<p>By default, <code>rvest</code> returns a list. We prefer to work with data.frames so we’re going to use double square bracket notation [[]] to just take the first object in the list, which is the data from the table we scraped. In a future lesson we will discuss more explicitly what lists are and understand what we are doing here.</p>
<pre class="sourceCode r"><code class="sourceCode r">movie_data &lt;-<span class="st"> </span>movie_data[[<span class="dv">1</span>]]</code></pre>
<p>Take a look at the webpage and compare it to the data set you’ve now created. All the values should now match.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(movie_data)
                                 Movie   Distributor       Gross Change
<span class="dv">1</span> <span class="dv">1</span> (<span class="dv">1</span>) Jurassic World<span class="op">:</span><span class="st"> </span>Fallen Kingdom     Universal <span class="op">$</span><span class="dv">11</span>,<span class="dv">501</span>,<span class="dv">395</span>    <span class="dv">-3</span>%
<span class="dv">2</span> <span class="dv">2</span> (<span class="dv">2</span>)                  Incredibles <span class="dv">2</span>   Walt Disney  <span class="op">$</span><span class="dv">9</span>,<span class="dv">646</span>,<span class="dv">015</span>    <span class="dv">-6</span>%
<span class="dv">3</span> <span class="dv">3</span> new                The First Purge     Universal  <span class="op">$</span><span class="dv">9</span>,<span class="dv">305</span>,<span class="dv">875</span>       
<span class="dv">4</span> <span class="dv">4</span> (<span class="dv">3</span>)    Sicario<span class="op">:</span><span class="st"> </span>Day of the Soldado Sony Pictures  <span class="op">$</span><span class="dv">2</span>,<span class="dv">577</span>,<span class="dv">639</span>    n<span class="op">/</span>c
<span class="dv">5</span> <span class="dv">5</span> (<span class="dv">4</span>)                     Uncle Drew     Lionsgate  <span class="op">$</span><span class="dv">2</span>,<span class="dv">177</span>,<span class="dv">946</span>   <span class="dv">-13</span>%
<span class="dv">6</span> <span class="dv">6</span> (<span class="dv">5</span>)                      Ocean’s <span class="dv">8</span>  Warner Bros.  <span class="op">$</span><span class="dv">2</span>,<span class="dv">093</span>,<span class="dv">164</span>   <span class="op">+</span><span class="dv">14</span>%
  Thtrs. Per Thtr.  Total Gross Days
<span class="dv">1</span>  <span class="dv">4</span>,<span class="dv">485</span>    <span class="op">$</span><span class="dv">2</span>,<span class="dv">564</span> <span class="op">$</span><span class="dv">297</span>,<span class="dv">672</span>,<span class="dv">320</span>   <span class="dv">13</span>
<span class="dv">2</span>  <span class="dv">4</span>,<span class="dv">410</span>    <span class="op">$</span><span class="dv">2</span>,<span class="dv">187</span> <span class="op">$</span><span class="dv">468</span>,<span class="dv">190</span>,<span class="dv">380</span>   <span class="dv">20</span>
<span class="dv">3</span>  <span class="dv">3</span>,<span class="dv">031</span>    <span class="op">$</span><span class="dv">3</span>,<span class="dv">070</span>   <span class="op">$</span><span class="dv">9</span>,<span class="dv">305</span>,<span class="dv">875</span>    <span class="dv">1</span>
<span class="dv">4</span>  <span class="dv">3</span>,<span class="dv">055</span>      <span class="op">$</span><span class="dv">844</span>  <span class="op">$</span><span class="dv">26</span>,<span class="dv">320</span>,<span class="dv">689</span>    <span class="dv">6</span>
<span class="dv">5</span>  <span class="dv">2</span>,<span class="dv">742</span>      <span class="op">$</span><span class="dv">794</span>  <span class="op">$</span><span class="dv">21</span>,<span class="dv">729</span>,<span class="dv">447</span>    <span class="dv">6</span>
<span class="dv">6</span>  <span class="dv">3</span>,<span class="dv">426</span>      <span class="op">$</span><span class="dv">611</span> <span class="op">$</span><span class="dv">120</span>,<span class="dv">300</span>,<span class="dv">214</span>   <span class="dv">27</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(movie_data)
                       Movie          Distributor  Gross Change Thtrs.
<span class="dv">43</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>)               Beast Roadside Attractions <span class="op">$</span><span class="dv">1</span>,<span class="dv">332</span>   <span class="dv">-18</span>%     <span class="dv">14</span>
<span class="dv">44</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>)     On Chesil Beach      Bleecker Street <span class="op">$</span><span class="dv">1</span>,<span class="dv">305</span>    <span class="dv">-2</span>%     <span class="dv">10</span>
<span class="dv">45</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>) Let The Sunshine In     Sundance Selects <span class="op">$</span><span class="dv">1</span>,<span class="dv">098</span>  <span class="op">+</span><span class="dv">104</span>%      <span class="dv">4</span>
<span class="dv">46</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>)    Super Troopers <span class="dv">2</span>     20th Century Fox   <span class="op">$</span><span class="dv">718</span>   <span class="dv">-44</span>%     <span class="dv">21</span>
<span class="dv">47</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>)        Summer of <span class="dv">67</span>     Self Distributed   <span class="op">$</span><span class="dv">450</span>  <span class="op">+</span><span class="dv">254</span>%      <span class="dv">1</span>
<span class="dv">48</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span>)      Chappaquiddick Entertainment Studi…   <span class="op">$</span><span class="dv">445</span>   <span class="dv">-44</span>%      <span class="dv">6</span>
   Per Thtr. Total Gross Days
<span class="dv">43</span>       <span class="op">$</span><span class="dv">95</span>    <span class="op">$</span><span class="dv">798</span>,<span class="dv">923</span>   <span class="dv">55</span>
<span class="dv">44</span>      <span class="op">$</span><span class="dv">131</span>    <span class="op">$</span><span class="dv">733</span>,<span class="dv">899</span>   <span class="dv">48</span>
<span class="dv">45</span>      <span class="op">$</span><span class="dv">275</span>    <span class="op">$</span><span class="dv">855</span>,<span class="dv">165</span>   <span class="dv">69</span>
<span class="dv">46</span>       <span class="op">$</span><span class="dv">34</span> <span class="op">$</span><span class="dv">30</span>,<span class="dv">608</span>,<span class="dv">780</span>   <span class="dv">76</span>
<span class="dv">47</span>      <span class="op">$</span><span class="dv">450</span>      <span class="op">$</span><span class="dv">6</span>,<span class="dv">196</span>    <span class="dv">6</span>
<span class="dv">48</span>       <span class="op">$</span><span class="dv">74</span> <span class="op">$</span><span class="dv">17</span>,<span class="dv">387</span>,<span class="dv">545</span>   <span class="dv">90</span></code></pre>
<p>We have now successfully scraped a website! The “movie_data” object is a data.frame object that we are familiar with from looking at the Chicago and UCR data so we can subset and manipulate it like we’ve done before.</p>
</div>
<div id="cleaning-the-webscraped-data" class="section level2">
<h2><span class="header-section-number">8.2</span> Cleaning the webscraped data</h2>
<p>Let’s look at some summary statistics and try to find which movie made the most money that day. Let’s check what the max value is in the “Gross” column which says how much the movie made on that day.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(movie_data<span class="op">$</span>Gross)
<span class="co">#&gt; [1] &quot;$9,646,015&quot;</span></code></pre>
<p>So the most money a movie made is about $9.6 million. Is that right? We can check either the website or the data in <code>View()</code> to see if there are any more successful movies (convienently, the table is already sorted by how much the movie made). No! The most successful movie made $11.5 million, not $9.5 million. So why did <code>max()</code> say the top value is 9.6 million? Let’s take another look at the values in the “Gross” column.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(movie_data<span class="op">$</span>Gross)
<span class="co">#&gt; [1] &quot;$11,501,395&quot; &quot;$9,646,015&quot;  &quot;$9,305,875&quot;  &quot;$2,577,639&quot;  &quot;$2,177,946&quot; </span>
<span class="co">#&gt; [6] &quot;$2,093,164&quot;</span></code></pre>
<p>The values are not actually numeric type. If a value is numeric in R it would only have numbers, not dollar signs or commas like we see here. It also would not be in quotes, R’s way of saying “this value is a character type”. So what we have to do is turn these values into numeric type.</p>
<p>The way to convert a character type into a numeric type is the function <code>as.numeric()</code>. Let’s take a look at the very first value in that column, “$11,501,395”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="st">&quot;$11,501,395&quot;</span>)
<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="co">#&gt; [1] NA</span></code></pre>
<p>Running <code>as.numeric()</code> on that value returns NA because it doesn’t know how to handle the dollar sign and comma. If we remove those, it will work as expected.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="st">&quot;11501395&quot;</span>)
<span class="co">#&gt; [1] 11501395</span></code></pre>
<p>We can use <code>gsub()</code> which we learned earlier in <a href="regular-expressions.html#regular-expressions">6</a> to delete the dollar sign and commas from our values. After that we can use <code>as.numeric()</code> to fix that column. (alternatively we could use the function <code>parse_number()</code> from the <code>readr</code> package, but this is a good example of using regular expressions)</p>
<p>Remember that the syntax of <code>gsub()</code> is</p>
<p>gsub(“find”, “replace”, string_to_fix)</p>
<p>First we will remove the comma. We want to use <code>gsub()</code> to find all commas and replace it with nothing (deleting it). To indicate nothing we just use quotes without anything in it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;$11,501,395&quot;</span>)
<span class="co">#&gt; [1] &quot;$11501395&quot;</span></code></pre>
<p>Now to do the dollar sign. Remember that in <code>gsub()</code> and <code>grep()</code> the $ is a special character indicating that whatever precedes it is the last character. To tell R we want the $ literally, we use two backslashes before it - this is how to deal with all special characters, not just dollar signs.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;$11,501,395&quot;</span>)
<span class="co">#&gt; [1] &quot;11,501,395&quot;</span></code></pre>
<p>Each of these <code>gsub()</code>s work alone. We need to combine them to remove both the dollar sign and comma. We have two choices for this. The first choice is to use the <code>|</code> operator which tells <code>gsub()</code> to replace the value on the left <strong>or</strong> right side of them symbol (or both if both are present).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="st">&quot;,|</span><span class="ch">\\</span><span class="st">$&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;$11,501,395&quot;</span>)
<span class="co">#&gt; [1] &quot;11501395&quot;</span></code></pre>
<p>The second choce is to do them separately and save the results into an object that we use in the second <code>gsub()</code>. Let’s first save our value "“$11,501,395” into an object we call “x” and then run both <code>gsub()</code> we wrote earlier, using “x” as our value and saving the results back into x. For those not very comfortable with regular expressions, this is the better way of doing it as you can deal with simpler <code>gsub()</code> expressions than above.</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> &quot;$11,501,395&quot;</span>
x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>, x)
x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$&quot;</span>, <span class="st">&quot;&quot;</span>, x)
x
<span class="co">#&gt; [1] &quot;11501395&quot;</span></code></pre>
<p>Finally we can use <code>as.numeric()</code> on the result to turn it into a numeric type.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(x)
<span class="co">#&gt; [1] 11501395</span></code></pre>
<p>Now we have code that works on a single value, let’s do it for the entire “Gross” column and turn it numeric.</p>
<pre class="sourceCode r"><code class="sourceCode r">movie_data<span class="op">$</span>Gross &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;,|</span><span class="ch">\\</span><span class="st">$&quot;</span>, <span class="st">&quot;&quot;</span>, movie_data<span class="op">$</span>Gross)
movie_data<span class="op">$</span>Gross &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(movie_data<span class="op">$</span>Gross)</code></pre>
<p>We can look at the first 6 rows in that column and check the max value to see if our code worked.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(movie_data<span class="op">$</span>Gross)
<span class="co">#&gt; [1] 11501395  9646015  9305875  2577639  2177946  2093164</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(movie_data<span class="op">$</span>Gross)
<span class="co">#&gt; [1] 11501395</span></code></pre>
</div>
<div id="fixing-names" class="section level2">
<h2><span class="header-section-number">8.3</span> Fixing names</h2>
<p>If we run <code>names()</code> on our data we will see that there is a column with a space in the name “Total Gross”. This is an issue because it is difficult to select a function with a space in the name.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(movie_data)
<span class="co">#&gt;  [1] &quot;&quot;            &quot;&quot;            &quot;Movie&quot;       &quot;Distributor&quot; &quot;Gross&quot;      </span>
<span class="co">#&gt;  [6] &quot;Change&quot;      &quot;Thtrs.&quot;      &quot;Per Thtr.&quot;   &quot;Total Gross&quot; &quot;Days&quot;</span></code></pre>
<p>Trying to do so using the dollar sign notation causes an error.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(movie_data<span class="op">$</span>Total Gross)
<span class="co">#&gt; Error: &lt;text&gt;:1:23: unexpected symbol</span>
<span class="co">#&gt; 1: head(movie_data$Total Gross</span>
<span class="co">#&gt;                           ^</span></code></pre>
<p>To select it we need to put the name in between tick marks `` so R knows to include the value after the space as part of the colum name.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(movie_data<span class="op">$</span><span class="st">`</span><span class="dt">Total Gross</span><span class="st">`</span>)
<span class="co">#&gt; [1] &quot;$297,672,320&quot; &quot;$468,190,380&quot; &quot;$9,305,875&quot;   &quot;$26,320,689&quot; </span>
<span class="co">#&gt; [5] &quot;$21,729,447&quot;  &quot;$120,300,214&quot;</span></code></pre>
<p>An alternative is to change the column name using both <code>names()</code> and <code>gsub()</code> together to remove the space. Running <code>names()</code> returns the name of every column. If we assign something to the <code>names()</code> it will actually change the column names to whatever we assign it. What we want to do is use <code>gsub()</code> to replace all spaces in column names with something else - either with nothing or a value R understands as part of a name such as an underscore.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">names</span>(movie_data))
<span class="co">#&gt;  [1] &quot;&quot;            &quot;&quot;            &quot;Movie&quot;       &quot;Distributor&quot; &quot;Gross&quot;      </span>
<span class="co">#&gt;  [6] &quot;Change&quot;      &quot;Thtrs.&quot;      &quot;PerThtr.&quot;    &quot;TotalGross&quot;  &quot;Days&quot;</span></code></pre>
<p>If we assign the results of that <code>gsub()</code> to the <code>names()</code>, it will change the names to the values resulting from <code>gsub()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(movie_data) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">names</span>(movie_data))</code></pre>
<p>We can check to make sure it worked by again running <code>names()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(movie_data)
<span class="co">#&gt;  [1] &quot;&quot;            &quot;&quot;            &quot;Movie&quot;       &quot;Distributor&quot; &quot;Gross&quot;      </span>
<span class="co">#&gt;  [6] &quot;Change&quot;      &quot;Thtrs.&quot;      &quot;PerThtr.&quot;    &quot;TotalGross&quot;  &quot;Days&quot;</span></code></pre>
<div id="exercises-7" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Turn the columns “Thtrs.” and “TotalGross” into numeric type.</li>
<li>What was the average number of theaters that a movie played in?</li>
</ol>
<ul>
<li>How many more theaters did the top movie (by number of theaters) play in than average?</li>
<li>How many fewer theaters did the bottom movie (by number of theaters) play in than average?</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>How big is the difference in theates as the mean number of theaters played in and the median? Which should we use?</li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graphing-with-ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/r4crim/edit/master/webscraping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
