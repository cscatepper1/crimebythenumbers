<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Interactive maps | Crime by the Numbers</title>
  <meta name="description" content="This book introduces the programming language R and is meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Interactive maps | Crime by the Numbers" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://crimebythenumbers.com" />
  <meta property="og:image" content="https://crimebythenumbers.comRuby-throated_HummingBird.jpg" />
  <meta property="og:description" content="This book introduces the programming language R and is meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="github-repo" content="jacobkap/crimebythenumbers" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Interactive maps | Crime by the Numbers" />
  
  <meta name="twitter:description" content="This book introduces the programming language R and is meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
  <meta name="twitter:image" content="https://crimebythenumbers.comRuby-throated_HummingBird.jpg" />

<meta name="author" content="Jacob Kaplan" />


<meta name="date" content="2019-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="choropleth-maps.html">
<link rel="next" href="r-markdown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99359926-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-99359926-6');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Crime by the Numbers</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-learn-to-program"><i class="fa fa-check"></i>Why learn to program?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#scale"><i class="fa fa-check"></i>Scale</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-will-learn"><i class="fa fa-check"></i>What you will learn</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i>Skills</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i>Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-wont-learn"><i class="fa fa-check"></i>What you won’t learn</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#simple-vs-easy"><i class="fa fa-check"></i>Simple vs Easy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to Contribute</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the author</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#using-rstudio"><i class="fa fa-check"></i><b>1.1</b> Using RStudio</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#opening-an-r-script"><i class="fa fa-check"></i><b>1.1.1</b> Opening an R Script</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#setting-the-working-directory"><i class="fa fa-check"></i><b>1.1.2</b> Setting the working directory</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#changing-rstudio"><i class="fa fa-check"></i><b>1.1.3</b> Changing RStudio</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#helpful-cheatsheets"><i class="fa fa-check"></i><b>1.1.4</b> Helpful cheatsheets</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.2</b> Reading data into R</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#loading-data"><i class="fa fa-check"></i><b>1.2.1</b> Loading data</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#first-steps-to-exploring-data"><i class="fa fa-check"></i><b>1.3</b> First steps to exploring data</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#finding-help-about-functions"><i class="fa fa-check"></i><b>1.4</b> Finding help about functions</a></li>
</ul></li>
<li class="part"><span><b>I Clean</b></span></li>
<li class="chapter" data-level="2" data-path="subsetting-intro.html"><a href="subsetting-intro.html"><i class="fa fa-check"></i><b>2</b> Subsetting: Making big things small</a><ul>
<li class="chapter" data-level="2.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-values"><i class="fa fa-check"></i><b>2.1</b> Select specific values</a></li>
<li class="chapter" data-level="2.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#assignment"><i class="fa fa-check"></i><b>2.2</b> Assignment values to objects (Making “things”)</a></li>
<li class="chapter" data-level="2.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#vectors"><i class="fa fa-check"></i><b>2.3</b> Vectors (collections of “things”)</a></li>
<li class="chapter" data-level="2.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#logical-values-and-operations"><i class="fa fa-check"></i><b>2.4</b> Logical values and operations</a><ul>
<li class="chapter" data-level="2.4.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-a-single-value"><i class="fa fa-check"></i><b>2.4.1</b> Matching a single value</a></li>
<li class="chapter" data-level="2.4.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#matching-multiple-values"><i class="fa fa-check"></i><b>2.4.2</b> Matching multiple values</a></li>
<li class="chapter" data-level="2.4.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#does-not-match"><i class="fa fa-check"></i><b>2.4.3</b> Does not match</a></li>
<li class="chapter" data-level="2.4.4" data-path="subsetting-intro.html"><a href="subsetting-intro.html#greater-than-or-less-than"><i class="fa fa-check"></i><b>2.4.4</b> Greater than or less than</a></li>
<li class="chapter" data-level="2.4.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#combining-conditional-statements---or-and"><i class="fa fa-check"></i><b>2.4.5</b> Combining conditional statements - or, and</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subsetting-a-data.frame"><i class="fa fa-check"></i><b>2.5</b> Subsetting a data.frame</a><ul>
<li class="chapter" data-level="2.5.1" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-columns"><i class="fa fa-check"></i><b>2.5.1</b> Select specific columns</a></li>
<li class="chapter" data-level="2.5.2" data-path="subsetting-intro.html"><a href="subsetting-intro.html#select-specific-rows"><i class="fa fa-check"></i><b>2.5.2</b> Select specific rows</a></li>
<li class="chapter" data-level="2.5.3" data-path="subsetting-intro.html"><a href="subsetting-intro.html#subset-colorado-data"><i class="fa fa-check"></i><b>2.5.3</b> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="explore.html"><a href="explore.html"><i class="fa fa-check"></i><b>3</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="explore.html"><a href="explore.html#summary-and-table"><i class="fa fa-check"></i><b>3.1</b> Summary and Table</a></li>
<li class="chapter" data-level="3.2" data-path="explore.html"><a href="explore.html#graphing"><i class="fa fa-check"></i><b>3.2</b> Graphing</a></li>
<li class="chapter" data-level="3.3" data-path="explore.html"><a href="explore.html#aggregate"><i class="fa fa-check"></i><b>3.3</b> Aggregating (summaries of groups)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>4</b> Regular Expressions</a><ul>
<li class="chapter" data-level="4.1" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-patterns-in-text-with-grep"><i class="fa fa-check"></i><b>4.1</b> Finding patterns in text with <code>grep()</code></a></li>
<li class="chapter" data-level="4.2" data-path="regular-expressions.html"><a href="regular-expressions.html#finding-and-replacing-patterns-in-text-with-gsub"><i class="fa fa-check"></i><b>4.2</b> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li class="chapter" data-level="4.3" data-path="regular-expressions.html"><a href="regular-expressions.html#useful-special-characters"><i class="fa fa-check"></i><b>4.3</b> Useful special characters</a><ul>
<li class="chapter" data-level="4.3.1" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-characters"><i class="fa fa-check"></i><b>4.3.1</b> Multiple characters <code>[]</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-of-previous-character-n"><i class="fa fa-check"></i><b>4.3.2</b> n-many of previous character <code>{n}</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="regular-expressions.html"><a href="regular-expressions.html#n-many-to-m-many-of-previous-character-nm"><i class="fa fa-check"></i><b>4.3.3</b> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="regular-expressions.html"><a href="regular-expressions.html#start-of-string"><i class="fa fa-check"></i><b>4.3.4</b> Start of string</a></li>
<li class="chapter" data-level="4.3.5" data-path="regular-expressions.html"><a href="regular-expressions.html#end-of-string"><i class="fa fa-check"></i><b>4.3.5</b> End of string <code>$</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="regular-expressions.html"><a href="regular-expressions.html#anything-."><i class="fa fa-check"></i><b>4.3.6</b> Anything <code>.</code></a></li>
<li class="chapter" data-level="4.3.7" data-path="regular-expressions.html"><a href="regular-expressions.html#one-or-more-of-previous"><i class="fa fa-check"></i><b>4.3.7</b> One or more of previous <code>+</code></a></li>
<li class="chapter" data-level="4.3.8" data-path="regular-expressions.html"><a href="regular-expressions.html#zero-or-more-of-previous"><i class="fa fa-check"></i><b>4.3.8</b> Zero or more of previous <code>*</code></a></li>
<li class="chapter" data-level="4.3.9" data-path="regular-expressions.html"><a href="regular-expressions.html#multiple-patterns"><i class="fa fa-check"></i><b>4.3.9</b> Multiple patterns <code>|</code></a></li>
<li class="chapter" data-level="4.3.10" data-path="regular-expressions.html"><a href="regular-expressions.html#parentheses"><i class="fa fa-check"></i><b>4.3.10</b> Parentheses <code>()</code></a></li>
<li class="chapter" data-level="4.3.11" data-path="regular-expressions.html"><a href="regular-expressions.html#optional-text"><i class="fa fa-check"></i><b>4.3.11</b> Optional text <code>?</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="regular-expressions.html"><a href="regular-expressions.html#changing-capitalization"><i class="fa fa-check"></i><b>4.4</b> Changing capitalization</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>5</b> Reading and Writing Data</a><ul>
<li class="chapter" data-level="5.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#reading-data-into-r-1"><i class="fa fa-check"></i><b>5.1</b> Reading Data into R</a><ul>
<li class="chapter" data-level="5.1.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r"><i class="fa fa-check"></i><b>5.1.1</b> R</a></li>
<li class="chapter" data-level="5.1.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel"><i class="fa fa-check"></i><b>5.1.2</b> Excel</a></li>
<li class="chapter" data-level="5.1.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata"><i class="fa fa-check"></i><b>5.1.3</b> Stata</a></li>
<li class="chapter" data-level="5.1.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas"><i class="fa fa-check"></i><b>5.1.4</b> SAS</a></li>
<li class="chapter" data-level="5.1.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss"><i class="fa fa-check"></i><b>5.1.5</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-data"><i class="fa fa-check"></i><b>5.2</b> Writing Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#r-1"><i class="fa fa-check"></i><b>5.2.1</b> R</a></li>
<li class="chapter" data-level="5.2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#excel-1"><i class="fa fa-check"></i><b>5.2.2</b> Excel</a></li>
<li class="chapter" data-level="5.2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#stata-1"><i class="fa fa-check"></i><b>5.2.3</b> Stata</a></li>
<li class="chapter" data-level="5.2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#sas-1"><i class="fa fa-check"></i><b>5.2.4</b> SAS</a></li>
<li class="chapter" data-level="5.2.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#spss-1"><i class="fa fa-check"></i><b>5.2.5</b> SPSS</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Visualize</b></span></li>
<li class="chapter" data-level="6" data-path="graphing-intro.html"><a href="graphing-intro.html"><i class="fa fa-check"></i><b>6</b> Graphing with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="6.1" data-path="graphing-intro.html"><a href="graphing-intro.html#what-does-the-data-look-like"><i class="fa fa-check"></i><b>6.1</b> What does the data look like?</a></li>
<li class="chapter" data-level="6.2" data-path="graphing-intro.html"><a href="graphing-intro.html#graphing-data"><i class="fa fa-check"></i><b>6.2</b> Graphing data</a></li>
<li class="chapter" data-level="6.3" data-path="graphing-intro.html"><a href="graphing-intro.html#time-series-plots"><i class="fa fa-check"></i><b>6.3</b> Time-Series Plots</a></li>
<li class="chapter" data-level="6.4" data-path="graphing-intro.html"><a href="graphing-intro.html#color-blindness"><i class="fa fa-check"></i><b>6.4</b> Color blindness</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hotspot-maps.html"><a href="hotspot-maps.html"><i class="fa fa-check"></i><b>7</b> Hotspot maps</a><ul>
<li class="chapter" data-level="7.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#a-simple-map"><i class="fa fa-check"></i><b>7.1</b> A simple map</a></li>
<li class="chapter" data-level="7.2" data-path="hotspot-maps.html"><a href="hotspot-maps.html#what-really-are-maps"><i class="fa fa-check"></i><b>7.2</b> What really are maps?</a></li>
<li class="chapter" data-level="7.3" data-path="hotspot-maps.html"><a href="hotspot-maps.html#making-a-hotspot-map"><i class="fa fa-check"></i><b>7.3</b> Making a hotspot map</a><ul>
<li class="chapter" data-level="7.3.1" data-path="hotspot-maps.html"><a href="hotspot-maps.html#colors"><i class="fa fa-check"></i><b>7.3.1</b> Colors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="choropleth-maps.html"><a href="choropleth-maps.html"><i class="fa fa-check"></i><b>8</b> Choropleth maps</a><ul>
<li class="chapter" data-level="8.1" data-path="choropleth-maps.html"><a href="choropleth-maps.html#spatial-joins"><i class="fa fa-check"></i><b>8.1</b> Spatial joins</a></li>
<li class="chapter" data-level="8.2" data-path="choropleth-maps.html"><a href="choropleth-maps.html#making-choropleth-maps"><i class="fa fa-check"></i><b>8.2</b> Making choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>9</b> Interactive maps</a><ul>
<li class="chapter" data-level="9.1" data-path="interactive-maps.html"><a href="interactive-maps.html#why-do-interactive-graphs-matter"><i class="fa fa-check"></i><b>9.1</b> Why do interactive graphs matter?</a><ul>
<li class="chapter" data-level="9.1.1" data-path="interactive-maps.html"><a href="interactive-maps.html#understanding-your-data"><i class="fa fa-check"></i><b>9.1.1</b> Understanding your data</a></li>
<li class="chapter" data-level="9.1.2" data-path="interactive-maps.html"><a href="interactive-maps.html#police-departments-use-them"><i class="fa fa-check"></i><b>9.1.2</b> Police departments use them</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="interactive-maps.html"><a href="interactive-maps.html#making-the-interactive-map"><i class="fa fa-check"></i><b>9.2</b> Making the interactive map</a></li>
<li class="chapter" data-level="9.3" data-path="interactive-maps.html"><a href="interactive-maps.html#adding-popup-information"><i class="fa fa-check"></i><b>9.3</b> Adding popup information</a></li>
<li class="chapter" data-level="9.4" data-path="interactive-maps.html"><a href="interactive-maps.html#dealing-with-too-many-markers"><i class="fa fa-check"></i><b>9.4</b> Dealing with too many markers</a></li>
<li class="chapter" data-level="9.5" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-choropleth-maps"><i class="fa fa-check"></i><b>9.5</b> Interactive choropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>10</b> R Markdown</a><ul>
<li class="chapter" data-level="10.1" data-path="r-markdown.html"><a href="r-markdown.html#code-1"><i class="fa fa-check"></i><b>10.1</b> Code</a><ul>
<li class="chapter" data-level="10.1.1" data-path="r-markdown.html"><a href="r-markdown.html#hiding-code-in-the-output"><i class="fa fa-check"></i><b>10.1.1</b> Hiding code in the output</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="r-markdown.html"><a href="r-markdown.html#tables"><i class="fa fa-check"></i><b>10.2</b> Tables</a></li>
<li class="chapter" data-level="10.3" data-path="r-markdown.html"><a href="r-markdown.html#making-the-output-file"><i class="fa fa-check"></i><b>10.3</b> Making the output file</a></li>
</ul></li>
<li class="part"><span><b>III Collect</b></span></li>
<li class="chapter" data-level="11" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html"><i class="fa fa-check"></i><b>11</b> Webscraping with <code>rvest</code></a><ul>
<li class="chapter" data-level="11.1" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#scraping-one-page"><i class="fa fa-check"></i><b>11.1</b> Scraping one page</a></li>
<li class="chapter" data-level="11.2" data-path="webscraping-with-rvest.html"><a href="webscraping-with-rvest.html#cleaning-the-webscraped-data"><i class="fa fa-check"></i><b>11.2</b> Cleaning the webscraped data</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>12</b> Functions</a><ul>
<li class="chapter" data-level="12.1" data-path="functions.html"><a href="functions.html#a-simple-function"><i class="fa fa-check"></i><b>12.1</b> A simple function</a></li>
<li class="chapter" data-level="12.2" data-path="functions.html"><a href="functions.html#adding-parameters"><i class="fa fa-check"></i><b>12.2</b> Adding parameters</a></li>
<li class="chapter" data-level="12.3" data-path="functions.html"><a href="functions.html#recipes-function"><i class="fa fa-check"></i><b>12.3</b> Making a function to scrape recipes</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>13</b> For loops</a><ul>
<li class="chapter" data-level="13.1" data-path="for-loops.html"><a href="for-loops.html#basic-for-loops"><i class="fa fa-check"></i><b>13.1</b> Basic for loops</a></li>
<li class="chapter" data-level="13.2" data-path="for-loops.html"><a href="for-loops.html#scraping-multiple-recipes"><i class="fa fa-check"></i><b>13.2</b> Scraping multiple recipes</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="scrape-table.html"><a href="scrape-table.html"><i class="fa fa-check"></i><b>14</b> Scraping Tables from PDFs</a><ul>
<li class="chapter" data-level="14.1" data-path="scrape-table.html"><a href="scrape-table.html#scraping-the-first-table"><i class="fa fa-check"></i><b>14.1</b> Scraping the first table</a></li>
<li class="chapter" data-level="14.2" data-path="scrape-table.html"><a href="scrape-table.html#making-a-function"><i class="fa fa-check"></i><b>14.2</b> Making a function</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>15</b> Geocoding</a><ul>
<li class="chapter" data-level="15.1" data-path="geocoding.html"><a href="geocoding.html#geocoding-a-single-address"><i class="fa fa-check"></i><b>15.1</b> Geocoding a single address</a></li>
<li class="chapter" data-level="15.2" data-path="geocoding.html"><a href="geocoding.html#making-a-function-1"><i class="fa fa-check"></i><b>15.2</b> Making a function</a></li>
<li class="chapter" data-level="15.3" data-path="geocoding.html"><a href="geocoding.html#geocoding-san-francisco-marijuana-dispensary-locations"><i class="fa fa-check"></i><b>15.3</b> Geocoding San Francisco marijuana dispensary locations</a></li>
</ul></li>
<li class="part"><span><b>IV Data</b></span></li>
<li class="chapter" data-level="16" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>16</b> Introduction</a></li>
<li class="chapter" data-level="17" data-path="ucr.html"><a href="ucr.html"><i class="fa fa-check"></i><b>17</b> Uniform Crime Report (UCR) - Offenses Known and Clearances by Arrest</a><ul>
<li class="chapter" data-level="17.1" data-path="ucr.html"><a href="ucr.html#exploring-the-ucr-data"><i class="fa fa-check"></i><b>17.1</b> Exploring the UCR data</a></li>
<li class="chapter" data-level="17.2" data-path="ucr.html"><a href="ucr.html#oris---unique-agency-identifiers"><i class="fa fa-check"></i><b>17.2</b> ORIs - Unique agency identifiers</a></li>
<li class="chapter" data-level="17.3" data-path="ucr.html"><a href="ucr.html#hierarchy-rule"><i class="fa fa-check"></i><b>17.3</b> Hierarchy Rule</a></li>
<li class="chapter" data-level="17.4" data-path="ucr.html"><a href="ucr.html#which-crimes-are-included"><i class="fa fa-check"></i><b>17.4</b> Which crimes are included</a><ul>
<li class="chapter" data-level="17.4.1" data-path="ucr.html"><a href="ucr.html#index-crimes"><i class="fa fa-check"></i><b>17.4.1</b> Index Crimes</a></li>
<li class="chapter" data-level="17.4.2" data-path="ucr.html"><a href="ucr.html#the-problem-with-using-index-crimes"><i class="fa fa-check"></i><b>17.4.2</b> The problem with using index crimes</a></li>
<li class="chapter" data-level="17.4.3" data-path="ucr.html"><a href="ucr.html#rape-definition-change"><i class="fa fa-check"></i><b>17.4.3</b> Rape definition change</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="ucr.html"><a href="ucr.html#actual-offenses-clearances-and-unfounded-offenses"><i class="fa fa-check"></i><b>17.5</b> Actual offenses, clearances, and unfounded offenses</a><ul>
<li class="chapter" data-level="17.5.1" data-path="ucr.html"><a href="ucr.html#actual"><i class="fa fa-check"></i><b>17.5.1</b> Actual</a></li>
<li class="chapter" data-level="17.5.2" data-path="ucr.html"><a href="ucr.html#total-cleared"><i class="fa fa-check"></i><b>17.5.2</b> Total Cleared</a></li>
<li class="chapter" data-level="17.5.3" data-path="ucr.html"><a href="ucr.html#cleared-where-all-offenders-are-under-18"><i class="fa fa-check"></i><b>17.5.3</b> Cleared Where All Offenders Are Under 18</a></li>
<li class="chapter" data-level="17.5.4" data-path="ucr.html"><a href="ucr.html#unfounded"><i class="fa fa-check"></i><b>17.5.4</b> Unfounded</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="ucr.html"><a href="ucr.html#number-of-months-reported"><i class="fa fa-check"></i><b>17.6</b> Number of months reported</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="useful-resources.html"><a href="useful-resources.html"><i class="fa fa-check"></i><b>A</b> Useful resources</a><ul>
<li class="chapter" data-level="A.1" data-path="useful-resources.html"><a href="useful-resources.html#learning-r-and-coding-issues"><i class="fa fa-check"></i><b>A.1</b> Learning R and coding issues</a></li>
<li class="chapter" data-level="A.2" data-path="useful-resources.html"><a href="useful-resources.html#data-1"><i class="fa fa-check"></i><b>A.2</b> Data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime by the Numbers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-maps" class="section level1">
<h1><span class="header-section-number">9</span> Interactive maps</h1>
<p>While maps of data are useful, their ability to show incident-level information is quite limited. They tend to show broad trends - where crime happened in a city - rather than provide information about specific crime incidents. While broad trends are important, there are significant drawbacks about being unable to get important information about an incident without having to check the data. An interactive map bridges this gap by showing trends while allowing you to zoom into individual incidents and see information about each incident.</p>
<p>For this lesson we will be using data on every marijuana dispensary in San Francisco that have an active dispensary license as of late September 2019. The file is called “san_francisco_marijuana_geocoded.csv”.</p>
<p>When downloaded from California’s Bureau of Cannabis Control (<a href="https://aca5.accela.com/bcc/customization/bcc/cap/licenseSearch.aspx">here</a> if you’re interested) the data contains the address of each dispensary but does not have coordinates. Without coordinates we are unable to map points, meaning we need to
geocode them. Geocoding is the process of taking an address and getting the longitude and latitude of that address for mapping. For this lesson I’ve already geocoded the data and we’ll learn how to do so in Chapter <a href="geocoding.html#geocoding">15</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
marijuana &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/san_francisco_marijuana_geocoded.csv&quot;</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   License_Number = col_character(),</span>
<span class="co">#&gt;   License_Type = col_character(),</span>
<span class="co">#&gt;   Business_Owner = col_character(),</span>
<span class="co">#&gt;   Business_Contact_Information = col_character(),</span>
<span class="co">#&gt;   Business_Structure = col_character(),</span>
<span class="co">#&gt;   Premise_Address = col_character(),</span>
<span class="co">#&gt;   Status = col_character(),</span>
<span class="co">#&gt;   Issue_Date = col_character(),</span>
<span class="co">#&gt;   Expiration_Date = col_character(),</span>
<span class="co">#&gt;   Activities = col_character(),</span>
<span class="co">#&gt;   `Adult-Use/Medicinal` = col_character(),</span>
<span class="co">#&gt;   lon = col_double(),</span>
<span class="co">#&gt;   lat = col_double()</span>
<span class="co">#&gt; )</span>
marijuana &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(marijuana)</code></pre>
<div id="why-do-interactive-graphs-matter" class="section level2">
<h2><span class="header-section-number">9.1</span> Why do interactive graphs matter?</h2>
<div id="understanding-your-data" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Understanding your data</h3>
<p>The most important thing to learn from this course is that understanding your data is crucial to good research. Making interactive maps is a very useful way to better understand your data as you can immediately see geographic patterns and quickly look at characteristics of those incidents to understand them.</p>
<p>In this lesson we will make a map of each officer-involved shooting that lets you click on the shooting and see some information about it. If we see a cluster of shootings, we can click on each shooting to see if they are similar. Though it is possible to find these patterns just looking at the data, it is easier to be able to see a geographic pattern and immediately look at information about each incident.</p>
</div>
<div id="police-departments-use-them" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Police departments use them</h3>
<p>Interactive maps are popular in large police departments such as Philadelphia and New York City. They allow easy understanding of geographic patterns in the data and, importantly, allow such access to people who do not have the technical skills necessary to create the maps. If nothing else, learning interactive maps may help you with a future job.</p>
</div>
</div>
<div id="making-the-interactive-map" class="section level2">
<h2><span class="header-section-number">9.2</span> Making the interactive map</h2>
<p>As usual, let’s take a look at the top 6 rows of the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(marijuana)
<span class="co">#&gt;    License_Number                License_Type   Business_Owner</span>
<span class="co">#&gt; 1 C10-0000614-LIC Cannabis - Retailer License     Terry Muller</span>
<span class="co">#&gt; 2 C10-0000586-LIC Cannabis - Retailer License    Jeremy Goodin</span>
<span class="co">#&gt; 3 C10-0000587-LIC Cannabis - Retailer License     Justin Jarin</span>
<span class="co">#&gt; 4 C10-0000539-LIC Cannabis - Retailer License Ondyn Herschelle</span>
<span class="co">#&gt; 5 C10-0000522-LIC Cannabis - Retailer License      Ryan Hudson</span>
<span class="co">#&gt; 6 C10-0000523-LIC Cannabis - Retailer License      Ryan Hudson</span>
<span class="co">#&gt;                                                                                                           Business_Contact_Information</span>
<span class="co">#&gt; 1                             OUTER SUNSET HOLDINGS, LLC  : Barbary Coast Sunset : Email- terry@barbarycoastsf.com : Phone- 5107173246</span>
<span class="co">#&gt; 2                           URBAN FLOWERS  : Urban Pharm : Email- hilary@urbanpharmsf.com : Phone- 9168335343 : Website- www.up415.com</span>
<span class="co">#&gt; 3                      CCPC, INC.  : The Green Door : Email- alicia@greendoorsf.com : Phone- 4155419590 : Website- www.greendoorsf.com</span>
<span class="co">#&gt; 4 SEVENTY SECOND STREET  : Flower Power SF : Email- flowerpowersf@hotmail.com : Phone- 5103681262 : Website- flowerpowerdispensary.com</span>
<span class="co">#&gt; 5   HOWARD STREET PARTNERS, LLC  : The Apothecarium : Email- Ryan@apothecarium.com : Phone- 4157469001 : Website- www.apothecarium.com</span>
<span class="co">#&gt; 6              DEEP THOUGHT, LLC  : The Apothecarium : Email- ryan@pothecarium.com : Phone- 4157469001 : Website- www.Apothecarium.com</span>
<span class="co">#&gt;          Business_Structure                         Premise_Address Status</span>
<span class="co">#&gt; 1 Limited Liability Company  2165 IRVING ST san francisco, CA 94122 Active</span>
<span class="co">#&gt; 2               Corporation 122 10TH ST SAN FRANCISCO, CA 941032605 Active</span>
<span class="co">#&gt; 3               Corporation   843 Howard ST SAN FRANCISCO, CA 94103 Active</span>
<span class="co">#&gt; 4               Corporation    70 SECOND ST SAN FRANCISCO, CA 94105 Active</span>
<span class="co">#&gt; 5 Limited Liability Company   527 Howard ST San Francisco, CA 94105 Active</span>
<span class="co">#&gt; 6 Limited Liability Company 2414 Lombard ST San Francisco, CA 94123 Active</span>
<span class="co">#&gt;   Issue_Date Expiration_Date                Activities Adult-Use/Medicinal</span>
<span class="co">#&gt; 1  9/13/2019       9/12/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt; 2  8/26/2019       8/25/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt; 3  8/26/2019       8/25/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt; 4   8/5/2019        8/4/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt; 5  7/29/2019       7/28/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt; 6  7/29/2019       7/28/2020 N/A for this license type                BOTH</span>
<span class="co">#&gt;         lon      lat</span>
<span class="co">#&gt; 1 -122.4811 37.76337</span>
<span class="co">#&gt; 2 -122.4156 37.77496</span>
<span class="co">#&gt; 3 -122.4037 37.78245</span>
<span class="co">#&gt; 4 -122.4003 37.78837</span>
<span class="co">#&gt; 5 -122.3967 37.78798</span>
<span class="co">#&gt; 6 -122.4413 37.79920</span></code></pre>
<p>This data ishas information about the type of license, who the owner is, where the dispensary is (as an address and as coordinates), and contact information. We’ll be making a map showing every dispensary in the city and make it so when you click a dot it’ll make a popup showing information about that dispensary.</p>
<p>We will use the package <code>leaflet</code> for our interactive map. <code>leaflet</code> produces maps similar to Google Maps with circles (or any icon we choose) for each value we add to the map. It allows you to zoom in, scroll around, and provides context to each incident that isn’t available on a static map.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;leaflet&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(leaflet)</code></pre>
<p>To make a <code>leaflet</code> map we need to run the function <code>leaflet()</code> and add a tile to the map. A tile is simply the background of the map. This <a href="https://leaflet-extras.github.io/leaflet-providers/preview/">website</a> provides a large number of potential tiles to use, though many are not relevant to our purposes of crime mapping.</p>
<p>We will use a standard tile from Open Street Maps. This tile gives street names and highlights important features such has parks and large stores which provides useful contexts for looking at the data. The <code>attribution</code> parameter isn’t strictly necessary but it is good form to say where your tile is from.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>)</code></pre>
<div id="htmlwidget-78468e61556988816d8b" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-78468e61556988816d8b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]}]},"evals":[],"jsHooks":[]}</script>
<p>When you run the above code it shows a world map (copied several times). Zoom into it and it’ll start showing relevant features of wherever you’re looking.</p>
<p>Note the <code>%&gt;%</code> between the <code>leaflet()</code> function and the <code>addTiles()</code> function. This is called a “pipe” in R and is used like the <code>+</code> in <code>ggplot()</code> to combine multiple functions together. This is used heavily in what is called the “tidyverse”, a series of packages that are prominent in modern R and useful for data analysis. We won’t be covering them in this book but for more information on them you can check the <a href="https://www.tidyverse.org/">tidyverse website</a>. For this lesson you need to know that each piece of the <code>leaflet</code> function must end with <code>%&gt;%</code> for the next line to work.</p>
<p>To add the points to the graph we use the function <code>addMarkers()</code> which has two parameters, <code>lng</code> and <code>lat</code>. For both parameters we put the column in which the longitude and latitude are, respectively.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat)</code></pre>
<div id="htmlwidget-de611b5b2be53eb04d23" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-de611b5b2be53eb04d23">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>It now adds an icon indicating where every dispensary in our data is. You can zoom in and scroll around to see more about where the dispensaries are. There are only a few dozen locations in the data so the popups overlapping a bit doesn’t affect our map too much. If we had more - such as crime data with millions of offenses - it would make it very hard to read. To change the icons to circles we can change the function <code>addMarkers()</code> to <code>addCircleMarkers()</code>, keeping the rest of the code the same,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
                   <span class="dt">lat =</span> marijuana<span class="op">$</span>lat)</code></pre>
<div id="htmlwidget-d148f1aed66b321387a9" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d148f1aed66b321387a9">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>This makes the icon into circles but they are still large and cover most of the map. To adjust the size of our icons we use the <code>radius</code> parameter in <code>addMarkers()</code> or <code>addCircleMarkers()</code>. The larger the radius, the larger the icons.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
                   <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>)</code></pre>
<div id="htmlwidget-fd4034c3942983783c41" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-fd4034c3942983783c41">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>Setting the <code>radius</code> option to 5 shrinks the size of the icon a lot. In your own maps you’ll have to fiddle with this option to get it to look the way you want. Let’s move on to adding information about each icon when clicked upon.</p>
</div>
<div id="adding-popup-information" class="section level2">
<h2><span class="header-section-number">9.3</span> Adding popup information</h2>
<p>The parameter <code>popup</code> in the <code>addMarkers()</code> or <code>addCircleMarkers()</code> functions lets you input a character value (if not already a character value it will convert it to one) and that will be shown as a popup when you click on the icon. Let’s start simple here by inputting the business owner column in our data and then build it up to a more complicated popup.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>,
                   <span class="dt">popup =</span> marijuana<span class="op">$</span>Business_Owner)</code></pre>
<div id="htmlwidget-46e9304d5fa02f8a3526" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-46e9304d5fa02f8a3526">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,["Terry Muller","Jeremy Goodin","Justin Jarin","Ondyn Herschelle","Ryan Hudson","Ryan Hudson","Cameron Wald","Almir Guimaraes","Ryan Hudson","Michael Breyburg","Caleb Counts","Joseph Pearson","Joseph Pearson","Brendan Hallinan","Khader ElShawa","Clayton Kopp","Wyatt Lin","Heidi Hanley","Abdelkader Chenbod","Tara McKnight","Mikhail Mekk","Martin Higgins","Martin Higgins","Kevin Reed","Victor Nguyen","Tariq Alazraie: Tariq Alazraie","Jesse Henry","gus murad","Brian Mitchell: Brian Mitchell","Stephen Rechif","Martin Olive","Arthur Vugelman: Arthur Vugelman","Robert Watson: Robert Watson"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>Try clicking around and you’ll see that the owner of the dispensary you clicked on appears over the dot. We usually want to have a title indicating what the value in the popup means. We can do this by using the <code>paste()</code> function to combine text explaining the value with the value itself. Let’s add the words “Business Owner:” before the business owner column.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>,
                   <span class="dt">popup =</span> <span class="kw">paste</span>(<span class="st">&quot;Business Owner:&quot;</span>, marijuana<span class="op">$</span>Business_Owner))</code></pre>
<div id="htmlwidget-9609b253de3b8d08a4e9" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-9609b253de3b8d08a4e9">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,["Business Owner: Terry Muller","Business Owner: Jeremy Goodin","Business Owner: Justin Jarin","Business Owner: Ondyn Herschelle","Business Owner: Ryan Hudson","Business Owner: Ryan Hudson","Business Owner: Cameron Wald","Business Owner: Almir Guimaraes","Business Owner: Ryan Hudson","Business Owner: Michael Breyburg","Business Owner: Caleb Counts","Business Owner: Joseph Pearson","Business Owner: Joseph Pearson","Business Owner: Brendan Hallinan","Business Owner: Khader ElShawa","Business Owner: Clayton Kopp","Business Owner: Wyatt Lin","Business Owner: Heidi Hanley","Business Owner: Abdelkader Chenbod","Business Owner: Tara McKnight","Business Owner: Mikhail Mekk","Business Owner: Martin Higgins","Business Owner: Martin Higgins","Business Owner: Kevin Reed","Business Owner: Victor Nguyen","Business Owner: Tariq Alazraie: Tariq Alazraie","Business Owner: Jesse Henry","Business Owner: gus murad","Business Owner: Brian Mitchell: Brian Mitchell","Business Owner: Stephen Rechif","Business Owner: Martin Olive","Business Owner: Arthur Vugelman: Arthur Vugelman","Business Owner: Robert Watson: Robert Watson"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>We don’t have too much information in the data but we let’s add the address and license number to the popup by adding them to the <code>paste()</code> function we’re using.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>,
                   <span class="dt">popup =</span> <span class="kw">paste</span>(<span class="st">&quot;Business Owner:&quot;</span>, marijuana<span class="op">$</span>Business_Owner,
                                 <span class="st">&quot;Address:&quot;</span>, marijuana<span class="op">$</span>Premise_Address,
                                 <span class="st">&quot;License:&quot;</span>, marijuana<span class="op">$</span>License_Number))</code></pre>
<div id="htmlwidget-05ec59be99cbbc70659e" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-05ec59be99cbbc70659e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,["Business Owner: Terry Muller Address: 2165 IRVING ST san francisco, CA 94122 License: C10-0000614-LIC","Business Owner: Jeremy Goodin Address: 122 10TH ST SAN FRANCISCO, CA 941032605 License: C10-0000586-LIC","Business Owner: Justin Jarin Address: 843 Howard ST SAN FRANCISCO, CA 94103 License: C10-0000587-LIC","Business Owner: Ondyn Herschelle Address: 70 SECOND ST SAN FRANCISCO, CA 94105 License: C10-0000539-LIC","Business Owner: Ryan Hudson Address: 527 Howard ST San Francisco, CA 94105 License: C10-0000522-LIC","Business Owner: Ryan Hudson Address: 2414 Lombard ST San Francisco, CA 94123 License: C10-0000523-LIC","Business Owner: Cameron Wald Address: 761 BRYANT ST SAN FRANCISCO, CA 941071014 License: C10-0000527-LIC","Business Owner: Almir Guimaraes Address: 211 12th ST San Francisco, CA 941033717 License: C10-0000512-LIC","Business Owner: Ryan Hudson Address: 2029 MARKET ST SAN FRANCISCO, CA 94114 License: C10-0000515-LIC","Business Owner: Michael Breyburg Address: 1933 MISSION ST SAN FRANCISCO, CA 941033441 License: C10-0000490-LIC","Business Owner: Caleb Counts Address: 5234 MISSION ST SAN FRANCISCO, CA 941123732 License: C10-0000501-LIC","Business Owner: Joseph Pearson Address: 1256 Mission ST San Francisco, CA 94103 License: C10-0000452-LIC","Business Owner: Joseph Pearson Address: 473 Haight ST San Francisco, CA 94117 License: C10-0000453-LIC","Business Owner: Brendan Hallinan Address: 1276 Market ST San Francisco, CA 94102 License: C10-0000427-LIC","Business Owner: Khader ElShawa Address: 2441 MISSION ST SAN FRANCISCO, CA 941102414 License: C10-0000437-LIC","Business Owner: Clayton Kopp Address: 1077 POST ST SAN FRANCISCO, CA 94109 License: C10-0000387-LIC","Business Owner: Wyatt Lin Address: 49 KEARNY ST SAN FRANCISCO, CA 94108 License: C10-0000358-LIC","Business Owner: Heidi Hanley Address: 1284 MISSION ST SAN FRANCISCO, CA 94103 License: C10-0000308-LIC","Business Owner: Abdelkader Chenbod Address: 14 VALENCIA ST SAN FRANCISCO, CA 941031102 License: C10-0000281-LIC","Business Owner: Tara McKnight Address: 212 CALIFORNIA ST SAN FRANCISCO, CA 941114405 License: C10-0000282-LIC","Business Owner: Mikhail Mekk Address: 5258 MISSION ST SAN FRANCISCO, CA 94112 License: C10-0000265-LIC","Business Owner: Martin Higgins Address: 4811 GEARY BLVD SAN FRANCISCO, CA 94118 License: C10-0000202-LIC","Business Owner: Martin Higgins Address: 33 29TH ST SAN FRANCISCO, CA 94110 License: C10-0000205-LIC","Business Owner: Kevin Reed Address: 4218 MISSION ST SAN FRANCISCO, CA 94112 License: C10-0000200-LIC","Business Owner: Victor Nguyen Address: 2442 BAYSHORE BLVD SAN FRANCISCO, CA 94134 License: C10-0000152-LIC","Business Owner: Tariq Alazraie: Tariq Alazraie Address: 1326 Grove ST San Francisco, CA 94117 License: C10-0000158-LIC","Business Owner: Jesse Henry Address: 952 MISSION ST SAN FRANCISCO, CA 941032911 License: C10-0000127-LIC","Business Owner: gus murad Address: 2520 Mission ST San Francisco, CA 94110 License: C10-0000133-LIC","Business Owner: Brian Mitchell: Brian Mitchell Address: 3326 mission ST san francisco, CA 94110 License: C10-0000053-LIC","Business Owner: Stephen Rechif Address: 471 JESSIE ST SAN FRANCISCO, CA 94103 License: C10-0000043-LIC","Business Owner: Martin Olive Address: 79 9TH ST SAN FRANCISCO, CA 941031401 License: C10-0000035-LIC","Business Owner: Arthur Vugelman: Arthur Vugelman Address: 3139 MISSION ST SAN FRANCISCO, CA 94110 License: C10-0000016-LIC","Business Owner: Robert Watson: Robert Watson Address: 2544 3RD ST SAN FRANCISCO, CA 94122 License: C10-0000005-LIC"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>Just adding the location text makes it try to print out everything on one line which is hard to read. If we add the text <code>&lt;br&gt;</code> where we want a line break it will make one. <code>&lt;br&gt;</code> is the HTML tag for line-break which is why it works making a new line in this case.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>,
                   <span class="dt">popup =</span> <span class="kw">paste</span>(<span class="st">&quot;Business Owner:&quot;</span>, marijuana<span class="op">$</span>Business_Owner,
                                 <span class="st">&quot;&lt;br&gt;&quot;</span>,
                                 <span class="st">&quot;Address:&quot;</span>, marijuana<span class="op">$</span>Premise_Address,
                                 <span class="st">&quot;&lt;br&gt;&quot;</span>,
                                 <span class="st">&quot;License:&quot;</span>, marijuana<span class="op">$</span>License_Number))</code></pre>
<div id="htmlwidget-a39f24ea1299450b86b1" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-a39f24ea1299450b86b1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,["Business Owner: Terry Muller <br> Address: 2165 IRVING ST san francisco, CA 94122 <br> License: C10-0000614-LIC","Business Owner: Jeremy Goodin <br> Address: 122 10TH ST SAN FRANCISCO, CA 941032605 <br> License: C10-0000586-LIC","Business Owner: Justin Jarin <br> Address: 843 Howard ST SAN FRANCISCO, CA 94103 <br> License: C10-0000587-LIC","Business Owner: Ondyn Herschelle <br> Address: 70 SECOND ST SAN FRANCISCO, CA 94105 <br> License: C10-0000539-LIC","Business Owner: Ryan Hudson <br> Address: 527 Howard ST San Francisco, CA 94105 <br> License: C10-0000522-LIC","Business Owner: Ryan Hudson <br> Address: 2414 Lombard ST San Francisco, CA 94123 <br> License: C10-0000523-LIC","Business Owner: Cameron Wald <br> Address: 761 BRYANT ST SAN FRANCISCO, CA 941071014 <br> License: C10-0000527-LIC","Business Owner: Almir Guimaraes <br> Address: 211 12th ST San Francisco, CA 941033717 <br> License: C10-0000512-LIC","Business Owner: Ryan Hudson <br> Address: 2029 MARKET ST SAN FRANCISCO, CA 94114 <br> License: C10-0000515-LIC","Business Owner: Michael Breyburg <br> Address: 1933 MISSION ST SAN FRANCISCO, CA 941033441 <br> License: C10-0000490-LIC","Business Owner: Caleb Counts <br> Address: 5234 MISSION ST SAN FRANCISCO, CA 941123732 <br> License: C10-0000501-LIC","Business Owner: Joseph Pearson <br> Address: 1256 Mission ST San Francisco, CA 94103 <br> License: C10-0000452-LIC","Business Owner: Joseph Pearson <br> Address: 473 Haight ST San Francisco, CA 94117 <br> License: C10-0000453-LIC","Business Owner: Brendan Hallinan <br> Address: 1276 Market ST San Francisco, CA 94102 <br> License: C10-0000427-LIC","Business Owner: Khader ElShawa <br> Address: 2441 MISSION ST SAN FRANCISCO, CA 941102414 <br> License: C10-0000437-LIC","Business Owner: Clayton Kopp <br> Address: 1077 POST ST SAN FRANCISCO, CA 94109 <br> License: C10-0000387-LIC","Business Owner: Wyatt Lin <br> Address: 49 KEARNY ST SAN FRANCISCO, CA 94108 <br> License: C10-0000358-LIC","Business Owner: Heidi Hanley <br> Address: 1284 MISSION ST SAN FRANCISCO, CA 94103 <br> License: C10-0000308-LIC","Business Owner: Abdelkader Chenbod <br> Address: 14 VALENCIA ST SAN FRANCISCO, CA 941031102 <br> License: C10-0000281-LIC","Business Owner: Tara McKnight <br> Address: 212 CALIFORNIA ST SAN FRANCISCO, CA 941114405 <br> License: C10-0000282-LIC","Business Owner: Mikhail Mekk <br> Address: 5258 MISSION ST SAN FRANCISCO, CA 94112 <br> License: C10-0000265-LIC","Business Owner: Martin Higgins <br> Address: 4811 GEARY BLVD SAN FRANCISCO, CA 94118 <br> License: C10-0000202-LIC","Business Owner: Martin Higgins <br> Address: 33 29TH ST SAN FRANCISCO, CA 94110 <br> License: C10-0000205-LIC","Business Owner: Kevin Reed <br> Address: 4218 MISSION ST SAN FRANCISCO, CA 94112 <br> License: C10-0000200-LIC","Business Owner: Victor Nguyen <br> Address: 2442 BAYSHORE BLVD SAN FRANCISCO, CA 94134 <br> License: C10-0000152-LIC","Business Owner: Tariq Alazraie: Tariq Alazraie <br> Address: 1326 Grove ST San Francisco, CA 94117 <br> License: C10-0000158-LIC","Business Owner: Jesse Henry <br> Address: 952 MISSION ST SAN FRANCISCO, CA 941032911 <br> License: C10-0000127-LIC","Business Owner: gus murad <br> Address: 2520 Mission ST San Francisco, CA 94110 <br> License: C10-0000133-LIC","Business Owner: Brian Mitchell: Brian Mitchell <br> Address: 3326 mission ST san francisco, CA 94110 <br> License: C10-0000053-LIC","Business Owner: Stephen Rechif <br> Address: 471 JESSIE ST SAN FRANCISCO, CA 94103 <br> License: C10-0000043-LIC","Business Owner: Martin Olive <br> Address: 79 9TH ST SAN FRANCISCO, CA 941031401 <br> License: C10-0000035-LIC","Business Owner: Arthur Vugelman: Arthur Vugelman <br> Address: 3139 MISSION ST SAN FRANCISCO, CA 94110 <br> License: C10-0000016-LIC","Business Owner: Robert Watson: Robert Watson <br> Address: 2544 3RD ST SAN FRANCISCO, CA 94122 <br> License: C10-0000005-LIC"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="dealing-with-too-many-markers" class="section level2">
<h2><span class="header-section-number">9.4</span> Dealing with too many markers</h2>
<p>In our case with only 33 rows of data, turning the markers to circles solves our visibility issue. In cases with many more rows of data, this doesn’t always work. The other solution is to cluster the data into groups where the dots only show if you zoom down.</p>
<p>If we add the code <code>clusterOptions = markerClusterOptions()</code> to our <code>addCircleMarkers()</code> it will cluster for us.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> marijuana<span class="op">$</span>lon, 
             <span class="dt">lat =</span> marijuana<span class="op">$</span>lat,
                   <span class="dt">radius =</span> <span class="dv">5</span>,
                   <span class="dt">popup =</span> <span class="kw">paste</span>(<span class="st">&quot;Business Owner:&quot;</span>, marijuana<span class="op">$</span>Business_Owner,
                                 <span class="st">&quot;&lt;br&gt;&quot;</span>,
                                 <span class="st">&quot;Address:&quot;</span>, marijuana<span class="op">$</span>Premise_Address,
                                 <span class="st">&quot;&lt;br&gt;&quot;</span>,
                                 <span class="st">&quot;License:&quot;</span>, marijuana<span class="op">$</span>License_Number),
                   <span class="dt">clusterOptions =</span> <span class="kw">markerClusterOptions</span>())</code></pre>
<div id="htmlwidget-9d986130b008431462d7" style="width:90%;height:415.296px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-9d986130b008431462d7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">\n                OpenStreetMap<\/a> contributors"}]},{"method":"addCircleMarkers","args":[[37.763368513994,37.7749608909055,37.7824456322351,37.7883655156675,37.7879786211266,37.7991993439031,37.776723025795,37.7716441737549,37.7683642435144,37.7661342361937,37.7149433225515,37.7768233749783,37.7721656633102,37.7779165026544,37.7579164818224,37.7868596560969,37.7885928301402,37.7764332217669,37.7723969821552,37.7933583439031,37.7150078334871,37.780630513994,37.7439846089216,37.7296109572681,37.7106912181603,37.7758773583299,37.7818572767325,37.756626757978,37.7434740591205,37.7820036361302,37.7765260973827,37.7470720901957,37.7573373388828],[-122.481130636274,-122.415558808789,-122.403690577558,-122.400299094379,-122.396710580876,-122.441332845548,-122.401600870362,-122.416630208985,-122.427647255684,-122.419734009839,-122.442329761989,-122.414038364158,-122.429907545098,-122.415859554417,-122.418945411016,-122.419454935744,-122.403642363466,-122.41451924661,-122.422663566606,-122.399141820013,-122.442249162935,-122.471140300998,-122.421625124618,-122.430460425904,-122.404194082723,-122.438473648075,-122.407646582867,-122.418903381384,-122.421339303364,-122.408380614202,-122.414985660825,-122.418860565064,-122.388386289774],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,["Business Owner: Terry Muller <br> Address: 2165 IRVING ST san francisco, CA 94122 <br> License: C10-0000614-LIC","Business Owner: Jeremy Goodin <br> Address: 122 10TH ST SAN FRANCISCO, CA 941032605 <br> License: C10-0000586-LIC","Business Owner: Justin Jarin <br> Address: 843 Howard ST SAN FRANCISCO, CA 94103 <br> License: C10-0000587-LIC","Business Owner: Ondyn Herschelle <br> Address: 70 SECOND ST SAN FRANCISCO, CA 94105 <br> License: C10-0000539-LIC","Business Owner: Ryan Hudson <br> Address: 527 Howard ST San Francisco, CA 94105 <br> License: C10-0000522-LIC","Business Owner: Ryan Hudson <br> Address: 2414 Lombard ST San Francisco, CA 94123 <br> License: C10-0000523-LIC","Business Owner: Cameron Wald <br> Address: 761 BRYANT ST SAN FRANCISCO, CA 941071014 <br> License: C10-0000527-LIC","Business Owner: Almir Guimaraes <br> Address: 211 12th ST San Francisco, CA 941033717 <br> License: C10-0000512-LIC","Business Owner: Ryan Hudson <br> Address: 2029 MARKET ST SAN FRANCISCO, CA 94114 <br> License: C10-0000515-LIC","Business Owner: Michael Breyburg <br> Address: 1933 MISSION ST SAN FRANCISCO, CA 941033441 <br> License: C10-0000490-LIC","Business Owner: Caleb Counts <br> Address: 5234 MISSION ST SAN FRANCISCO, CA 941123732 <br> License: C10-0000501-LIC","Business Owner: Joseph Pearson <br> Address: 1256 Mission ST San Francisco, CA 94103 <br> License: C10-0000452-LIC","Business Owner: Joseph Pearson <br> Address: 473 Haight ST San Francisco, CA 94117 <br> License: C10-0000453-LIC","Business Owner: Brendan Hallinan <br> Address: 1276 Market ST San Francisco, CA 94102 <br> License: C10-0000427-LIC","Business Owner: Khader ElShawa <br> Address: 2441 MISSION ST SAN FRANCISCO, CA 941102414 <br> License: C10-0000437-LIC","Business Owner: Clayton Kopp <br> Address: 1077 POST ST SAN FRANCISCO, CA 94109 <br> License: C10-0000387-LIC","Business Owner: Wyatt Lin <br> Address: 49 KEARNY ST SAN FRANCISCO, CA 94108 <br> License: C10-0000358-LIC","Business Owner: Heidi Hanley <br> Address: 1284 MISSION ST SAN FRANCISCO, CA 94103 <br> License: C10-0000308-LIC","Business Owner: Abdelkader Chenbod <br> Address: 14 VALENCIA ST SAN FRANCISCO, CA 941031102 <br> License: C10-0000281-LIC","Business Owner: Tara McKnight <br> Address: 212 CALIFORNIA ST SAN FRANCISCO, CA 941114405 <br> License: C10-0000282-LIC","Business Owner: Mikhail Mekk <br> Address: 5258 MISSION ST SAN FRANCISCO, CA 94112 <br> License: C10-0000265-LIC","Business Owner: Martin Higgins <br> Address: 4811 GEARY BLVD SAN FRANCISCO, CA 94118 <br> License: C10-0000202-LIC","Business Owner: Martin Higgins <br> Address: 33 29TH ST SAN FRANCISCO, CA 94110 <br> License: C10-0000205-LIC","Business Owner: Kevin Reed <br> Address: 4218 MISSION ST SAN FRANCISCO, CA 94112 <br> License: C10-0000200-LIC","Business Owner: Victor Nguyen <br> Address: 2442 BAYSHORE BLVD SAN FRANCISCO, CA 94134 <br> License: C10-0000152-LIC","Business Owner: Tariq Alazraie: Tariq Alazraie <br> Address: 1326 Grove ST San Francisco, CA 94117 <br> License: C10-0000158-LIC","Business Owner: Jesse Henry <br> Address: 952 MISSION ST SAN FRANCISCO, CA 941032911 <br> License: C10-0000127-LIC","Business Owner: gus murad <br> Address: 2520 Mission ST San Francisco, CA 94110 <br> License: C10-0000133-LIC","Business Owner: Brian Mitchell: Brian Mitchell <br> Address: 3326 mission ST san francisco, CA 94110 <br> License: C10-0000053-LIC","Business Owner: Stephen Rechif <br> Address: 471 JESSIE ST SAN FRANCISCO, CA 94103 <br> License: C10-0000043-LIC","Business Owner: Martin Olive <br> Address: 79 9TH ST SAN FRANCISCO, CA 941031401 <br> License: C10-0000035-LIC","Business Owner: Arthur Vugelman: Arthur Vugelman <br> Address: 3139 MISSION ST SAN FRANCISCO, CA 94110 <br> License: C10-0000016-LIC","Business Owner: Robert Watson: Robert Watson <br> Address: 2544 3RD ST SAN FRANCISCO, CA 94122 <br> License: C10-0000005-LIC"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[37.7106912181603,37.7991993439031],"lng":[-122.481130636274,-122.388386289774]}},"evals":[],"jsHooks":[]}</script>
<p>Locations close to each other are grouped together in fairly arbitrary groupings and we can see how large each grouping is by moving our cursor over the circle. Click on a circle or zoom in and and it will show smaller groupings at lower levels of aggregation. Keep clicking or zooming in and it will eventually show each location as its own circle.</p>
<p>This method is very useful for dealing with huge amounts of data as it avoids overflowing the map with too many icons at one time. A downside, however, is that the clusters are created arbitrarily meaning that important context, such as neighborhood, can be lost.</p>
</div>
<div id="interactive-choropleth-maps" class="section level2">
<h2><span class="header-section-number">9.5</span> Interactive choropleth maps</h2>
<p>In Chapter <a href="choropleth-maps.html#choropleth-maps">8</a> we worked on choropleth maps which are maps with shaded regions, such as states colored by which political party won them in an election. Here we will make interactive choropleth maps where you can click on a shaded region and see information about that region. We’ll make the same map as before - Census tracts with the number of officer-involved shootings.</p>
<p>Let’s load the tract-level officer-involved shooting data we made earlier.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/philly_tracts_shootings.rda&quot;</span>)
<span class="co">#&gt; Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed</span>
<span class="co">#&gt; file &#39;data/philly_tracts_shootings.rda&#39;, probable reason &#39;No such file or</span>
<span class="co">#&gt; directory&#39;</span>
<span class="co">#&gt; Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</span></code></pre>
<p>We’ll begin the <code>leaflet</code> map similar to before but use the function <code>addPolygons()</code> and our input here is the geometry column of <em>philly_tracts_shootings</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry)
<span class="co">#&gt; Error in derivePolygons(data, lng, lat, missing(lng), missing(lat), &quot;addPolygons&quot;): object &#39;philly_tracts_shootings&#39; not found</span></code></pre>
<p>It gives us a blank map because our polygons are projected to Philly’s projection while the <code>leaflet</code> map expects the standard CRS, WGS84 which uses longitude and latitude. So we need to change our projection to that using the <code>st_transform()</code> function from the <code>sf</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="co">#&gt; Linking to GEOS 3.6.1, GDAL 2.2.3, PROJ 4.9.3</span>
philly_tracts_shootings &lt;-<span class="st"> </span><span class="kw">st_transform</span>(philly_tracts_shootings,
                                        <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)
<span class="co">#&gt; Error in st_transform(philly_tracts_shootings, crs = &quot;+proj=longlat +datum=WGS84&quot;): object &#39;philly_tracts_shootings&#39; not found</span></code></pre>
<p>Now let’s try again.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry)
<span class="co">#&gt; Error in derivePolygons(data, lng, lat, missing(lng), missing(lat), &quot;addPolygons&quot;): object &#39;philly_tracts_shootings&#39; not found</span></code></pre>
<p>It made a map with large blue lines indicating each tract. Let’s change the appearance of the graph a bit before making a popup or shading the tracts. The parameter <code>color</code> in <code>addPolygons()</code> changes the color of the lines - let’s change it to black. The lines are also very large, blurring into each other and making the tracts hard to see. We can change the <code>weight</code> parameter to alter the size of these lines - smaller values are smaller lines. Let’s try setting this to 1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>)
<span class="co">#&gt; Error in derivePolygons(data, lng, lat, missing(lng), missing(lat), &quot;addPolygons&quot;): object &#39;philly_tracts_shootings&#39; not found</span></code></pre>
<p>That looks better and we can clearly distinguish each tract now.</p>
<p>As we did earlier, we can add the popup text directly to the function which makes the geographic shapes, in this case <code>addPolygons()</code>. Let’s add the GEOID10 column value - the unique ID code for that tract - and the number of shootings that occurred in that tract. As before when we click on a tract a popup appears with the output we specified.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">popup =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tract ID: &quot;</span>, philly_tracts_shootings<span class="op">$</span>GEOID10,
                             <span class="st">&quot;&lt;br&gt;&quot;</span>,
                             <span class="st">&quot;Number of Shootings: &quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings))
<span class="co">#&gt; Error in derivePolygons(data, lng, lat, missing(lng), missing(lat), &quot;addPolygons&quot;): object &#39;philly_tracts_shootings&#39; not found</span></code></pre>
<p>For these types of maps we generally want to shade each polygon to indicate how frequently the event occured in the polygon. For this process we will make a simple function which will automatically shade the tracts by the value in the column we want it shaded by - <em>number_shootings</em>.</p>
<p>We’ll use the function <code>colorNumeric()</code> which takes a lot of the work out of the process of coloring in the map. This function takes two inputs, first a color palette which we can get from the site <a href="http://colorbrewer2.org/#type=sequential&amp;scheme=OrRd&amp;n=3">colorbrewer2</a>. Let’s use the fourth bar in the Sequential page, which is light orange to red. If you look in the section with each HEX value it says that the palette is “3-class OrRd”. The “3-class” just means we selected 3 colors, the “OrRd” is the part we want. That will tell <code>colorNumeric()</code> to make the palette using these colors. The second parameter is the column for our numeric variable, <em>number_shootings</em>.</p>
<p>We will save the output of <code>colorNumeric("OrRd", philly_tracts_shootings$number_shootings)</code> as a new variable which we’ll call <em>pal</em> for convenience. Then inside of <code>addPolygons()</code> we’ll set the parameter <code>fillColor</code> to <code>pal(philly_tracts_shootings$number_shootings)</code>, running this function on the column. What this really does is determine which color every tract should be based on the value in the <em>number_shootings</em> column.</p>
<pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw">colorNumeric</span>(<span class="st">&quot;OrRd&quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt; Error in colorNumeric(&quot;OrRd&quot;, philly_tracts_shootings$number_shootings): object &#39;philly_tracts_shootings&#39; not found</span>
<span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">popup =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tract ID: &quot;</span>, philly_tracts_shootings<span class="op">$</span>GEOID10,
                             <span class="st">&quot;&lt;br&gt;&quot;</span>,
                             <span class="st">&quot;Number of Shootings: &quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillColor =</span> <span class="kw">pal</span>(philly_tracts_shootings<span class="op">$</span>number_shootings))
<span class="co">#&gt; Error in pal(philly_tracts_shootings$number_shootings): could not find function &quot;pal&quot;</span></code></pre>
<p>Since the tracts are transparent, it is hard to distinguish which color is shown. We can make each tract a solid color by setting the parameter <code>fillOpacity</code> inside of <code>addPolygons()</code> to 1.</p>
<pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw">colorNumeric</span>(<span class="st">&quot;OrRd&quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt; Error in colorNumeric(&quot;OrRd&quot;, philly_tracts_shootings$number_shootings): object &#39;philly_tracts_shootings&#39; not found</span>
<span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">popup =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tract ID: &quot;</span>, philly_tracts_shootings<span class="op">$</span>GEOID10,
                             <span class="st">&quot;&lt;br&gt;&quot;</span>,
                             <span class="st">&quot;Number of Shootings: &quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillColor =</span> <span class="kw">pal</span>(philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillOpacity =</span> <span class="dv">1</span>)
<span class="co">#&gt; Error in pal(philly_tracts_shootings$number_shootings): could not find function &quot;pal&quot;</span></code></pre>
<p>To add a legend to this we use the function <code>addLegend()</code> which takes three parameters. <code>pal</code> asks which color palette we are using - we want it to be the exact same as we use to color the tracts so we’ll use the <em>pal</em> object we made. The <code>values</code> parameter is used for which column our numeric values are from, in our case the <em>number_shootings</em> column so we’ll input that. Finally <code>opacity</code> determines how transparent the legend will be. As each tract is set to not be transparent at all, we’ll also set this to 1.</p>
<pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw">colorNumeric</span>(<span class="st">&quot;OrRd&quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt; Error in colorNumeric(&quot;OrRd&quot;, philly_tracts_shootings$number_shootings): object &#39;philly_tracts_shootings&#39; not found</span>
<span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">popup =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tract ID: &quot;</span>, philly_tracts_shootings<span class="op">$</span>GEOID10,
                             <span class="st">&quot;&lt;br&gt;&quot;</span>,
                             <span class="st">&quot;Number of Shootings: &quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillColor =</span> <span class="kw">pal</span>(philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillOpacity =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addLegend</span>(<span class="dt">pal =</span> pal, 
            <span class="dt">values =</span> philly_tracts_shootings<span class="op">$</span>number_shootings,
            <span class="dt">opacity =</span> <span class="dv">1</span>)
<span class="co">#&gt; Error in pal(philly_tracts_shootings$number_shootings): could not find function &quot;pal&quot;</span></code></pre>
<p>Finally, we can add a title to the legend using the <code>title</code> parameter inside of <code>addLegend()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw">colorNumeric</span>(<span class="st">&quot;OrRd&quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings)
<span class="co">#&gt; Error in colorNumeric(&quot;OrRd&quot;, philly_tracts_shootings$number_shootings): object &#39;philly_tracts_shootings&#39; not found</span>
<span class="kw">leaflet</span>()  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">addTiles</span>(<span class="st">&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>, 
           <span class="dt">attribution =</span> <span class="st">&#39;&amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;</span>
<span class="st">                OpenStreetMap&lt;/a&gt; contributors&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> philly_tracts_shootings<span class="op">$</span>geometry,
              <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">popup =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tract ID: &quot;</span>, philly_tracts_shootings<span class="op">$</span>GEOID10,
                             <span class="st">&quot;&lt;br&gt;&quot;</span>,
                             <span class="st">&quot;Number of Shootings: &quot;</span>, philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillColor =</span> <span class="kw">pal</span>(philly_tracts_shootings<span class="op">$</span>number_shootings),
              <span class="dt">fillOpacity =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">addLegend</span>(<span class="dt">pal =</span> pal, 
            <span class="dt">values =</span> philly_tracts_shootings<span class="op">$</span>number_shootings,
            <span class="dt">opacity =</span> <span class="dv">1</span>,
            <span class="dt">title =</span> <span class="st">&quot;Police Shootings&quot;</span>)
<span class="co">#&gt; Error in pal(philly_tracts_shootings$number_shootings): could not find function &quot;pal&quot;</span></code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="choropleth-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-markdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jacobkap/crimebythenumbers/edit/master/interactive-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
