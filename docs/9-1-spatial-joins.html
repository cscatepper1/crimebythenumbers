<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9.1 Spatial joins | Crime by the Numbers" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://crimebythenumbers.com" />
<meta property="og:image" content="https://crimebythenumbers.comimages/cover.png" />
<meta property="og:description" content="This book introduces the programming language R and is meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets." />
<meta name="github-repo" content="jacobkap/crimebythenumbers" />

<meta name="author" content="Jacob Kaplan" />

<meta name="date" content="2020-07-20" />


<meta name="description" content="This book introduces the programming language R and is meant for undergrads or graduate students studying criminology. R is a programming language that is well-suited to the type of work frequently done in criminology - taking messy data and turning it into useful information. While R is a useful tool for many fields of study, this book focuses on the skills criminologists should know and uses crime data for the example data sets.">

<title>9.1 Spatial joins | Crime by the Numbers</title>

<script src="libs/header-attrs-2.3.2/header-attrs.js"></script>
<script src="libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#welcome">Welcome</a>
<ul>
<li><a href="why-learn-to-program.html#why-learn-to-program">Why learn to program?</a>
<ul>
<li><a href="why-learn-to-program.html#scale">Scale</a></li>
<li><a href="why-learn-to-program.html#reproducibility">Reproducibility</a></li>
</ul></li>
<li><a href="what-you-will-learn.html#what-you-will-learn">What you will learn</a>
<ul>
<li><a href="what-you-will-learn.html#skills">Skills</a></li>
<li><a href="what-you-will-learn.html#data">Data</a></li>
</ul></li>
<li><a href="what-you-wont-learn.html#what-you-wont-learn">What you won’t learn</a></li>
<li><a href="simple-vs-easy.html#simple-vs-easy">Simple vs Easy</a></li>
<li><a href="how-to-contribute.html#how-to-contribute">How to Contribute</a></li>
</ul></li>
<li><a href="about-the-author.html#about-the-author">About the author</a></li>
<li><a href="1-introduction-to-r-and-rstudio.html#introduction-to-r-and-rstudio"><span class="toc-section-number">1</span> Introduction to R and RStudio</a>
<ul>
<li><a href="1-1-using-rstudio.html#using-rstudio"><span class="toc-section-number">1.1</span> Using RStudio</a>
<ul>
<li><a href="1-1-using-rstudio.html#opening-an-r-script"><span class="toc-section-number">1.1.1</span> Opening an R Script</a></li>
<li><a href="1-1-using-rstudio.html#setting-the-working-directory"><span class="toc-section-number">1.1.2</span> Setting the working directory</a></li>
<li><a href="1-1-using-rstudio.html#changing-rstudio"><span class="toc-section-number">1.1.3</span> Changing RStudio</a></li>
<li><a href="1-1-using-rstudio.html#helpful-cheatsheets"><span class="toc-section-number">1.1.4</span> Helpful cheatsheets</a></li>
</ul></li>
<li><a href="1-2-reading-data-into-r.html#reading-data-into-r"><span class="toc-section-number">1.2</span> Reading data into R</a>
<ul>
<li><a href="1-2-reading-data-into-r.html#loading-data"><span class="toc-section-number">1.2.1</span> Loading data</a></li>
</ul></li>
<li><a href="1-3-first-steps-to-exploring-data.html#first-steps-to-exploring-data"><span class="toc-section-number">1.3</span> First steps to exploring data</a></li>
<li><a href="1-4-finding-help-about-functions.html#finding-help-about-functions"><span class="toc-section-number">1.4</span> Finding help about functions</a></li>
</ul></li>
<li class="part"><span><b>I Clean</b></span></li>
<li><a href="2-subsetting-intro.html#subsetting-intro"><span class="toc-section-number">2</span> Subsetting: Making big things small</a>
<ul>
<li><a href="2-1-select-specific-values.html#select-specific-values"><span class="toc-section-number">2.1</span> Select specific values</a></li>
<li><a href="2-2-assignment.html#assignment"><span class="toc-section-number">2.2</span> Assigning values to objects (Making “things”)</a></li>
<li><a href="2-3-vectors.html#vectors"><span class="toc-section-number">2.3</span> Vectors (collections of “things”)</a></li>
<li><a href="2-4-logical-values-and-operations.html#logical-values-and-operations"><span class="toc-section-number">2.4</span> Logical values and operations</a>
<ul>
<li><a href="2-4-logical-values-and-operations.html#matching-a-single-value"><span class="toc-section-number">2.4.1</span> Matching a single value</a></li>
<li><a href="2-4-logical-values-and-operations.html#matching-multiple-values"><span class="toc-section-number">2.4.2</span> Matching multiple values</a></li>
<li><a href="2-4-logical-values-and-operations.html#does-not-match"><span class="toc-section-number">2.4.3</span> Does not match</a></li>
<li><a href="2-4-logical-values-and-operations.html#greater-than-or-less-than"><span class="toc-section-number">2.4.4</span> Greater than or less than</a></li>
<li><a href="2-4-logical-values-and-operations.html#combining-conditional-statements---or-and"><span class="toc-section-number">2.4.5</span> Combining conditional statements - or, and</a></li>
</ul></li>
<li><a href="2-5-subsetting-a-data-frame.html#subsetting-a-data.frame"><span class="toc-section-number">2.5</span> Subsetting a data.frame</a>
<ul>
<li><a href="2-5-subsetting-a-data-frame.html#select-specific-columns"><span class="toc-section-number">2.5.1</span> Select specific columns</a></li>
<li><a href="2-5-subsetting-a-data-frame.html#select-specific-rows"><span class="toc-section-number">2.5.2</span> Select specific rows</a></li>
<li><a href="2-5-subsetting-a-data-frame.html#subset-colorado-data"><span class="toc-section-number">2.5.3</span> Subset Colorado data</a></li>
</ul></li>
</ul></li>
<li><a href="3-explore.html#explore"><span class="toc-section-number">3</span> Exploratory data analysis</a>
<ul>
<li><a href="3-1-summary-and-table.html#summary-and-table"><span class="toc-section-number">3.1</span> Summary and Table</a></li>
<li><a href="3-2-graphing.html#graphing"><span class="toc-section-number">3.2</span> Graphing</a></li>
<li><a href="3-3-aggregate.html#aggregate"><span class="toc-section-number">3.3</span> Aggregating (summaries of groups)</a></li>
</ul></li>
<li><a href="4-regular-expressions.html#regular-expressions"><span class="toc-section-number">4</span> Regular Expressions</a>
<ul>
<li><a href="4-1-finding-patterns-in-text-with-grep.html#finding-patterns-in-text-with-grep"><span class="toc-section-number">4.1</span> Finding patterns in text with <code>grep()</code></a></li>
<li><a href="4-2-finding-and-replacing-patterns-in-text-with-gsub.html#finding-and-replacing-patterns-in-text-with-gsub"><span class="toc-section-number">4.2</span> Finding and replacing patterns in text with <code>gsub()</code></a></li>
<li><a href="4-3-useful-special-characters.html#useful-special-characters"><span class="toc-section-number">4.3</span> Useful special characters</a>
<ul>
<li><a href="4-3-useful-special-characters.html#multiple-characters"><span class="toc-section-number">4.3.1</span> Multiple characters <code>[]</code></a></li>
<li><a href="4-3-useful-special-characters.html#n-many-of-previous-character-n"><span class="toc-section-number">4.3.2</span> n-many of previous character <code>{n}</code></a></li>
<li><a href="4-3-useful-special-characters.html#n-many-to-m-many-of-previous-character-nm"><span class="toc-section-number">4.3.3</span> n-many to m-many of previous character <code>{n,m}</code></a></li>
<li><a href="4-3-useful-special-characters.html#start-of-string"><span class="toc-section-number">4.3.4</span> Start of string</a></li>
<li><a href="4-3-useful-special-characters.html#end-of-string"><span class="toc-section-number">4.3.5</span> End of string <code>$</code></a></li>
<li><a href="4-3-useful-special-characters.html#anything-."><span class="toc-section-number">4.3.6</span> Anything <code>.</code></a></li>
<li><a href="4-3-useful-special-characters.html#one-or-more-of-previous"><span class="toc-section-number">4.3.7</span> One or more of previous <code>+</code></a></li>
<li><a href="4-3-useful-special-characters.html#zero-or-more-of-previous"><span class="toc-section-number">4.3.8</span> Zero or more of previous <code>*</code></a></li>
<li><a href="4-3-useful-special-characters.html#multiple-patterns"><span class="toc-section-number">4.3.9</span> Multiple patterns <code>|</code></a></li>
<li><a href="4-3-useful-special-characters.html#parentheses"><span class="toc-section-number">4.3.10</span> Parentheses <code>()</code></a></li>
<li><a href="4-3-useful-special-characters.html#optional-text"><span class="toc-section-number">4.3.11</span> Optional text <code>?</code></a></li>
</ul></li>
<li><a href="4-4-changing-capitalization.html#changing-capitalization"><span class="toc-section-number">4.4</span> Changing capitalization</a></li>
</ul></li>
<li><a href="5-reading-and-writing-data.html#reading-and-writing-data"><span class="toc-section-number">5</span> Reading and Writing Data</a>
<ul>
<li><a href="1-2-reading-data-into-r.html#reading-data-into-r"><span class="toc-section-number">5.1</span> Reading Data into R</a>
<ul>
<li><a href="5-1-reading-data-into-r.html#r"><span class="toc-section-number">5.1.1</span> R</a></li>
<li><a href="5-1-reading-data-into-r.html#excel"><span class="toc-section-number">5.1.2</span> Excel</a></li>
<li><a href="5-1-reading-data-into-r.html#stata"><span class="toc-section-number">5.1.3</span> Stata</a></li>
<li><a href="5-1-reading-data-into-r.html#sas"><span class="toc-section-number">5.1.4</span> SAS</a></li>
<li><a href="5-1-reading-data-into-r.html#spss"><span class="toc-section-number">5.1.5</span> SPSS</a></li>
</ul></li>
<li><a href="5-2-writing-data.html#writing-data"><span class="toc-section-number">5.2</span> Writing Data</a>
<ul>
<li><a href="5-2-writing-data.html#r-1"><span class="toc-section-number">5.2.1</span> R</a></li>
<li><a href="5-2-writing-data.html#excel-1"><span class="toc-section-number">5.2.2</span> Excel</a></li>
<li><a href="5-2-writing-data.html#stata-1"><span class="toc-section-number">5.2.3</span> Stata</a></li>
<li><a href="5-2-writing-data.html#sas-1"><span class="toc-section-number">5.2.4</span> SAS</a></li>
<li><a href="5-2-writing-data.html#spss-1"><span class="toc-section-number">5.2.5</span> SPSS</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Visualize</b></span></li>
<li><a href="6-graphing-intro.html#graphing-intro"><span class="toc-section-number">6</span> Graphing with <code>ggplot2</code></a>
<ul>
<li><a href="6-1-what-does-the-data-look-like.html#what-does-the-data-look-like"><span class="toc-section-number">6.1</span> What does the data look like?</a></li>
<li><a href="6-2-graphing-data.html#graphing-data"><span class="toc-section-number">6.2</span> Graphing data</a></li>
<li><a href="6-3-time-series-plots.html#time-series-plots"><span class="toc-section-number">6.3</span> Time-Series Plots</a></li>
<li><a href="6-4-scatter-plots.html#scatter-plots"><span class="toc-section-number">6.4</span> Scatter Plots</a></li>
<li><a href="6-5-color-blindness.html#color-blindness"><span class="toc-section-number">6.5</span> Color blindness</a></li>
</ul></li>
<li><a href="7-ois-graphs.html#ois_graphs"><span class="toc-section-number">7</span> More graphing with <code>ggplot2</code></a>
<ul>
<li><a href="7-1-exploring-data.html#exploring-data"><span class="toc-section-number">7.1</span> Exploring Data</a></li>
<li><a href="7-2-graphing-a-single-numeric-variable.html#graphing-a-single-numeric-variable"><span class="toc-section-number">7.2</span> Graphing a Single Numeric Variable</a>
<ul>
<li><a href="7-2-graphing-a-single-numeric-variable.html#histogram"><span class="toc-section-number">7.2.1</span> Histogram</a></li>
<li><a href="7-2-graphing-a-single-numeric-variable.html#density-plot"><span class="toc-section-number">7.2.2</span> Density plot</a></li>
<li><a href="7-2-graphing-a-single-numeric-variable.html#count-graph"><span class="toc-section-number">7.2.3</span> Count Graph</a></li>
</ul></li>
<li><a href="7-3-bar-graph.html#bar-graph"><span class="toc-section-number">7.3</span> Bar graph</a></li>
<li><a href="7-4-graphing-data-over-time.html#graphing-data-over-time"><span class="toc-section-number">7.4</span> Graphing Data Over Time</a></li>
<li><a href="7-5-pretty-graphs.html#pretty-graphs"><span class="toc-section-number">7.5</span> Pretty Graphs</a>
<ul>
<li><a href="7-5-pretty-graphs.html#themes"><span class="toc-section-number">7.5.1</span> Themes</a></li>
</ul></li>
</ul></li>
<li><a href="8-hotspot-maps.html#hotspot-maps"><span class="toc-section-number">8</span> Hotspot maps</a>
<ul>
<li><a href="8-1-a-simple-map.html#a-simple-map"><span class="toc-section-number">8.1</span> A simple map</a></li>
<li><a href="8-2-what-really-are-maps.html#what-really-are-maps"><span class="toc-section-number">8.2</span> What really are maps?</a></li>
<li><a href="8-3-making-a-hotspot-map.html#making-a-hotspot-map"><span class="toc-section-number">8.3</span> Making a hotspot map</a>
<ul>
<li><a href="8-3-making-a-hotspot-map.html#colors"><span class="toc-section-number">8.3.1</span> Colors</a></li>
</ul></li>
</ul></li>
<li><a href="9-choropleth-maps.html#choropleth-maps"><span class="toc-section-number">9</span> Choropleth maps</a>
<ul>
<li><a href="9-1-spatial-joins.html#spatial-joins"><span class="toc-section-number">9.1</span> Spatial joins</a></li>
<li><a href="9-2-making-choropleth-maps.html#making-choropleth-maps"><span class="toc-section-number">9.2</span> Making choropleth maps</a></li>
</ul></li>
<li><a href="10-interactive-maps.html#interactive-maps"><span class="toc-section-number">10</span> Interactive maps</a>
<ul>
<li><a href="10-1-why-do-interactive-graphs-matter.html#why-do-interactive-graphs-matter"><span class="toc-section-number">10.1</span> Why do interactive graphs matter?</a>
<ul>
<li><a href="10-1-why-do-interactive-graphs-matter.html#understanding-your-data"><span class="toc-section-number">10.1.1</span> Understanding your data</a></li>
<li><a href="10-1-why-do-interactive-graphs-matter.html#police-departments-use-them"><span class="toc-section-number">10.1.2</span> Police departments use them</a></li>
</ul></li>
<li><a href="10-2-making-the-interactive-map.html#making-the-interactive-map"><span class="toc-section-number">10.2</span> Making the interactive map</a></li>
<li><a href="10-3-adding-popup-information.html#adding-popup-information"><span class="toc-section-number">10.3</span> Adding popup information</a></li>
<li><a href="10-4-dealing-with-too-many-markers.html#dealing-with-too-many-markers"><span class="toc-section-number">10.4</span> Dealing with too many markers</a></li>
<li><a href="10-5-interactive-choropleth-maps.html#interactive-choropleth-maps"><span class="toc-section-number">10.5</span> Interactive choropleth maps</a></li>
</ul></li>
<li><a href="11-r-markdown.html#r-markdown"><span class="toc-section-number">11</span> R Markdown</a>
<ul>
<li><a href="1-1-using-rstudio.html#code"><span class="toc-section-number">11.1</span> Code</a>
<ul>
<li><a href="11-1-code.html#hiding-code-in-the-output"><span class="toc-section-number">11.1.1</span> Hiding code in the output</a></li>
</ul></li>
<li><a href="11-2-inline-code.html#inline-code"><span class="toc-section-number">11.2</span> Inline Code</a></li>
<li><a href="11-3-tables.html#tables"><span class="toc-section-number">11.3</span> Tables</a></li>
<li><a href="11-4-footnotes.html#footnotes"><span class="toc-section-number">11.4</span> Footnotes</a></li>
<li><a href="11-5-citation.html#citation"><span class="toc-section-number">11.5</span> Citation</a></li>
<li><a href="11-6-spell-check.html#spell-check"><span class="toc-section-number">11.6</span> Spell check</a></li>
<li><a href="11-7-making-the-output-file.html#making-the-output-file"><span class="toc-section-number">11.7</span> Making the output file</a></li>
</ul></li>
<li><a href="12-git.html#git"><span class="toc-section-number">12</span> Git</a>
<ul>
<li><a href="12-1-what-is-git-and-why-do-i-need-it.html#what-is-git-and-why-do-i-need-it"><span class="toc-section-number">12.1</span> What is Git and why do I need it?</a></li>
<li><a href="12-2-git-basics.html#git-basics"><span class="toc-section-number">12.2</span> Git basics</a></li>
<li><a href="12-3-when-to-commit.html#when-to-commit"><span class="toc-section-number">12.3</span> When to commit</a></li>
<li><a href="12-4-code-review.html#code-review"><span class="toc-section-number">12.4</span> Code review</a></li>
</ul></li>
<li class="part"><span><b>III Collect</b></span></li>
<li><a href="13-webscraping-with-rvest.html#webscraping-with-rvest"><span class="toc-section-number">13</span> Webscraping with <code>rvest</code></a>
<ul>
<li><a href="13-1-scraping-one-page.html#scraping-one-page"><span class="toc-section-number">13.1</span> Scraping one page</a></li>
<li><a href="13-2-cleaning-the-webscraped-data.html#cleaning-the-webscraped-data"><span class="toc-section-number">13.2</span> Cleaning the webscraped data</a></li>
</ul></li>
<li><a href="14-functions.html#functions"><span class="toc-section-number">14</span> Functions</a>
<ul>
<li><a href="14-1-a-simple-function.html#a-simple-function"><span class="toc-section-number">14.1</span> A simple function</a></li>
<li><a href="14-2-adding-parameters.html#adding-parameters"><span class="toc-section-number">14.2</span> Adding parameters</a></li>
<li><a href="14-3-recipes-function.html#recipes-function"><span class="toc-section-number">14.3</span> Making a function to scrape recipes</a></li>
</ul></li>
<li><a href="15-for-loops.html#for-loops"><span class="toc-section-number">15</span> For loops</a>
<ul>
<li><a href="15-1-basic-for-loops.html#basic-for-loops"><span class="toc-section-number">15.1</span> Basic for loops</a></li>
<li><a href="15-2-scraping-multiple-recipes.html#scraping-multiple-recipes"><span class="toc-section-number">15.2</span> Scraping multiple recipes</a></li>
</ul></li>
<li><a href="16-scrape-table.html#scrape-table"><span class="toc-section-number">16</span> Scraping tables from PDFs</a>
<ul>
<li><a href="16-1-scraping-the-first-table.html#scraping-the-first-table"><span class="toc-section-number">16.1</span> Scraping the first table</a></li>
<li><a href="16-2-making-a-function.html#making-a-function"><span class="toc-section-number">16.2</span> Making a function</a></li>
</ul></li>
<li><a href="17-scrape-table2.html#scrape-table2"><span class="toc-section-number">17</span> More scraping tables from PDFs</a>
<ul>
<li><a href="17-1-pregnant-women-incarcerated.html#pregnant-women-incarcerated"><span class="toc-section-number">17.1</span> Pregnant Women Incarcerated</a></li>
<li><a href="17-2-making-pdf-scraped-data-available-to-others.html#making-pdf-scraped-data-available-to-others"><span class="toc-section-number">17.2</span> Making PDF-scraped data available to others</a></li>
</ul></li>
<li><a href="18-geocoding.html#geocoding"><span class="toc-section-number">18</span> Geocoding</a>
<ul>
<li><a href="18-1-geocoding-a-single-address.html#geocoding-a-single-address"><span class="toc-section-number">18.1</span> Geocoding a single address</a></li>
<li><a href="16-2-making-a-function.html#making-a-function"><span class="toc-section-number">18.2</span> Making a function</a></li>
<li><a href="18-3-geocoding-san-francisco-marijuana-dispensary-locations.html#geocoding-san-francisco-marijuana-dispensary-locations"><span class="toc-section-number">18.3</span> Geocoding San Francisco marijuana dispensary locations</a></li>
</ul></li>
<li class="part"><span><b>IV Data</b></span></li>
<li><a href="19-introduction.html#introduction"><span class="toc-section-number">19</span> Introduction</a></li>
<li><a href="20-ucr.html#ucr"><span class="toc-section-number">20</span> Uniform Crime Report (UCR) - Offenses Known and Clearances by Arrest</a>
<ul>
<li><a href="20-1-exploring-the-ucr-data.html#exploring-the-ucr-data"><span class="toc-section-number">20.1</span> Exploring the UCR data</a></li>
<li><a href="20-2-oris-unique-agency-identifiers.html#oris---unique-agency-identifiers"><span class="toc-section-number">20.2</span> ORIs - Unique agency identifiers</a></li>
<li><a href="20-3-hierarchy-rule.html#hierarchy-rule"><span class="toc-section-number">20.3</span> Hierarchy Rule</a></li>
<li><a href="20-4-which-crimes-are-included.html#which-crimes-are-included"><span class="toc-section-number">20.4</span> Which crimes are included</a>
<ul>
<li><a href="20-4-which-crimes-are-included.html#index-crimes"><span class="toc-section-number">20.4.1</span> Index Crimes</a></li>
<li><a href="20-4-which-crimes-are-included.html#the-problem-with-using-index-crimes"><span class="toc-section-number">20.4.2</span> The problem with using index crimes</a></li>
<li><a href="20-4-which-crimes-are-included.html#rape-definition-change"><span class="toc-section-number">20.4.3</span> Rape definition change</a></li>
</ul></li>
<li><a href="20-5-actual-offenses-clearances-and-unfounded-offenses.html#actual-offenses-clearances-and-unfounded-offenses"><span class="toc-section-number">20.5</span> Actual offenses, clearances, and unfounded offenses</a>
<ul>
<li><a href="20-5-actual-offenses-clearances-and-unfounded-offenses.html#actual"><span class="toc-section-number">20.5.1</span> Actual</a></li>
<li><a href="20-5-actual-offenses-clearances-and-unfounded-offenses.html#total-cleared"><span class="toc-section-number">20.5.2</span> Total Cleared</a></li>
<li><a href="20-5-actual-offenses-clearances-and-unfounded-offenses.html#cleared-where-all-offenders-are-under-18"><span class="toc-section-number">20.5.3</span> Cleared Where All Offenders Are Under 18</a></li>
<li><a href="20-5-actual-offenses-clearances-and-unfounded-offenses.html#unfounded"><span class="toc-section-number">20.5.4</span> Unfounded</a></li>
</ul></li>
<li><a href="20-6-number-of-months-reported.html#number-of-months-reported"><span class="toc-section-number">20.6</span> Number of months reported</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="A-useful-resources.html#useful-resources"><span class="toc-section-number">A</span> Useful resources</a>
<ul>
<li><a href="A-1-learning-r-and-coding-issues.html#learning-r-and-coding-issues"><span class="toc-section-number">A.1</span> Learning R and coding issues</a></li>
<li><a href="what-you-will-learn.html#data"><span class="toc-section-number">A.2</span> Data</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="spatial-joins" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Spatial joins</h2>
<p>What we want to do with these neighborhoods is to find out which neighborhood each suicide occurred in and sum up the number of suicides per neighborhood. Once we do that we can make a map at the neighborhood level and be able to measure suicides-per-neighborhood. A spatial join is very similar to regular joins where we merge two data sets based on common variables (such as state name or unique ID code of a person). In this case it merges based on some shared geographic feature such as if two lines intersect or (as we will do so here) if a point is within some geographic area.</p>
<p>Right now our <em>suicide</em> data is in a data.frame with some info on each suicide and the longitude and latitude of the suicide in separate columns. We want to turn this data.frame into a spatial object to allow us to find which neighborhood each suicide happened in. We can convert it into a spatial object using the <code>st_as_sf()</code> function from <code>sf</code>. Our input is first our data, <em>suicide.</em> Then in the <code>coords</code> parameter we put a vector of the column names so the function knows which columns are the longitude and latitude columns to convert to a “geometry” column like we saw in <em>sf_neighborhoods</em> earlier. We’ll set the CRS to be the WGS84 standard we saw earlier but we will change it to match the CRS that the neighborhood data has.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="9-1-spatial-joins.html#cb227-1"></a>suicide &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(suicide, </span>
<span id="cb227-2"><a href="9-1-spatial-joins.html#cb227-2"></a>                    <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>),</span>
<span id="cb227-3"><a href="9-1-spatial-joins.html#cb227-3"></a>                    <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +ellps=WGS84 +no_defs&quot;</span>)</span></code></pre></div>
<p>We want our suicides data in the same projection as the neighborhoods data so we need to use <code>st_transform()</code> to change the projection. Since we want the CRS to be the same as in <em>sf_neighborhoods</em>, we can set it using <code>st_crs(sf_neighborhoods)</code> to use the right CRS.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="9-1-spatial-joins.html#cb228-1"></a>suicide &lt;-<span class="st"> </span><span class="kw">st_transform</span>(suicide, </span>
<span id="cb228-2"><a href="9-1-spatial-joins.html#cb228-2"></a>                        <span class="dt">crs =</span> <span class="kw">st_crs</span>(sf_neighborhoods))</span></code></pre></div>
<p>Now we can take a look at <code>head()</code> to see if it was projected.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="9-1-spatial-joins.html#cb229-1"></a><span class="kw">head</span>(suicide)</span>
<span id="cb229-2"><a href="9-1-spatial-joins.html#cb229-2"></a><span class="co">#&gt; Simple feature collection with 6 features and 12 fields</span></span>
<span id="cb229-3"><a href="9-1-spatial-joins.html#cb229-3"></a><span class="co">#&gt; geometry type:  POINT</span></span>
<span id="cb229-4"><a href="9-1-spatial-joins.html#cb229-4"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb229-5"><a href="9-1-spatial-joins.html#cb229-5"></a><span class="co">#&gt; bbox:           xmin: 5986822 ymin: 2091310 xmax: 6013739 ymax: 2117180</span></span>
<span id="cb229-6"><a href="9-1-spatial-joins.html#cb229-6"></a><span class="co">#&gt; projected CRS:  NAD83 / California zone 3 (ftUS)</span></span>
<span id="cb229-7"><a href="9-1-spatial-joins.html#cb229-7"></a><span class="co">#&gt;   IncidntNum Category                           Descript DayOfWeek       Date</span></span>
<span id="cb229-8"><a href="9-1-spatial-joins.html#cb229-8"></a><span class="co">#&gt; 1  180318931  SUICIDE ATTEMPTED SUICIDE BY STRANGULATION    Monday 04/30/2018</span></span>
<span id="cb229-9"><a href="9-1-spatial-joins.html#cb229-9"></a><span class="co">#&gt; 2  180315501  SUICIDE       ATTEMPTED SUICIDE BY JUMPING  Saturday 04/28/2018</span></span>
<span id="cb229-10"><a href="9-1-spatial-joins.html#cb229-10"></a><span class="co">#&gt; 3  180295674  SUICIDE              SUICIDE BY LACERATION  Saturday 04/21/2018</span></span>
<span id="cb229-11"><a href="9-1-spatial-joins.html#cb229-11"></a><span class="co">#&gt; 4  180263659  SUICIDE                            SUICIDE   Tuesday 04/10/2018</span></span>
<span id="cb229-12"><a href="9-1-spatial-joins.html#cb229-12"></a><span class="co">#&gt; 5  180235523  SUICIDE     ATTEMPTED SUICIDE BY INGESTION    Friday 03/30/2018</span></span>
<span id="cb229-13"><a href="9-1-spatial-joins.html#cb229-13"></a><span class="co">#&gt; 6  180236515  SUICIDE            SUICIDE BY ASPHYXIATION  Thursday 03/29/2018</span></span>
<span id="cb229-14"><a href="9-1-spatial-joins.html#cb229-14"></a><span class="co">#&gt;       Time PdDistrict Resolution                 Address</span></span>
<span id="cb229-15"><a href="9-1-spatial-joins.html#cb229-15"></a><span class="co">#&gt; 1 06:30:00    TARAVAL       NONE     0 Block of BRUCE AV</span></span>
<span id="cb229-16"><a href="9-1-spatial-joins.html#cb229-16"></a><span class="co">#&gt; 2 17:54:00   NORTHERN       NONE   700 Block of HAYES ST</span></span>
<span id="cb229-17"><a href="9-1-spatial-joins.html#cb229-17"></a><span class="co">#&gt; 3 12:20:00   RICHMOND       NONE   3700 Block of CLAY ST</span></span>
<span id="cb229-18"><a href="9-1-spatial-joins.html#cb229-18"></a><span class="co">#&gt; 4 05:13:00    CENTRAL       NONE     0 Block of DRUMM ST</span></span>
<span id="cb229-19"><a href="9-1-spatial-joins.html#cb229-19"></a><span class="co">#&gt; 5 09:15:00    TARAVAL       NONE 0 Block of FAIRFIELD WY</span></span>
<span id="cb229-20"><a href="9-1-spatial-joins.html#cb229-20"></a><span class="co">#&gt; 6 17:30:00   RICHMOND       NONE    300 Block of 29TH AV</span></span>
<span id="cb229-21"><a href="9-1-spatial-joins.html#cb229-21"></a><span class="co">#&gt;                                         Location         PdId year</span></span>
<span id="cb229-22"><a href="9-1-spatial-joins.html#cb229-22"></a><span class="co">#&gt; 1  POINT (-122.45168059935614 37.72218061554315) 1.803189e+13 2018</span></span>
<span id="cb229-23"><a href="9-1-spatial-joins.html#cb229-23"></a><span class="co">#&gt; 2  POINT (-122.42876060987851 37.77620120112792) 1.803155e+13 2018</span></span>
<span id="cb229-24"><a href="9-1-spatial-joins.html#cb229-24"></a><span class="co">#&gt; 3   POINT (-122.45462091999406 37.7881754224736) 1.802957e+13 2018</span></span>
<span id="cb229-25"><a href="9-1-spatial-joins.html#cb229-25"></a><span class="co">#&gt; 4  POINT (-122.39642194376758 37.79414474237039) 1.802637e+13 2018</span></span>
<span id="cb229-26"><a href="9-1-spatial-joins.html#cb229-26"></a><span class="co">#&gt; 5  POINT (-122.46324153155875 37.72679184368551) 1.802355e+13 2018</span></span>
<span id="cb229-27"><a href="9-1-spatial-joins.html#cb229-27"></a><span class="co">#&gt; 6 POINT (-122.48929119750689 37.782735835121265) 1.802365e+13 2018</span></span>
<span id="cb229-28"><a href="9-1-spatial-joins.html#cb229-28"></a><span class="co">#&gt;                  geometry</span></span>
<span id="cb229-29"><a href="9-1-spatial-joins.html#cb229-29"></a><span class="co">#&gt; 1 POINT (5997229 2091310)</span></span>
<span id="cb229-30"><a href="9-1-spatial-joins.html#cb229-30"></a><span class="co">#&gt; 2 POINT (6004262 2110838)</span></span>
<span id="cb229-31"><a href="9-1-spatial-joins.html#cb229-31"></a><span class="co">#&gt; 3 POINT (5996881 2115353)</span></span>
<span id="cb229-32"><a href="9-1-spatial-joins.html#cb229-32"></a><span class="co">#&gt; 4 POINT (6013739 2117180)</span></span>
<span id="cb229-33"><a href="9-1-spatial-joins.html#cb229-33"></a><span class="co">#&gt; 5 POINT (5993921 2093059)</span></span>
<span id="cb229-34"><a href="9-1-spatial-joins.html#cb229-34"></a><span class="co">#&gt; 6 POINT (5986822 2113584)</span></span></code></pre></div>
<p>We can see it is now a “simple feature collection” with the correct projection. And we can see there is a new column called “geometry” just like in <em>sf_neighborhoods</em>. The type of data in “geometry” is POINT since our data is just a single location instead of a polygon like in the neighborhoods data.</p>
<p>Since we have both the neighborhoods and the suicides data let’s make a quick map to see the data.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="9-1-spatial-joins.html#cb230-1"></a><span class="kw">plot</span>(sf_neighborhoods<span class="op">$</span>geometry)</span>
<span id="cb230-2"><a href="9-1-spatial-joins.html#cb230-2"></a><span class="kw">plot</span>(suicide<span class="op">$</span>geometry, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="choropleth-maps_files/figure-html/unnamed-chunk-13-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Our next step is to combine these two data sets to figure out how many suicides occurred in each neighborhood. This will be a multi-step process so let’s plan it out before beginning. Our suicide data is one row for each suicide, our neighborhood data is one row for each neighborhood. Since our goal is to map at the neighborhood-level we need to get the neighborhood where each suicide occurred then aggregate up to the neighborhood-level to get a count of the suicides-per-neighborhood. Then we need to combine that with that the original neighborhood data (since we need the “geometry” column) and we can then map it.</p>
<ol style="list-style-type: decimal">
<li>Find which neighborhood each suicide happened in</li>
<li>Aggregate suicide data until we get one row per neighborhood and a column showing the number of suicides in that neighborhood</li>
<li>Combine with the neighborhood data</li>
<li>Make a map</li>
</ol>
<p>We’ll start by finding the neighborhood where each suicide occurred using the function <code>st_join()</code> which is a function in <code>sf</code>. This does a spatial join and finds the polygon (neighborhood in our case) where each point is located in. Since we will be aggregating the data, let’s call the output of this function <em>suicide_agg</em>. The order in the () is important! For our aggregation we want the output to be at the suicide-level so we start with the <em>suicide</em> data. In the next step we’ll see why this matters.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="9-1-spatial-joins.html#cb231-1"></a>suicide_agg &lt;-<span class="st"> </span><span class="kw">st_join</span>(suicide, sf_neighborhoods)</span></code></pre></div>
<p>Let’s look at the first 6 rows.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="9-1-spatial-joins.html#cb232-1"></a><span class="kw">head</span>(suicide_agg)</span>
<span id="cb232-2"><a href="9-1-spatial-joins.html#cb232-2"></a><span class="co">#&gt; Simple feature collection with 6 features and 13 fields</span></span>
<span id="cb232-3"><a href="9-1-spatial-joins.html#cb232-3"></a><span class="co">#&gt; geometry type:  POINT</span></span>
<span id="cb232-4"><a href="9-1-spatial-joins.html#cb232-4"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb232-5"><a href="9-1-spatial-joins.html#cb232-5"></a><span class="co">#&gt; bbox:           xmin: 5986822 ymin: 2091310 xmax: 6013739 ymax: 2117180</span></span>
<span id="cb232-6"><a href="9-1-spatial-joins.html#cb232-6"></a><span class="co">#&gt; projected CRS:  NAD83 / California zone 3 (ftUS)</span></span>
<span id="cb232-7"><a href="9-1-spatial-joins.html#cb232-7"></a><span class="co">#&gt;   IncidntNum Category                           Descript DayOfWeek       Date</span></span>
<span id="cb232-8"><a href="9-1-spatial-joins.html#cb232-8"></a><span class="co">#&gt; 1  180318931  SUICIDE ATTEMPTED SUICIDE BY STRANGULATION    Monday 04/30/2018</span></span>
<span id="cb232-9"><a href="9-1-spatial-joins.html#cb232-9"></a><span class="co">#&gt; 2  180315501  SUICIDE       ATTEMPTED SUICIDE BY JUMPING  Saturday 04/28/2018</span></span>
<span id="cb232-10"><a href="9-1-spatial-joins.html#cb232-10"></a><span class="co">#&gt; 3  180295674  SUICIDE              SUICIDE BY LACERATION  Saturday 04/21/2018</span></span>
<span id="cb232-11"><a href="9-1-spatial-joins.html#cb232-11"></a><span class="co">#&gt; 4  180263659  SUICIDE                            SUICIDE   Tuesday 04/10/2018</span></span>
<span id="cb232-12"><a href="9-1-spatial-joins.html#cb232-12"></a><span class="co">#&gt; 5  180235523  SUICIDE     ATTEMPTED SUICIDE BY INGESTION    Friday 03/30/2018</span></span>
<span id="cb232-13"><a href="9-1-spatial-joins.html#cb232-13"></a><span class="co">#&gt; 6  180236515  SUICIDE            SUICIDE BY ASPHYXIATION  Thursday 03/29/2018</span></span>
<span id="cb232-14"><a href="9-1-spatial-joins.html#cb232-14"></a><span class="co">#&gt;       Time PdDistrict Resolution                 Address</span></span>
<span id="cb232-15"><a href="9-1-spatial-joins.html#cb232-15"></a><span class="co">#&gt; 1 06:30:00    TARAVAL       NONE     0 Block of BRUCE AV</span></span>
<span id="cb232-16"><a href="9-1-spatial-joins.html#cb232-16"></a><span class="co">#&gt; 2 17:54:00   NORTHERN       NONE   700 Block of HAYES ST</span></span>
<span id="cb232-17"><a href="9-1-spatial-joins.html#cb232-17"></a><span class="co">#&gt; 3 12:20:00   RICHMOND       NONE   3700 Block of CLAY ST</span></span>
<span id="cb232-18"><a href="9-1-spatial-joins.html#cb232-18"></a><span class="co">#&gt; 4 05:13:00    CENTRAL       NONE     0 Block of DRUMM ST</span></span>
<span id="cb232-19"><a href="9-1-spatial-joins.html#cb232-19"></a><span class="co">#&gt; 5 09:15:00    TARAVAL       NONE 0 Block of FAIRFIELD WY</span></span>
<span id="cb232-20"><a href="9-1-spatial-joins.html#cb232-20"></a><span class="co">#&gt; 6 17:30:00   RICHMOND       NONE    300 Block of 29TH AV</span></span>
<span id="cb232-21"><a href="9-1-spatial-joins.html#cb232-21"></a><span class="co">#&gt;                                         Location         PdId year</span></span>
<span id="cb232-22"><a href="9-1-spatial-joins.html#cb232-22"></a><span class="co">#&gt; 1  POINT (-122.45168059935614 37.72218061554315) 1.803189e+13 2018</span></span>
<span id="cb232-23"><a href="9-1-spatial-joins.html#cb232-23"></a><span class="co">#&gt; 2  POINT (-122.42876060987851 37.77620120112792) 1.803155e+13 2018</span></span>
<span id="cb232-24"><a href="9-1-spatial-joins.html#cb232-24"></a><span class="co">#&gt; 3   POINT (-122.45462091999406 37.7881754224736) 1.802957e+13 2018</span></span>
<span id="cb232-25"><a href="9-1-spatial-joins.html#cb232-25"></a><span class="co">#&gt; 4  POINT (-122.39642194376758 37.79414474237039) 1.802637e+13 2018</span></span>
<span id="cb232-26"><a href="9-1-spatial-joins.html#cb232-26"></a><span class="co">#&gt; 5  POINT (-122.46324153155875 37.72679184368551) 1.802355e+13 2018</span></span>
<span id="cb232-27"><a href="9-1-spatial-joins.html#cb232-27"></a><span class="co">#&gt; 6 POINT (-122.48929119750689 37.782735835121265) 1.802365e+13 2018</span></span>
<span id="cb232-28"><a href="9-1-spatial-joins.html#cb232-28"></a><span class="co">#&gt;                            nhood                geometry</span></span>
<span id="cb232-29"><a href="9-1-spatial-joins.html#cb232-29"></a><span class="co">#&gt; 1     Oceanview/Merced/Ingleside POINT (5997229 2091310)</span></span>
<span id="cb232-30"><a href="9-1-spatial-joins.html#cb232-30"></a><span class="co">#&gt; 2                   Hayes Valley POINT (6004262 2110838)</span></span>
<span id="cb232-31"><a href="9-1-spatial-joins.html#cb232-31"></a><span class="co">#&gt; 3               Presidio Heights POINT (5996881 2115353)</span></span>
<span id="cb232-32"><a href="9-1-spatial-joins.html#cb232-32"></a><span class="co">#&gt; 4 Financial District/South Beach POINT (6013739 2117180)</span></span>
<span id="cb232-33"><a href="9-1-spatial-joins.html#cb232-33"></a><span class="co">#&gt; 5             West of Twin Peaks POINT (5993921 2093059)</span></span>
<span id="cb232-34"><a href="9-1-spatial-joins.html#cb232-34"></a><span class="co">#&gt; 6                 Outer Richmond POINT (5986822 2113584)</span></span></code></pre></div>
<p>There is now the <em>nhood</em> column from the neighborhoods data which says which neighborhood the suicide happened in. Now we can aggregate up to the neighborhood-level.
For now we will use the code to aggregate the number of suicides per neighborhood. Remember, the <code>aggregate()</code> command aggregates a numeric value by some categorical value. Here we aggregate the number of suicides per neighborhood. So our code will be</p>
<p><code>aggregate(number_suicides ~ nhood, data = suicide_agg, FUN = sum)</code></p>
<p>We actually don’t have a variable with the number of suicides so we need to make that. We can simply call it <em>number_suicides</em> and give it that value of 1 since each row is only one suicide.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="9-1-spatial-joins.html#cb233-1"></a>suicide_agg<span class="op">$</span>number_suicides &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>Now we can write the <code>aggregate()</code> code and save the results back into <em>suicide_agg</em>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="9-1-spatial-joins.html#cb234-1"></a>suicide_agg &lt;-<span class="st"> </span><span class="kw">aggregate</span>(number_suicides <span class="op">~</span><span class="st"> </span>nhood, <span class="dt">data =</span> suicide_agg, <span class="dt">FUN =</span> sum)</span></code></pre></div>
<p>Let’s check a summary of the <em>number_suicides</em> variable we made.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="9-1-spatial-joins.html#cb235-1"></a><span class="kw">summary</span>(suicide_agg<span class="op">$</span>number_suicides)</span>
<span id="cb235-2"><a href="9-1-spatial-joins.html#cb235-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb235-3"><a href="9-1-spatial-joins.html#cb235-3"></a><span class="co">#&gt;    1.00   15.00   24.00   33.08   38.50  141.00</span></span></code></pre></div>
<p>The minimum is one suicide per neighborhood, 33 on average, and 141 in the neighborhood with the most suicides. So what do we make of this data? Well, there are some data issues that cause problems in these results. Let’s think about the minimum value. Did every single neighborhood in the city have at least one suicide? No. Take a look at the number of rows in this data, keeping in mind there should be one row per neighborhood.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="9-1-spatial-joins.html#cb236-1"></a><span class="kw">nrow</span>(suicide_agg)</span>
<span id="cb236-2"><a href="9-1-spatial-joins.html#cb236-2"></a><span class="co">#&gt; [1] 39</span></span></code></pre></div>
<p>And let’s compare it to the <em>sf_neighborhoods</em> data.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="9-1-spatial-joins.html#cb237-1"></a><span class="kw">nrow</span>(sf_neighborhoods)</span>
<span id="cb237-2"><a href="9-1-spatial-joins.html#cb237-2"></a><span class="co">#&gt; [1] 41</span></span></code></pre></div>
<p>The suicides data is missing 2 neighborhoods. That is because if no suicides occurred there, there would never be a matching row in the data so that neighborhood wouldn’t appear in the suicide data. That’s not going to be a major issue here but is something to keep in mind in future research.</p>
<p>The data is ready to merge with the <em>sf_neighborhoods</em> data. We’ll introduce a new function that makes merging data simple. This function comes from the <code>dplyr</code> package so we need to install and tell R we want to use it using <code>library()</code>.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="9-1-spatial-joins.html#cb238-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="9-1-spatial-joins.html#cb239-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb239-2"><a href="9-1-spatial-joins.html#cb239-2"></a><span class="co">#&gt; </span></span>
<span id="cb239-3"><a href="9-1-spatial-joins.html#cb239-3"></a><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb239-4"><a href="9-1-spatial-joins.html#cb239-4"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb239-5"><a href="9-1-spatial-joins.html#cb239-5"></a><span class="co">#&gt; </span></span>
<span id="cb239-6"><a href="9-1-spatial-joins.html#cb239-6"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb239-7"><a href="9-1-spatial-joins.html#cb239-7"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb239-8"><a href="9-1-spatial-joins.html#cb239-8"></a><span class="co">#&gt; </span></span>
<span id="cb239-9"><a href="9-1-spatial-joins.html#cb239-9"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>The function we will use is <code>left_join()</code> which takes two parameters, the two data sets to join together.</p>
<p><code>left_join(data1, data2)</code></p>
<p>This function joins these data and keeps all of the rows from the left data and every column from both data sets. It combines the data based on any matching columns (matching meaning same column name) in both data sets. Since in our data sets, the column <em>nhood</em> exists in both, it will merge the data based on that column.</p>
<p>There are two other functions that are similar but differ based on which rows they keep.</p>
<ul>
<li><code>left_join()</code> - All rows from Left data and all columns from Left and Right data</li>
<li><code>right_join()</code> - All rows from Right data and all columns from Left and Right data</li>
<li><code>full_join()</code> - All rows and all columns from Left and Right data</li>
</ul>
<p>We could alternatively use the <code>merge()</code> function which is built into R but that function is slower than the <code>dplyr</code> functions and requires us to manually set the matching columns.</p>
<p>We want to keep all rows in <em>sf_neighborhoods</em> (keep all neighborhoods) so we can use <code>left_join(sf_neighborhoods, suicide_agg)</code>. Let’s save the results into a new data.frame called <em>sf_neighborhoods_suicide</em>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="9-1-spatial-joins.html#cb240-1"></a>sf_neighborhoods_suicide &lt;-<span class="st"> </span><span class="kw">left_join</span>(sf_neighborhoods, suicide_agg)</span>
<span id="cb240-2"><a href="9-1-spatial-joins.html#cb240-2"></a><span class="co">#&gt; Joining, by = &quot;nhood&quot;</span></span></code></pre></div>
<p>If we look at <code>summary()</code> again for <em>number_suicides</em> we can see that there are now 2 rows with NAs. These are the neighborhoods where there were no suicides so they weren’t present in the <em>suicide_agg</em> data.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="9-1-spatial-joins.html#cb241-1"></a><span class="kw">summary</span>(sf_neighborhoods_suicide<span class="op">$</span>number_suicides)</span>
<span id="cb241-2"><a href="9-1-spatial-joins.html#cb241-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb241-3"><a href="9-1-spatial-joins.html#cb241-3"></a><span class="co">#&gt;    1.00   15.00   24.00   33.08   38.50  141.00       2</span></span></code></pre></div>
<p>We need to convert these values to 0. We will use the <code>is.na()</code> function to conditionally find all rows with an NA value in the <em>number_suicides</em> column and use square bracket notation to change the value to 0.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="9-1-spatial-joins.html#cb242-1"></a>sf_neighborhoods_suicide<span class="op">$</span>number_suicides[<span class="kw">is.na</span>(sf_neighborhoods_suicide<span class="op">$</span>number_suicides)] &lt;-<span class="st"> </span><span class="dv">0</span></span></code></pre></div>
<p>Checking it again we see that the minimum is now 0 and the mean number of suicides decreases a bit to about 31.5 per neighborhood.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="9-1-spatial-joins.html#cb243-1"></a><span class="kw">summary</span>(sf_neighborhoods_suicide<span class="op">$</span>number_suicides)</span>
<span id="cb243-2"><a href="9-1-spatial-joins.html#cb243-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb243-3"><a href="9-1-spatial-joins.html#cb243-3"></a><span class="co">#&gt;    0.00   12.00   23.00   31.46   36.00  141.00</span></span></code></pre></div>
</div>
<p style="text-align: center;">
<a href="9-choropleth-maps.html"><button class="btn btn-default">Previous</button></a>
<a href="9-2-making-choropleth-maps.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
