# Interactive Maps

While maps of data are useful, their ability to show incident-level information is quite limited. They tend to show broad trends - where crime happened in a city - rather than provide information about specific crime incidents. While this is important, there are significant drawbacks about being unable to get important information about an incident without having to check the data. An interactive map excels at showing individual incidents as it allows you to click on a dot and will have a popup giving information about that incident.

For this lesson we will continue to use the officer shooting data so let's load that.

```{r}
load("data/officer_shootings_geocoded.rda")
```


## Why do interactive graphs matter?

### Understanding your data

The most important thing to learn from this course is that understanding your data is crucial to good research. Making interactive maps is a very useful way to better understand your data as you can immediately see geographic patterns and quickly look at characteristics of those incidents to understand them. Let's say your research looked at if marijuana dispensaries attracts crime. 

In this lesson we will be mapping each officer-involved shooting and let you click on the shooting to popup some information about it. If we see a cluster of shootings, we can click on each shooting to see if they are similar. Though it is possible to find these patterns just looking at the data, it is much easier to be able to see a geographic pattern and immediately look at information about each incident.

### Police departments use them

Interactive maps are population in large police departments such as Philadelphia and New York City. They allow easy understanding of geographic patterns in the data and, importantly, allow such access to people who do not have the technical skills necessary to create the maps. If nothing else, learning interactive maps will help you with a future job. 



## Making the interactive map 

As usual, let's take a look at the top 6 rows of the data.

```{r}
head(officer_shootings_geocoded)
```

This data is fairly sparse about information regarding the shooting. All it has is the date and address (which isn't that useful as location is already covered by the map). 

It has the date, time and location but  no information about the incident itself (with the exception of which crime occurred which, in this case, is murder). Though we only need the crime's coordinates to create a map, the true benefit of interactive maps is that you can click on a point and it'll show information about that specific incident. The level of detail about the crime may be sparse, but we can still create a map where you can click a crime incident dot on the map and a popup will tell you when it happened.


We will use a new package `leaflet` for our interactive map. leaflet will produce maps similar to Google Maps with circles (or any icon we choose) for each value we add to the map. It allows you to zoom in, scroll around, and provides context to each incident that isn't available on a static map. 

```{r eval = FALSE}
install.packages("leaflet")
```

```{r}
library(leaflet)
```

To make a leaflet map we just need to run the function `leaflet()` and add a tile to the map. A tile is simply the background on the map. This [website](https://leaflet-extras.github.io/leaflet-providers/preview/) provides a large number of potential tiles to use, though many are not relevant to our purposes of crime mapping. 

We will use a standard tile from Open Street Maps. This tile gives street names and highlights important features such has parks and large stores which provides useful contexts for looking at the data. The `attribution` parameter isn't strictly necessary but it is good form to say where you tile is from.  

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors')
```

When you run the above code it shows a world map (copied several times). Zoom into it and it'll start showing relevant features of wherever you're looking.

Note the `%>%` between the `leaflet()` function and the `addTiles()` function. This is called a "pipe" in R and is used like the `+` in ggplot to combine multiple functions together. This is used heavily in what is called the "tidyverse", a series of packages that are prominent in modern R and useful for data analysis. We won't be covering them in this introductory course but for more information on them you can check the  [tidyverse website](https://www.tidyverse.org/). For this lesson you need to know that each piece of the leaflet function must end with `%>%` for the next line to work. 

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addMarkers(~lon, ~lat, data = officer_shootings_geocoded)
```


```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded)
```

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5)
```

## Adding popup information

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5,
                   popup = officer_shootings_geocoded$dates)
```

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5,
                   popup = paste("Date of Shooting:",officer_shootings_geocoded$dates))
```

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5,
                   popup = paste("Shooting Number:", officer_shootings_geocoded$shooting_number,
                                 "Date:", officer_shootings_geocoded$dates,
                                 "Location:", officer_shootings_geocoded$location))
```

```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5,
                   popup = paste("Shooting Number:", officer_shootings_geocoded$shooting_number,
                                 "<br>",
                                 "Date:", officer_shootings_geocoded$dates,
                                 "<br>",
                                 "Location:", officer_shootings_geocoded$location))
```

## Dealing with too many markers


```{r}
leaflet() %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addCircleMarkers(~lon, ~lat, data = officer_shootings_geocoded,
                   radius = 5,
                   popup = paste("Shooting Number:", officer_shootings_geocoded$shooting_number,
                                 "<br>",
                                 "Date:", officer_shootings_geocoded$dates,
                                 "<br>",
                                 "Location:", officer_shootings_geocoded$location),
                   clusterOptions = markerClusterOptions())
```


## Interactive polygons

```{r}
library(sf)
library(sp)
bins <- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)
pal <- colorBin("YlOrRd", domain = philly_tracts$NAMELSAD10, bins = bins)

philly_tracts <- st_read("data/philly_census_tract/Census_Tracts_2010.shp")
leaflet()  %>% 
  addTiles('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
          attribution = '&copy; <a href="http://openstreetmap.org">
                OpenStreetMap</a> contributors') %>%
  addPolygons(data = philly_tracts$geometry,
              fillColor = ~pal(philly_tracts$geometry),
              col = "black",
              weight = 2,
                                 popup = philly_tracts$NAMELSAD10)
```

